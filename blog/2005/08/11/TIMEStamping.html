<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TIME stamping</title>
  <link media="all" href="/style.css" rel="stylesheet" />
  <link media="all" href="/pygments.css" rel="stylesheet" />
  <link href="/favicon.ico" rel="shortcut icon" />
    <link href="/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">
  <link href="/" rel="home start" />
  <link href="/atom/" type="application/atom+xml" rel="alternate" title="Atom Feed" />
  <link href="/rss/" type="application/rss+xml" rel="alternate" title="RSS Feed" />
    <meta name="description" content="I&#39;m a command-line dinosaur.
`Vim`__ (Vi IMproved)..." />
    <meta name="keywords" content="cmd" />
</head>
<body>
  <header>
    <h1><a href="/" rel="home start" class="blogtitle">George V. Reilly</a></h1>
    <nav>
      <ul>
        <li><a href="/blog/" rel="home start">blog</a></li>
        <li><a href="/about/" rel="home start">about</a></li>
        <li><a href="/atom/" rel="alternate">atom</a></li>
        <li><a href="/rss/" rel="alternate">rss</a></li>
        <li><a href="/articles/" rel="contents">articles</a></li>
        <li><a href="/tags/" rel="contents">tags</a></li>
      </ul>
    </nav>
  </header>
    
        <article>
    <header>
        <time datetime="2005-08-11">2005-08-11</time>
        <h1>
            <a href="/blog/2005/08/11/TIMEStamping.html" rel="bookmark canonical">TIME stamping</a>
        </h1>
    </header>
    <p>I&#8217;m a command-line dinosaur.
<a class="reference external" href="http://www.vim.org/">Vim</a> (Vi IMproved) is my favorite text editor.
And I write quite a few little batch&nbsp;files.</p>
<p>Here are a few useful tricks that work with cmd.exe on Windows&nbsp;<span class="caps">XP</span>.</p>
<div class="section" id="timestamped-filename">
<h2>Time&shy;stamped&nbsp;filename</h2>
<p>Sometimes I want to create a file whose name includes the current date and time.
By combining the magic <tt class="docutils literal">%<span class="caps">DATE</span>%</tt> and <tt class="docutils literal">%<span class="caps">TIME</span>%</tt> en&shy;vi&shy;ron&shy;ment variables,
with <tt class="docutils literal">for /f</tt> and a little bit of string sub&shy;sti&shy;tu&shy;tion,
I can create that&nbsp;filename.</p>
<div class="highlight"><pre><span></span><span class="c1"><span class="caps">REM</span></span>
<span class="c1"><span class="caps">REM</span> &quot;Tue 06/14/2005&quot; -&gt; &quot;06/14/2005&quot;</span>
<span class="c1"><span class="caps">REM</span></span>
<span class="k">for</span> <span class="k">/f</span> <span class="s2">&quot;tokens=2&quot;</span>              <span class="se">%%</span>i <span class="k">in</span> <span class="p">(</span><span class="s2">&quot;</span><span class="nv">%<span class="caps">DATE</span>%</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="k">set</span> <span class="nv"><span class="caps">MDY</span></span><span class="p">=</span><span class="se">%%</span>i
<span class="c1"><span class="caps">REM</span></span>
<span class="c1"><span class="caps">REM</span> &quot;06/14/2005&quot; -&gt; &quot;2005-06-14&quot;</span>
<span class="c1"><span class="caps">REM</span></span>
<span class="k">for</span> <span class="k">/f</span> <span class="s2">&quot;delims=/ tokens=1,2,3&quot;</span> <span class="se">%%</span>i <span class="k">in</span> <span class="p">(</span><span class="s2">&quot;</span><span class="nv">%<span class="caps">MDY</span>%</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="k">do</span> <span class="k">set</span> <span class="nv"><span class="caps">YMD</span></span><span class="p">=</span><span class="se">%%</span>k-<span class="se">%%</span>i-<span class="se">%%</span>j

<span class="c1"><span class="caps">REM</span> &quot;16:44:39.72&quot; -&gt; &quot;1644&quot;</span>
<span class="c1"><span class="caps">REM</span></span>
<span class="k">for</span> <span class="k">/f</span> <span class="s2">&quot;delims=: tokens=1,2&quot;</span>   <span class="se">%%</span>i <span class="k">in</span> <span class="p">(</span><span class="s2">&quot;</span><span class="nv">%<span class="caps">TIME</span>%</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="k">set</span> <span class="nv"><span class="caps">HM</span></span><span class="p">=</span><span class="se">%%</span>i<span class="se">%%</span>j
<span class="c1"><span class="caps">REM</span></span>
<span class="c1"><span class="caps">REM</span> &quot; 237&quot; -&gt; &quot;0237&quot;    (%<span class="caps">TIME</span>% &lt; 10:00:00.00 contains a leading space)</span>
<span class="k">set</span> <span class="nv"><span class="caps">HM</span></span><span class="p">=</span><span class="nv">%<span class="caps">HM</span>: =0%</span>

xcopy /yf <span class="nv">%1</span> <span class="nv">%<span class="caps">YMD</span>%</span>_<span class="nv">%<span class="caps">HM</span>%</span>.bak
</pre></div>
<p>See <tt class="docutils literal">for /?</tt> and <tt class="docutils literal">set /?</tt> to explain everything that the comments&nbsp;don&#8217;t.</p>
</div>
<div class="section" id="timing-operations">
<h2>Timing&nbsp;Operations</h2>
<p>Sometimes it&#8217;s useful to time&nbsp;operations.</p>
<div class="highlight"><pre><span></span><span class="p">@</span><span class="k">setlocal</span>
<span class="p">@</span><span class="k">if</span> (<span class="nv">%_echo%</span>)<span class="o">==</span>()  <span class="k">set</span> <span class="nv">_echo</span><span class="p">=</span>off
<span class="p">@</span><span class="k">echo</span> <span class="nv">%_echo%</span>

<span class="k">call</span> <span class="p">:</span><span class="nl">time</span> T1
<span class="k">set</span> <span class="nv">T2</span><span class="p">=</span><span class="nv">%T1%</span>
<span class="k">set</span> <span class="nv">Iter</span><span class="p">=</span>0
<span class="p">@</span><span class="k">echo</span> T1 = <span class="nv">%T1%</span>

<span class="p">:</span><span class="nl">repeat</span>
CostlyOperation.exe

<span class="k">call</span> <span class="p">:</span><span class="nl">time</span> T2
<span class="k">set</span> <span class="k">/A</span> <span class="nv">DeltaT</span><span class="o">=%</span><span class="nv">T2% - %T1</span><span class="o">%</span>
<span class="k">set</span> <span class="k">/A</span> <span class="nv">Iter</span><span class="o">=%</span><span class="nv">Iter</span><span class="o">%</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">set</span> <span class="k">/A</span> <span class="nv">Avg</span><span class="o">=%</span><span class="nv">DeltaT% / %Iter</span><span class="o">%</span>
<span class="p">@</span><span class="k">echo</span> DeltaT = <span class="nv">%DeltaT%</span>, Avg = <span class="nv">%Avg%</span>, Iter = <span class="nv">%Iter%</span>, T2 = <span class="nv">%T2%</span>
<span class="k">goto</span> <span class="p">:</span><span class="nl">repeat</span>


<span class="p">:</span><span class="nl">time</span>
<span class="k">set</span> <span class="nv"><span class="caps">TT</span></span><span class="p">=</span><span class="nv">%<span class="caps">TIME</span>%</span>
<span class="k">for</span> <span class="k">/f</span> <span class="s2">&quot;delims=: tokens=1&quot;</span> <span class="se">%%</span>i <span class="k">in</span> <span class="p">(</span><span class="s2">&quot;</span><span class="nv">%<span class="caps">TT</span>%</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="k">do</span> <span class="k">set</span> <span class="nv">hrs</span><span class="p">=</span><span class="se">%%</span>i
<span class="k">for</span> <span class="k">/f</span> <span class="s2">&quot;delims=: tokens=2&quot;</span> <span class="se">%%</span>i <span class="k">in</span> <span class="p">(</span><span class="s2">&quot;</span><span class="nv">%<span class="caps">TT</span>%</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="k">do</span> <span class="k">set</span> <span class="nv">min</span><span class="p">=</span>1<span class="se">%%</span>i
<span class="k">for</span> <span class="k">/f</span> <span class="s2">&quot;delims=: tokens=3&quot;</span> <span class="se">%%</span>i <span class="k">in</span> <span class="p">(</span><span class="s2">&quot;</span><span class="nv">%<span class="caps">TT</span>%</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="k">do</span> <span class="k">set</span> <span class="nv">sec</span><span class="p">=</span>1<span class="se">%%</span>i
<span class="k">set</span> <span class="k">/A</span> <span class="o">%</span><span class="mi">1</span><span class="o">=</span><span class="mi">3600</span> <span class="o">*</span> <span class="o">%</span><span class="nv">hrs%  +  60 * (%min%-100)  +  (%sec</span><span class="o">%-</span><span class="mi">100</span><span class="p">)</span>
<span class="k">goto</span> <span class="p">:</span><span class="nl"><span class="caps">EOF</span></span>
</pre></div>
<p>The <tt class="docutils literal">:time</tt> subroutine calculates the number of seconds that have elapsed today.
The business with 100 is to handle the case that <tt class="docutils literal">min</tt> or <tt class="docutils literal">sec</tt> is <tt class="docutils literal">08</tt> or <tt class="docutils literal">09</tt>,
which Cmd&#8217;s expression evaluator considers to be malformed <a class="reference external" href="http://weblogs.asp.net/george_v_reilly/archive/2004/12/13.aspx">octal</a>.</p>
<p><tt class="docutils literal">set /?</tt> explains <tt class="docutils literal">set /A</tt> arithmetic.
<tt class="docutils literal">call /?</tt> explains subroutine syntax and <tt class="docutils literal">goto :<span class="caps">EOF</span></tt>.</p>
<p>Extending this code so that it works past midnight
is left as the proverbial <a class="reference external" href="http://catb.org/%7Eesr/jargon/html/E/exercise--left-as-an.html">exercise for the reader</a>.</p>
</div>

    <footer>
        
        
            <p>tagged as
                <a href="/tag/cmd/" rel="tag">cmd</a>
                
            </p>
        
    </footer>
    <div class="comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = 'georgevreilly'; // required: replace example with your forum shortname

            // The following are highly recommended additional parameters. Remove the slashes in front to use.
            var disqus_identifier = "https://www.georgevreilly.com/blog/2005/08/11/TIMEStamping.html";
            var disqus_url = "https://www.georgevreilly.com/blog/2005/08/11/TIMEStamping.html";

            if (window.location.hostname != "localhost") {
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            }
        </script>
        <noscript>
            <p>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></p>
        </noscript>
        <a href="https://disqus.com" class="dsq-brlink">
            blog comments powered by <span class="logo-disqus">Disqus</span>
        </a>
        </div>
</article>


    
    
        <a href="/blog/2005/07/20/SurfaceIsIllusionButSoIsDepth.html" class="page floatright">
        Surface is Illusion but so is depth &raquo;
        </a>
    
    
        <a href="/blog/2005/08/26/AIDSWalk2005.html" class="page floatleft">
        &laquo; AIDS Walk 2005
        </a>
<footer>
    
    
    <p>written by <a href="mailto:george@reilly.org">George V. Reilly</a></p>
    <a href="http://creativecommons.org/licenses/by-nc-sa/2.0/de/" rel="copyright license">
        <img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="by-nc-sa" />
    </a>
    
    

  </footer>
</body>
</html>
