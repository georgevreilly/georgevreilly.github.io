<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>George V. Reilly</title>
  <link media="all" href="/style.css" rel="stylesheet" />
  <link media="all" href="/pygments.css" rel="stylesheet" />
  <link href="/favicon.ico" rel="shortcut icon" />
    <link href="/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">
  <link href="/" rel="home start" />
  <link href="/atom/" type="application/atom+xml" rel="alternate" title="Atom Feed" />
  <link href="/rss/" type="application/rss+xml" rel="alternate" title="RSS Feed" />
</head>
<body>
  <header>
    <h1><a href="/" rel="home start" class="blogtitle">George V. Reilly</a></h1>
    <nav>
      <ul>
        <li><a href="/blog/" rel="home start" title="George's full blog">blog</a></li>
        <li><a href="/til/" rel="home start" title="Today George Learned">TIL</a></li>
        <li><a href="/about/" rel="home start" title="About George">about</a></li>
        <li><a href="/atom/" rel="alternate" title="Atom Feed">atom</a></li>
        <li><a href="/rss/" rel="alternate" title="RSS Feed">rss</a></li>
        <li><a href="/articles/" rel="contents">articles</a></li>
        <li><a href="/tags/" rel="contents">tags</a></li>
      </ul>
    </nav>
  </header>
    
        <article>
    <header>
        <time datetime="2015-12-30">2015-12-30</time>
        <h1>
            <a href="/blog/2015/12/30/UseForPythonNestedListComprehensions.html" rel="bookmark canonical">Python: a use for nested list comprehensions</a>
        </h1>
    </header>
    <p>I wanted to turn a list like
<tt class="docutils literal"><span class="pre">['*.zip',</span> <span class="pre">'*.pyc',</span> <span class="pre">'*.log']</span></tt> into
<tt class="docutils literal"><span class="pre">['--exclude',</span> <span class="pre">'*.zip',</span> <span class="pre">'--exclude',</span> <span class="pre">'*.pyc',</span> <span class="pre">'--exclude',</span> <span class="pre">'*.log']</span></tt>.</p>
<p>A simple list com&shy;pre&shy;hen&shy;sion doesn't work as desired:</p>
<pre class="code pycon literal-block">
<span class="go">In [1]: excludes = ['*.zip', '*.pyc', '*.log']

In [2]: [('--exclude', e) for e in excludes]
Out[2]: [('--exclude', '*.zip'), ('--exclude', '*.pyc'), ('--exclude', '*.log')]</span>
</pre>
<p>The trick is to use a <a class="reference external" href="/blog/2009/03/20/FlatteningListComprehensionsInPython.html">nested com&shy;pre&shy;hen&shy;sion</a>:</p>
<pre class="code pycon literal-block">
<span class="go">In [5]: [arg for pattern in excludes
             for arg in ['--exclude', pattern]]
Out[5]: ['--exclude', '*.zip', '--exclude', '*.pyc', '--exclude', '*.log']</span>
</pre>

    <footer>
        
        
            <p>tagged as
                <a href="/tag/python/" rel="tag">python</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2015-12-23">2015-12-23</time>
        <h1>
            <a href="/blog/2015/12/23/ParseMinVerBash.html" rel="bookmark canonical">Checking minimum version numbers in Bash</a>
        </h1>
    </header>
    <a class="reference external image-reference" href="http://cube-drone.com/comics/c/version-sacrifice"></a>
<p>I worked on a Bash script today that sets up various pre&shy;req&shy;ui&shy;sites for our build.
We need a recent version of Docker
but our <a class="reference external" href="https://www.atlassian.com/software/bamboo/">Bamboo</a> build agents are running on Ubuntu 14.04,
which has a very old version of Docker.
The script upgrades Docker when it's first run.
The script may be run more than once during the lifetime of the agent,
so the second and subsequent calls should not upgrade Docker.</p>
<p>Basically, I wanted</p>
<pre class="code bash literal-block">
<span class="k">if</span> <span class="nv">$DOCKER_VERSION</span> &lt; <span class="m">1</span>.9<span class="p">;</span> <span class="k">then</span> upgrade_docker<span class="p">;</span> <span class="k">fi</span>
</pre>
<p>Un&shy;for&shy;tu&shy;nate&shy;ly, it's not that easy in Bash.
Here's what I came up with.</p>
<pre class="code bash literal-block">
install_latest_docker<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> docker --version <span class="p">|</span> python -c <span class="s2">&quot;min=[1, 9]; import sys; ↩
v=[int(x) </span></pre><span>&#8230;<a href="/blog/2015/12/23/ParseMinVerBash.html" class="continue">continue</a>.</span>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/bash/" rel="tag">bash</a>,
                <a href="/tag/python/" rel="tag">python</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2015-12-21">2015-12-21</time>
        <h1>
            <a href="/blog/2015/12/21/IncludingDataFilesInPythonPackages.html" rel="bookmark canonical">Including Data Files in Python Packages</a>
        </h1>
    </header>
    <p></p>
<blockquote>
[Pre&shy;vi&shy;ous&shy;ly published at the now defunct <a class="reference external" href="https://www.metabrite.com/devblog/posts/including-data-files-in-python-packages/">MetaBrite Dev Blog</a>.]</blockquote>
<p>I spent some time today struggling with <a class="reference external" href="https://setuptools.readthedocs.io/en/latest/">setuptools</a>,
trying to make a Python source package
not only include a data file,
but also <em>install</em> that file.</p>
<div class="section" id="building-the-installer">
<h2>Building the installer</h2>
<p>Consider the following source tree layout:</p>
<pre class="literal-block">
├── MANIFEST.in
├── README.md
├── my_stuff/
│&nbsp;&nbsp; ├── bar.py
│&nbsp;&nbsp; ├── foo.py
│&nbsp;&nbsp; ├── __init__.py
│&nbsp;&nbsp; └── quux.py
├── models/
│   └── long_ugly_name_20151221.json
└── setup.py*
</pre>
<p>I wanted to create a Python source dis&shy;tri&shy;b&shy;u&shy;tion, <tt class="docutils literal"><span class="pre">some_&shy;pack&shy;age-N.N.N.tar.gz</span></tt>,
which contains the code in the <tt class="docutils literal">my_stuff</tt> directory,
as well as <tt class="docutils literal">models/long_ug&shy;ly_&shy;name_20151221.json</tt>,
using <tt class="docutils literal">python setup.py sdist</tt>.</p>
<p>It's not that hard to get <tt class="docutils literal">models/long_ug&shy;ly_&shy;name_20151221.json</tt>
included in the tarball.
Add an entry in <tt class="docutils literal">MANIFEST.in</tt>:</p>
<pre class="literal-block">
include models/*.json
</pre>
<p>Then be sure to set <tt class="docutils literal">in&shy;clude_&shy;pack&shy;age_&shy;da&shy;ta=True</tt>
in the call to <tt class="docutils literal">setup()</tt>:</p>
<pre class="code python literal-block">
<span class="kn">from</span> <span class="nn">setuptools</span> </pre><span>&#8230;<a href="/blog/2015/12/21/IncludingDataFilesInPythonPackages.html" class="continue">continue</a>.</span></div>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/python/" rel="tag">python</a>,
                <a href="/tag/metabrite/" rel="tag">metabrite</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2015-12-15">2015-12-15</time>
        <h1>
            <a href="/blog/2015/12/15/PythonFStrings.html" rel="bookmark canonical">Python f-strings</a>
        </h1>
    </header>
    <p>At this month's <a class="reference external" href="http://www.meetup.com/PSPPython/">PuPPy (Puget Sound Pro&shy;gram&shy;ming Python) Meetup</a>,
I heard a brief mention of <a class="reference external" href="https://www.python.org/dev/peps/pep-0498/">Python f-strings</a>
as a new feature coming in Python 3.6.</p>
<p>In essence, they offer a simpler, more versatile method
of string formatting and in&shy;ter&shy;po&shy;la&shy;tion
over existing methods.
F-strings can include not only symbol names
but Python <em>ex&shy;pres&shy;sions</em> within strings.
With <a class="reference external" href="https://docs.python.org/3/library/string.html#formatstrings">str.format</a>, you can write
<tt class="docutils literal">'Hello, <span class="pre">{name}'.format(name=some_name)</span></tt>.
You can control various aspects of how <tt class="docutils literal">name</tt> is formatted,
such as being centered within a field—see <a class="reference external" href="https://pyformat.info/">PyFormat</a> and <a class="reference external" href="https://mkaz.blog/code/python-string-format-cookbook/">Python String Format Cookbook</a>
for ex&shy;am&shy;ples—but no more complex expression is allowed between the braces.</p>
<p>Herewith some examples of f-string ex&shy;pres&shy;sions
drawn from <a class="reference external" href="https://www.python.org/dev/peps/pep-0498/">PEP 0498</a>:</p>
<pre class="code pycon literal-block">
<span class="gp">&gt;&gt;&gt; </span><span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1991</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1"> was on a </span></pre><span>&#8230;<a href="/blog/2015/12/15/PythonFStrings.html" class="continue">continue</a>.</span>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/python/" rel="tag">python</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2015-12-05">2015-12-05</time>
        <h1>
            <a href="/blog/2015/12/05/python-print-formatting.html" rel="bookmark canonical">Python Print Formatting</a>
        </h1>
    </header>
    <p>On Stack&shy;Over&shy;flow, someone wanted to
<a class="reference external" href="http://stackoverflow.com/questions/34109838/for-while-loops-to-make-triangles">print triangles in Python</a>
in an M-shape.
Various clumsy solutions were offered.</p>
<p>Here's mine which uses the left- and right-jus&shy;ti&shy;fi&shy;ca&shy;tion features of
<a class="reference external" href="https://docs.python.org/2/library/string.html#formatstrings">str.format</a>.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">&quot;{0}+++{0}&quot;.format('Hello!')</span></tt> produces two copies of the zeroth argument to <tt class="docutils literal">format</tt>
(here <tt class="docutils literal">'Hello!'</tt>), separated by three plusses: <tt class="docutils literal"><span class="pre">Hello!+++Hello!</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">&quot;{:&lt;4}&quot;.format('x')</span></tt> left-justifies <tt class="docutils literal">'x'</tt> in a 4-character field; i.e., <tt class="docutils literal">'x&nbsp;&nbsp; '</tt>.</li>
<li><tt class="docutils literal"><span class="pre">&quot;{:&gt;4}&quot;.format('x')</span></tt> right-justifies <tt class="docutils literal">'x'</tt> in a 4-character field; i.e., <tt class="docutils literal">'&nbsp;&nbsp; x'</tt>.</li>
<li><tt class="docutils literal"><span class="pre">&quot;{:&gt;{}}&quot;.format('x',</span> width)</tt> right-justifies <tt class="docutils literal">'x'</tt> in a <tt class="docutils literal">width</tt>-character field.</li>
<li><tt class="docutils literal">'ab' * 4</tt> yields 4 copies of <tt class="docutils literal">'ab'</tt>; i.e., <tt class="docutils literal">'abababab'</tt>.</li>
</ul>
<p>Putting them together:</p>
<pre class="literal-block">
.. code:: pycon
</pre>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; WIDTH = 4
&gt;&gt;&gt;
&gt;&gt;&gt; for a in range(1, WIDTH+1):
...     print(&quot;{0:&lt;{1}}{0:&gt;{1}}&quot;.format('*' * a, WIDTH))
...
*      *
**   </pre><span>&#8230;<a href="/blog/2015/12/05/python-print-formatting.html" class="continue">continue</a>.</span></blockquote>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/python/" rel="tag">python</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2015-12-01">2015-12-01</time>
        <h1>
            <a href="/blog/2015/12/01/ExplainingEpilogFnmatchTranslate.html" rel="bookmark canonical">Explaining the epilog of fnmatch.translate, \Z(?ms)</a>
        </h1>
    </header>
    <p>I was debugging a <a class="reference external" href="http://stackoverflow.com/a/5141829/6364">filtering directory walker</a>
(on which, more to follow)
and I was trying to figure out
the mysterious suffix that
<a class="reference external" href="https://docs.python.org/2/library/fnmatch.html#fnmatch.translate">fnmatch.translate</a>
appends to its result,
<tt class="docutils literal"><span class="pre">\Z(?ms)</span></tt>.</p>
<p><tt class="docutils literal">fnmatch.translate</tt> takes a Unix-style glob,
like <tt class="docutils literal">*.py</tt> or <tt class="docutils literal"><span class="pre">test_*.py[cod]</span></tt>,
and translates it character-by-character into a regular expression.
It then appends <tt class="docutils literal"><span class="pre">\Z(?ms)</span></tt>.
Hence the latter glob becomes <tt class="docutils literal"><span class="pre">r'test\_.*\.py[cod]\Z(?ms)'</span></tt>,
using Python's raw string notation to avoid the
<a class="reference external" href="https://docs.python.org/2/howto/regex.html#the-backslash-plague">backslash plague</a>.
Also, the <tt class="docutils literal">?</tt> wildcard character becomes the <tt class="docutils literal">.</tt> regex special character,
while the <tt class="docutils literal">*</tt> wildcard becomes the <tt class="docutils literal">.*</tt> greedy regex.</p>
<p>A <a class="reference external" href="http://stackoverflow.com/a/11998653/6364">Stack&shy;Over&shy;flow answer partially explains</a>,
which set me on the right track.
<tt class="docutils literal"><span class="pre">(?ms)</span></tt> is equivalent to compiling the regex with <tt class="docutils literal">re.MULTILINE | re.DOTALL</tt>.
The <tt class="docutils literal">re.DOTALL</tt> modifier makes the <tt class="docutils literal">.</tt> special character
match <em>any</em> character,
including <span>&#8230;<a href="/blog/2015/12/01/ExplainingEpilogFnmatchTranslate.html" class="continue">continue</a>.</span></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/python/" rel="tag">python</a>,
                <a href="/tag/regex/" rel="tag">regex</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2015-09-20">2015-09-20</time>
        <h1>
            <a href="/blog/2015/09/20/RunSnakeRun-WxPython-Brew-Virtualenv.html" rel="bookmark canonical">RunSnakeRun (wxPython) apps in a Brew Virtualenv</a>
        </h1>
    </header>
    
<p>I'm doing some Python profiling
and I wanted to use the <a class="reference external" href="http://www.vrplumber.com/programming/runsnakerun/">Run&shy;SnakeRun</a> utility to view the profile data.
Un&shy;for&shy;tu&shy;nate&shy;ly, that's not straight&shy;for&shy;ward on Mac OS X if you use a <a class="reference external" href="https://virtualenv.pypa.io/en/latest/">virtualenv</a>,
and it's even less easy if you're using the Python
installed by the <a class="reference external" href="http://brew.sh/">Homebrew</a> (<tt class="docutils literal">brew</tt>) package manager.</p>
<p>There are several problems:</p>
<ul class="simple">
<li>Installing <a class="reference external" href="http://www.wxpython.org/">wxPython</a> on OS X 10.10.
This is the cross-platform GUI API toolkit used by Run&shy;SnakeRun.</li>
<li>Getting wxPython installed in a virtualenv</li>
<li>Running wxPython apps in a virtualenv on the Mac.</li>
</ul>
<div class="section" id="installing-wxpython">
<h2>Installing wxPython</h2>
<p>I downloaded <tt class="docutils literal"><span class="pre">wxPython3.0-osx-3.0.2.0-cocoa-py2.7.dmg</span></tt>,
released in November 2014.</p>
<p>If you open the DMG and attempt to run the PKG,
you will likely get a misleading error message from OS X:</p>
<blockquote>
“wxPython3.0-osx-cocoa-py2.7.pkg” <span>&#8230;<a href="/blog/2015/09/20/RunSnakeRun-WxPython-Brew-Virtualenv.html" class="continue">continue</a>.</span></blockquote></div>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/python/" rel="tag">python</a>,
                <a href="/tag/mac/" rel="tag">mac</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2015-03-02">2015-03-02</time>
        <h1>
            <a href="/blog/2015/03/02/NosetestsWontDiscoverExecutableFiles.html" rel="bookmark canonical">Nosetests won't discover tests in executable files</a>
        </h1>
    </header>
    <a class="reference external image-reference" href="http://nose.readthedocs.org/"></a>
<p>We use <a class="reference external" href="http://nose.readthedocs.org/">Nose</a> to run unit tests.
I noticed that we had some tests that weren't being run,
and it took me some time to work out why.
Eventually, I found this <a class="reference external" href="https://www.hyperink.com/blog/?p=22">checklist</a>,
which told me to &quot;make sure the files in your tests directory are not executable&quot;.</p>
<p>A quick <tt class="docutils literal">chmod <span class="pre">-x</span> *.py</tt> later and <tt class="docutils literal">nosetests project/tests</tt> suddenly found all the tests.</p>
<p>Now that I know what to look for, I found this in the Nose docs:</p>
<blockquote>
<p>It is important to note that the default behavior of nose
is to not include tests from files which are executable.</p>
<p><tt class="docutils literal"><span class="pre">--exe</span></tt>: Look for tests in python modules that are executable.
Normal behavior <span>&#8230;<a href="/blog/2015/03/02/NosetestsWontDiscoverExecutableFiles.html" class="continue">continue</a>.</span></p></blockquote>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/python/" rel="tag">python</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2015-01-28">2015-01-28</time>
        <h1>
            <a href="/blog/2015/01/28/PythonEggCache.html" rel="bookmark canonical">Python Egg Cache</a>
        </h1>
    </header>
    <p>Every so often, one of our <a class="reference external" href="https://www.atlassian.com/software/bamboo">Bamboo</a> builds would break thus:</p>
<pre class="literal-block">
pkg_resources.ExtractionError: Can't extract file(s) to egg cache

The following error occurred while trying to extract file(s) to the Python egg
cache:

  [Errno 17] File exists: '/home/bamboo/.python-eggs'

The Python egg cache directory is currently set to:

  /home/bamboo/.python-eggs

Perhaps your account does not have write access to this directory?  You can
change the cache directory by setting the PYTHON_EGG_CACHE environment
variable to point to an accessible directory.
</pre>
<p>This occurred while trying to make use of <a class="reference external" href="http://pycrypto.org">PyCrypto</a>.</p>
<p>After a little <a class="reference external" href="http://stackoverflow.com/questions/2192323/what-is-the-python-egg-cache-python-egg-cache">research</a>, I decided that instead of installing PyCrypto
as a zipped egg (as it does by default) into the <span>&#8230;<a href="/blog/2015/01/28/PythonEggCache.html" class="continue">continue</a>.</span></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/python/" rel="tag">python</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2015-01-25">2015-01-25</time>
        <h1>
            <a href="/blog/2015/01/25/PyCharmYosemite.html" rel="bookmark canonical">Running PyCharm on Yosemite</a>
        </h1>
    </header>
    <a class="reference external image-reference" href="https://www.jetbrains.com/pycharm/"></a>
<p>I did a <a class="reference external" href="/blog/2015/01/17/YosemiteCleanInstall.html">clean install of OS X 10.10</a> on my home laptop a week ago.
I tried to launch <a class="reference external" href="https://www.jetbrains.com/pycharm/">PyCharm</a> 4.0.4 on it today.
It im&shy;me&shy;di&shy;ate&shy;ly failed. Every time.</p>
<p>When I looked in the System Console, I saw:</p>
<pre class="literal-block">
1/25/15 7:46:00.557 PM pycharm[1160]: No matching VM found.
1/25/15 7:46:00.711 PM com.apple.xpc.launchd[1]: (com.jetbrains.pycharm.58252[1160]) Service exited with abnormal code: 1
</pre>
<p>The JetBrains website wasn't very helpful when I looked there.
In time, I found a <a class="reference external" href="http://stackoverflow.com/questions/26438628/crash-jetbrains-ide-with-yosemite-mac-osx-webstorm-intellij">Stack&shy;Over&shy;flow answer</a> that put me on the right track
(and reminded me that I had previously solved this problem about a year ago, at work).
PyCharm and some of the other JetBrains IDEs require JDK 1.6,
as <span>&#8230;<a href="/blog/2015/01/25/PyCharmYosemite.html" class="continue">continue</a>.</span></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/python/" rel="tag">python</a>,
                <a href="/tag/mac/" rel="tag">mac</a>,
                <a href="/tag/vim/" rel="tag">vim</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
    
        <a href="/tag/python/5/" class="page floatright">
        Previous &raquo;
        </a>
    
    
        <a href="/tag/python/3/" class="page floatleft">
        &laquo; Next
        </a>
<footer>
    
    
    <p>written by <a href="mailto:george@reilly.org">George V. Reilly</a></p>
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="copyright license">
        <img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="by-nc-sa" />
    </a>
    
    

  </footer>
</body>
</html>
