<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>George V. Reilly</title>
  <link media="all" href="/style.css" rel="stylesheet" />
  <link media="all" href="/pygments.css" rel="stylesheet" />
  <link href="/favicon.ico" rel="shortcut icon" />
    <link href="/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">
  <link href="/" rel="home start" />
  <link href="/atom/" type="application/atom+xml" rel="alternate" title="Atom Feed" />
  <link href="/rss/" type="application/rss+xml" rel="alternate" title="RSS Feed" />
</head>
<body>
  <header>
    <h1><a href="/" rel="home start" class="blogtitle">George V. Reilly</a></h1>
    <nav>
      <ul>
        <li><a href="/blog/" rel="home start">blog</a></li>
        <li><a href="/about/" rel="home start">about</a></li>
        <li><a href="/atom/" rel="alternate">atom</a></li>
        <li><a href="/rss/" rel="alternate">rss</a></li>
        <li><a href="/articles/" rel="contents">articles</a></li>
        <li><a href="/tags/" rel="contents">tags</a></li>
      </ul>
    </nav>
  </header>
    
        <article>
    <header>
        <time datetime="2016-01-31">2016-01-31</time>
        <h1>
            <a href="/blog/2016/01/31/URLsFromUnicodeStrings.html" rel="bookmark canonical">URLs from Unicode Strings</a>
        </h1>
    </header>
    <p></p>
<blockquote>
[Pre­vi­ous­ly published at the now defunct <a class="reference external" href="https://web.archive.org/web/20171001220321/http://devblog.metabrite.com/">MetaBrite Dev Blog</a>.]</blockquote>
<p>Some time ago,
we made an ill-considered decision to use recipe names for image URLs,
which simplified image management with our then-rudi­men­ta­ry tools.
For example, the recipe named
<tt class="docutils literal">"Twisted Pasta With Browned Butter, Sage, and Walnuts"</tt>
becomes a URL ending in
<tt class="docutils literal">"Twist­ed%20­Pas­ta%20With­%20Browned%20But­ter%2C%20Sage%2C%20and%20Wal­nuts.jpg"</tt>.</p>
<p>Life becomes more in­ter­est­ing when you escape the confines of 7-bit ASCII and use Unicode.
How should <tt class="docutils literal">u"Sautéed crème fraîche Provençale"</tt> be handled?
The only reasonable thing to do is to first convert the Unicode string to UTF-8
and then hex-encode those octets:
<tt class="docutils literal">"Saut%C3%A9ed%20cr%C3%A8me%20fra%C3%AEche%20Proven%C3%A7ale"</tt>.</p>
<p>That seems reasonable, but it was giving us in­con­sis­tent results
when the images were uploaded to an S3 bucket.
When <span>&#8230;<a href="/blog/2016/01/31/URLsFromUnicodeStrings.html" class="continue">continue</a>.</span></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/unicode/" rel="tag">unicode</a>,
                <a href="/tag/urls/" rel="tag">urls</a>
                    and
                    
                <a href="/tag/metabrite/" rel="tag">metabrite</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2016-01-04">2016-01-04</time>
        <h1>
            <a href="/blog/2016/01/04/PythonObfuscateUrlPassword.html" rel="bookmark canonical">Obfuscating Passwords in URLs in Python</a>
        </h1>
    </header>
    <p></p>
<blockquote>
[Pre­vi­ous­ly published at the now defunct <a class="reference external" href="https://web.archive.org/web/20171001220321/http://devblog.metabrite.com/">MetaBrite Dev Blog</a>.]</blockquote>
<p><a class="reference external" href="https://www.ietf.org/rfc/rfc1738.txt">RFC 1738</a> allows passwords in URLs,
in the form <tt class="docutils literal"><span class="pre"><scheme>://<username>:<pass&shy;word>@<host>:<port>/<url-path></url-path></port>.
Although passwords are deprecated by <a class="reference external" href="https://www.ietf.org/rfc/rfc3986.txt">RFC 3986</a> and other newer RFCs,
it's oc­ca­sion­al­ly useful.
Several important packages in the Python world allow such URLs,
including <a class="reference external" href="https://www.sqlalchemy.org/">SQLAlchemy</a> (<tt class="docutils literal"><span class="pre">'post­gresql://scott:tiger@lo­cal­host:5432/my­data­base'</span></tt>)
and <a class="reference external" href="https://docs.celeryproject.org/en/stable/">Celery</a> (<tt class="docutils literal"><span class="pre">'amqp://guest:guest@lo­cal­host:5672//'</span></tt>).
It's also useful to be able to log such URLs without exposing the password.</host>
<p>Python 2 has <a class="reference external" href="https://docs.python.org/2/library/urlparse.html#urlparse.urlparse">urlparse.urlparse</a>
(known as <a class="reference external" href="https://docs.python.org/3/library/urllib.parse.html#urllib.parse.urlparse">urllib.parse.urlparse</a> in Python 3
and <tt class="docutils literal">six.moves.url­lib_­parse.urlparse</tt> in the <a class="reference external" href="https://six.readthedocs.io/">Six</a> com­pat­i­bil­i­ty library)
to split a URL into six components,
<em>scheme</em>, <em>netloc</em>, <em>path</em>, <em>parameters</em>, <em>query</em>, and <em>fragment</em>.
The <em>netloc</em> cor­re­sponds to <tt class="docutils literal"><span class="pre"><user>:<pass&shy;word>@<host>:<port></port></host>.</pass&shy;word>
<p>Un­for­tu­nate­ly, neither Python 2 nor 3's <tt class="docutils literal">urlparse</tt>
properly handle the <em>userinfo</em>
(<em>username</em> + optional <em>password</em> in the <em>netloc</em>),
as <span>&#8230;<a href="/blog/2016/01/04/PythonObfuscateUrlPassword.html" class="continue">continue</a>.</span></p></user></span></tt></p></pass&shy;word></username></scheme></span></tt></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/python/" rel="tag">python</a>,
                <a href="/tag/urls/" rel="tag">urls</a>
                    and
                    
                <a href="/tag/metabrite/" rel="tag">metabrite</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
    
    
<footer>
    
    
    <p>written by <a href="mailto:george@reilly.org">George V. Reilly</a></p>
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="copyright license">
        <img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="by-nc-sa" />
    </a>
    
    

  </footer>
</body>
</html>
