<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>George V. Reilly</title>
  <link media="all" href="/style.css" rel="stylesheet" />
  <link media="all" href="/pygments.css" rel="stylesheet" />
  <link href="/favicon.ico" rel="shortcut icon" />
    <link href="/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">
  <link href="/" rel="home start" />
  <link href="/atom/" type="application/atom+xml" rel="alternate" title="Atom Feed" />
  <link href="/rss/" type="application/rss+xml" rel="alternate" title="RSS Feed" />
</head>
<body>
  <header>
    <h1><a href="/" rel="home start" class="blogtitle">George V. Reilly</a></h1>
    <nav>
      <ul>
        <li><a href="/blog/" rel="home start" title="George's full blog">blog</a></li>
        <li><a href="/til/" rel="home start" title="Today George Learned">TIL</a></li>
        <li><a href="/about/" rel="home start" title="About George">about</a></li>
        <li><a href="/atom/" rel="alternate" title="Atom Feed">atom</a></li>
        <li><a href="/rss/" rel="alternate" title="RSS Feed">rss</a></li>
        <li><a href="/articles/" rel="contents">articles</a></li>
        <li><a href="/tags/" rel="contents">tags</a></li>
      </ul>
    </nav>
  </header>
    
        <article>
    <header>
        <time datetime="2007-03-14">2007-03-14</time>
        <h1>
            <a href="/blog/2007/03/14/NVelocityLoadingTemplatesFromEmbeddedResources.html" rel="bookmark canonical">NVelocity: loading templates from embedded resources</a>
        </h1>
    </header>
    <a class="reference external image-reference" href="http://www.castleproject.org/others/nvelocity/index.html"></a>
<p>In last week's tip on
using the <a class="reference external" href="http://www.castleproject.org/others/nvelocity/index.html">NVelocity</a> template formatting engine,
I described what to set to load a template from
an <a class="reference external" href="/blog/2007/03/07/NVelocityTemplatesAndAbsolutePaths.html">absolute path</a>.</p>
<p>Here's the magic necessary to get NVelocity to load a template from an
embedded resource:</p>
<pre class="code csharp literal-block">
<span class="n">VelocityEngine</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VelocityEngine</span><span class="p">();</span><span class="w">
</span><span class="n">ExtendedProperties</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ExtendedProperties</span><span class="p">();</span><span class="w">
</span><span class="n">properties</span><span class="p">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="s">&quot;resource.loader&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;assembly&quot;</span><span class="p">);</span><span class="w">
</span><span class="n">properties</span><span class="p">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="s">&quot;assembly.resource.loader.class&quot;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;NVelocity.Runtime.Resource.Loader.AssemblyResourceLoader, NVelocity&quot;</span><span class="p">);</span><span class="w">
</span><span class="n">properties</span><span class="p">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="s">&quot;assembly.resource.loader.assembly&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;StencilFormatter&quot;</span><span class="p">);</span><span class="w">
</span><span class="n">engine</span><span class="p">.</span><span class="n">Init</span><span class="p">(</span><span class="n">properties</span><span class="p">);</span>
</pre>

    <footer>
        
        
            <p>tagged as
                <a href="/tag/net/" rel="tag">.NET</a>,
                <a href="/tag/c-sharp/" rel="tag">c-sharp</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2007-03-07">2007-03-07</time>
        <h1>
            <a href="/blog/2007/03/07/NVelocityTemplatesAndAbsolutePaths.html" rel="bookmark canonical">NVelocity templates and absolute paths</a>
        </h1>
    </header>
    <a class="reference external image-reference" href="http://www.castleproject.org/others/nvelocity/index.html"></a>
<p>We've started using the <a class="reference external" href="http://www.castleproject.org/others/nvelocity/index.html">NVelocity</a> template formatting engine.
We were absolutely stymied for an hour, trying to figure
out how to get it working with an absolute path to the template file,
instead of the relative path shown in the <a class="reference external" href="http://www.castleproject.org/others/nvelocity/usingit.html">doc&shy;u&shy;men&shy;ta&shy;tion</a>.</p>
<p>The trick is to set <tt class="docutils literal">file.resource.loader.path</tt>.
Here's how to load <tt class="docutils literal"><span class="pre">C:\foo\bar\&shy;some&shy;file.vm</span></tt>:</p>
<pre class="code csharp literal-block">
<span class="n">ExtendedProperties</span><span class="w"> </span><span class="n">props</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ExtendedProperties</span><span class="p">();</span><span class="w">
</span><span class="n">props</span><span class="p">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="s">&quot;file.resource.loader.path&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">string</span><span class="p">[]{</span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C:\\&quot;</span><span class="p">}));</span><span class="w">
</span><span class="n">velocity</span><span class="p">.</span><span class="n">Init</span><span class="p">(</span><span class="n">props</span><span class="p">);</span><span class="w">

</span><span class="n">template</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">velocity</span><span class="p">.</span><span class="n">GetTemplate</span><span class="p">(</span><span class="s">&quot;foo\\bar\\somefile.vm&quot;</span><span class="p">);</span>
</pre>

    <footer>
        
        
            <p>tagged as
                <a href="/tag/net/" rel="tag">.NET</a>,
                <a href="/tag/c-sharp/" rel="tag">c-sharp</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2007-02-07">2007-02-07</time>
        <h1>
            <a href="/blog/2007/02/07/PrintfN.html" rel="bookmark canonical">Printf %n</a>
        </h1>
    </header>
    
<p>In my post about <a class="reference external" href="/blog/2005/06/02/PrintfTricks.html">Printf Tricks</a> a couple of years ago,
I mentioned that &quot;<tt class="docutils literal">%n</tt> is dangerous and disabled by default in Visual Studio 2005.&quot;</p>
<p>I got email today from someone who was porting a large codebase to VS 2005.
He was getting an assert from <tt class="docutils literal">%n</tt> and he needed a way to get past it.
He intends to fix the uses of <tt class="docutils literal">%n</tt> when he has a chance.</p>
<p>I spent several minutes digging around in MSDN and came up with
<a class="reference external" href="http://msdn2.microsoft.com/en-us/library/ms175782(VS.80).aspx">set_print&shy;f_&shy;coun&shy;t_out&shy;put</a>. Wikipedi&shy;a's <a class="reference external" href="http://en.wikipedia.org/wiki/Format_string_attack">Format string attack</a> page
led me to <a class="reference external" href="http://julianor.tripod.com/bc/formatstring-1.2.pdf">Exploiting Format String Vul&shy;ner&shy;a&shy;bil&shy;i&shy;ties</a>, which
describes in detail how <tt class="docutils literal">%n</tt> (and <tt class="docutils literal">%s</tt>) may be exploited.</p>
<p>In short, if you <span>&#8230;<a href="/blog/2007/02/07/PrintfN.html" class="continue">continue</a>.</span></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/security/" rel="tag">security</a>,
                <a href="/tag/c/" rel="tag">c</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2007-01-18">2007-01-18</time>
        <h1>
            <a href="/blog/2007/01/18/StringPod.html" rel="bookmark canonical">The String Pod</a>
        </h1>
    </header>
    <a class="reference external image-reference" href="http://www.flickr.com/photos/george_v_reilly/sets/72157594486191381/"></a>
<p>I recently learned about <a class="reference external" href="http://www.flickr.com/photos/photophool/119574325/">string pods</a> and <a class="reference external" href="http://flickr.com/photos/coffeefromhell/sets/72157594215569637/">chain pods</a>.
In essence, they are pocket-sized monopods.
You screw a six-foot string into the tripod socket of your camera,
step on the other end of the string,
and pull it taut.
The tension on the string reduces camera shake.</p>
<a class="reference external image-reference" href="http://www.flickr.com/photos/george_v_reilly/sets/72157594486191381/"></a>
<p><a class="reference external" href="http://www.flickr.com/photos/george_v_reilly/sets/72157594486191381/">My string pod tutorial</a> shows how I made the string pod,
as well as some before and after shots.</p>
<p>Before now, I used to try to find a handy surface or wall
to brace the camera, when taking photos without flash.
Often there isn't such a surface.
I have a little 3-inch pocket tripod that I carry with me all the time,
but I haven't <span>&#8230;<a href="/blog/2007/01/18/StringPod.html" class="continue">continue</a>.</span></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/photography/" rel="tag">photography</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2006-12-29">2006-12-29</time>
        <h1>
            <a href="/blog/2006/12/29/PythonBatchfileWrapper.html" rel="bookmark canonical">Python Batchfile Wrapper</a>
        </h1>
    </header>
    
<p>I've been getting into Python lately. One problem that I've en&shy;coun&shy;tered
under Windows, is that input redi&shy;rec&shy;tion doesn't work if you use
the <tt class="docutils literal">.py</tt> file as&shy;so&shy;ci&shy;a&shy;tion to run the script; e.g.:</p>
<pre class="literal-block">
C:\&gt; foo.py &lt; input.txt
</pre>
<p>There's a well-known <a class="reference external" href="http://mail.python.org/pipermail/python-bugs-list/2004-August/024920.html">input redi&shy;rec&shy;tion bug</a>. The fix is to explicitly use
<tt class="docutils literal">python.exe</tt> to run the script.</p>
<p>A related problem for me was that <tt class="docutils literal">stdin</tt> was opened as a <em>text</em> file,
not a <em>binary</em> file, so <tt class="docutils literal">\r</tt> bytes were being discarded from binary input
files. The fix is to run <tt class="docutils literal">python.exe <span class="pre">-u</span></tt> (unbuffered binary input and
output).</p>
<p>I didn't want to hardcode the path to <tt class="docutils literal">python.exe</tt> in a batch file,
so I came up with the <span>&#8230;<a href="/blog/2006/12/29/PythonBatchfileWrapper.html" class="continue">continue</a>.</span></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/python/" rel="tag">python</a>,
                <a href="/tag/cmd/" rel="tag">cmd</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2006-09-14">2006-09-14</time>
        <h1>
            <a href="/blog/2006/09/14/NeverSleep0InAnInfiniteLoop.html" rel="bookmark canonical">Never Sleep(0) in an Infinite Loop</a>
        </h1>
    </header>
    
<p>I ran into a problem installing some COM+ components today. The installer
was using <a class="reference external" href="http://msdn2.microsoft.com/en-us/library/04za0hca.aspx">Regsvcs.exe</a>
to register each COM+ component. I noticed after a while that the installer
wasn't making any progress and that my dual-proc system was stuck at 50%
CPU uti&shy;liza&shy;tion. I attached a debugger to the offending process, regsvcs,
and found that it was stuck in the following infinite loop
(dis&shy;as&shy;sem&shy;bly courtesy of <a class="reference external" href="http://www.aisto.com/roeder/dotnet/">Reflector</a>):</p>
<pre class="code csharp literal-block">
<span class="k">internal</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">EnterpriseServices</span><span class="p">.</span><span class="n">CatalogSync</span><span class="p">.</span><span class="n">Wait</span><span class="p">()</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">_set</span><span class="p">)</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="n">RegistryKey</span><span class="w"> </span><span class="n">key1</span><span class="w">
      </span><span class="p">=</span><span class="w"> </span><span class="n">Registry</span><span class="p">.</span><span class="n">LocalMachine</span><span class="p">.</span><span class="n">OpenSubKey</span><span class="p">(</span><span class="s">&#64;&quot;SOFTWARE\Classes\CLSID&quot;</span><span class="p">);</span><span class="w">
    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="k">true</span><span class="p">)</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="kt">int</span><span class="w"> </span><span class="n">num1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">key1</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;CLBVersion&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">);</span><span class="w">
 </span></pre><span>&#8230;<a href="/blog/2006/09/14/NeverSleep0InAnInfiniteLoop.html" class="continue">continue</a>.</span>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/c-sharp/" rel="tag">c-sharp</a>,
                <a href="/tag/windows/" rel="tag">windows</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2006-08-29">2006-08-29</time>
        <h1>
            <a href="/blog/2006/08/29/UsingLog4NetFromACOMApplication.html" rel="bookmark canonical">Using Log4Net from a COM+ Application</a>
        </h1>
    </header>
    <a class="reference external image-reference" href="https://logging.apache.org/log4net/"></a>
<p>I spent far too much time on Friday trying to make <a class="reference external" href="https://logging.apache.org/log4net/">log4net</a> work in a COM+ ap&shy;pli&shy;ca&shy;tion.</p>
<p>Someone else had done part of the work necessary,
by creating an <a class="reference external" href="http://blogs.msdn.com/florinlazar/archive/2003/12/04/41369.aspx">ap&shy;pli&shy;ca&shy;tion.config</a> for the COM+ ap&shy;pli&shy;ca&shy;tion
and setting a custom Ap&shy;pli&shy;ca&shy;tion Root Directory.
This was enough to ensure that most of the managed code in the ap&shy;pli&shy;ca&shy;tion
got their con&shy;fig&shy;u&shy;ra&shy;tion settings;
log4net being the exception.</p>
<p>It took some additional work to realize that we needed to add two assembly attributes:</p>
<pre class="literal-block">
[assembly: log4net.Config.Repository(&quot;unique-name&quot;)]
[assembly: log4net.Config.XmlConfigurator(ConfigFile=&quot;application.config&quot;)]
</pre>
<p>The repository name just needs to be a unique string.
We used the name of the assembly.</p>

    <footer>
        
        
            <p>tagged as
                <a href="/tag/net/" rel="tag">.NET</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2006-06-06">2006-06-06</time>
        <h1>
            <a href="/blog/2006/06/06/Aeropress.html" rel="bookmark canonical">Aerobie AeroPress</a>
        </h1>
    </header>
    
<p><a class="reference external" href="http://www.aerobie.com/Products/aeropress.htm">Aerobie AeroPress home page</a></p>
<p><a class="reference external" href="http://www.coffeegeek.com/forums/coffee/machines/211692?Page=1">CoffeeGeek thread</a></p>
<p><a class="reference external" href="http://www.coffeegeek.com/forums/coffee/machines/212595#212595">Adler's American recipe</a></p>
<p><a class="reference external" href="http://www.coffeegeek.com/forums/coffee/machines/212810#212810">Luke&shy;Seu&shy;bert's Smooth Americano recipe</a></p>
<p>I like my Americano made with 175F water to the top of the &quot;2&quot; oval, with
our standard ten-second stir, and press with no steep time.  Then diluted
1:1 after pressing.</p>
<p>Mark likes his brewed with much hotter water, with a 40 second steep time
and he likes to push all of the water through the press, rather than
diluting aftewards.   His recipe has much more edge (which I might call
bitterness).</p>
<p><a class="reference external" href="http://www.sweetmarias.com/aeropress_instructions.html">Sweet Maria's in&shy;struc&shy;tions</a></p>
<p><a class="reference external" href="http://www.coffeegeek.com/forums/coffee/machines/211692#211692">Lots of reviews</a></p>
<p><a class="reference external" href="http://www.coffeegeek.com/forums/coffee/machines/213535#213535">Lack of 'soul'</a></p>
<p><a class="reference external" href="http://www.coffeegeek.com/forums/coffee/machines/215670#215670">Negative pressure</a></p>
<p><a class="reference external" href="http://www.coffeegeek.com/forums/coffee/machines/216036#216036">Neutral pressure</a></p>
<p><a class="reference external" href="http://www.josuma.com/what.shtml">Espresso definition</a></p>
<p><a class="reference external" href="http://www.coffeegeek.com/opinions/barista/10-14-2006">Crema</a></p>
<p>&quot;Espresso strength&quot;</p>
<p>I find that the drip-through, even with long steep or long stir times,
isn't <span>&#8230;<a href="/blog/2006/06/06/Aeropress.html" class="continue">continue</a>.</span></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/coffee/" rel="tag">coffee</a>,
                <a href="/tag/tech/" rel="tag">tech</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2006-05-16">2006-05-16</time>
        <h1>
            <a href="/blog/2006/05/16/0xFFFF100x1999.html" rel="bookmark canonical">0xFF...FF / 10 == 0x19...99</a>
        </h1>
    </header>
    
<p>A few weeks ago, I wrote a C++ routine to parse decimal numbers using the
overflow detection principles of
<a class="reference external" href="http://msdn.microsoft.com/library/en-us/dncode/html/secure01142004.asp">SafeInt</a>.
I couldn't find anything in the libraries that actually did a good job of checking
for overflow.</p>
<p>Briefly, to see if <tt class="docutils literal">unsigned</tt> values <tt class="docutils literal">A+B</tt> overflow, check
<tt class="docutils literal">if (A &gt; MAX_UINT - B)</tt>. Similarly, <tt class="docutils literal">A*B</tt> will overflow
<tt class="docutils literal">if (A &gt; MAX_UINT / B)</tt>.</p>
<pre class="code cpp literal-block">
<span class="c1">// Convert a string to an unsigned. Returns 'true' iff conversion is legitimate.
</span><span class="kt">bool</span><span class="w">
</span><span class="nf">StringToUnsigned</span><span class="p">(</span><span class="w">
    </span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w">
    </span><span class="kt">unsigned</span><span class="o">&amp;</span><span class="w">     </span><span class="n">rUint</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="n">rUint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">

    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w">
        </span></pre><span>&#8230;<a href="/blog/2006/05/16/0xFFFF100x1999.html" class="continue">continue</a>.</span>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/c++/" rel="tag">c++</a>,
                <a href="/tag/octal/" rel="tag">octal</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2006-05-04">2006-05-04</time>
        <h1>
            <a href="/blog/2006/05/04/VimSyntaxHighlightingForFlexWiki.html" rel="bookmark canonical">Vim Syntax Highlighting for FlexWiki</a>
        </h1>
    </header>
    <p>We use <a class="reference external" href="http://www.flexwiki.com/">FlexWiki</a> at work. It's an
ASP.NET-based <a class="reference external" href="http://wiki.org/wiki.cgi?WhatIsWiki">wiki</a>,
a low-overhead, organic way of sharing knowledge.</p>

<p>The only built-in means of editing a page in FlexWiki is to
type into an HTML textbox, which is a horrendous user experience.
There's no WYSIWYG feedback showing you whether you've got the wiki markup
right.</p>
<p>Back in December, Emma and I went to the Oregon coast for a week.
We had no Internet access and long dark evenings, so I spent quite a bit of
time on my laptop, working on a couple of projects. One was a new theme
(skin) for DasBlog, which I didn't finish to my sat&shy;is&shy;fac&shy;tion. I really
ought to <span>&#8230;<a href="/blog/2006/05/04/VimSyntaxHighlightingForFlexWiki.html" class="continue">continue</a>.</span></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/vim/" rel="tag">vim</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
    
        <a href="/tag/til/11/" class="page floatright">
        Previous &raquo;
        </a>
    
    
        <a href="/tag/til/9/" class="page floatleft">
        &laquo; Next
        </a>
<footer>
    
    
    <p>written by <a href="mailto:george@reilly.org">George V. Reilly</a></p>
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="copyright license">
        <img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="by-nc-sa" />
    </a>
    <script data-goatcounter="https://georgevreilly.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>
    
    

  </footer>
</body>
</html>
