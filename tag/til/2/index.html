<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>George V. Reilly</title>
  <link media="all" href="/style.css" rel="stylesheet" />
  <link media="all" href="/pygments.css" rel="stylesheet" />
  <link href="/favicon.ico" rel="shortcut icon" />
    <link href="/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">
  <link href="/" rel="home start" />
  <link href="/atom/" type="application/atom+xml" rel="alternate" title="Atom Feed" />
  <link href="/rss/" type="application/rss+xml" rel="alternate" title="RSS Feed" />
</head>
<body>
  <header>
    <h1><a href="/" rel="home start" class="blogtitle">George V. Reilly</a></h1>
    <nav>
      <ul>
        <li><a href="/blog/" rel="home start" title="George's full blog">blog</a></li>
        <li><a href="/til/" rel="home start" title="Today George Learned">TIL</a></li>
        <li><a href="/about/" rel="home start" title="About George">about</a></li>
        <li><a href="/atom/" rel="alternate" title="Atom Feed">atom</a></li>
        <li><a href="/rss/" rel="alternate" title="RSS Feed">rss</a></li>
        <li><a href="/articles/" rel="contents">articles</a></li>
        <li><a href="/tags/" rel="contents">tags</a></li>
      </ul>
    </nav>
  </header>
    
        <article>
    <header>
        <time datetime="2017-01-31">2017-01-31</time>
        <h1>
            <a href="/blog/2017/01/31/NegativeCircledDigits.html" rel="bookmark canonical">Negative Circled Digits</a>
        </h1>
    </header>
    <p>I found something very useful in the <a class="reference external" href="http://graphemica.com/blocks/dingbats">dingbats</a> range of Unicode characters:
the negative circled san-serif digits, ➊ ➋ ➌ ➍ ➎ ➏ ➐ ➑ ➒ ➓ .</p>
<p>I've started using them to label points of interest in code.
They play well with the <tt class="docutils literal"><span class="pre">code-block</span></tt> directive in re&shy;Struc&shy;tured&shy;Text.</p>
<pre class="code bash literal-block">
sudo docker images --format <span class="s1">'{{.Repository}}:{{.Tag}}'</span> <span class="se">\ </span>   ➊
    <span class="p">|</span> grep <span class="nv">$IMAGE_NAME</span> <span class="se">\ </span>                                   ➋
    </pre><span>&#8230;<a href="/blog/2017/01/31/NegativeCircledDigits.html" class="continue">continue</a>.</span>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/writing/" rel="tag">writing</a>,
                <a href="/tag/tech/" rel="tag">tech</a>,
                <a href="/tag/font/" rel="tag">font</a>,
                <a href="/tag/blogging/" rel="tag">blogging</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2017-01-30">2017-01-30</time>
        <h1>
            <a href="/blog/2017/01/30/JsonDataFromDockerImages.html" rel="bookmark canonical">JSON data from Docker Images</a>
        </h1>
    </header>
    <p>I was trying to get some structured in&shy;for&shy;ma&shy;tion from <tt class="docutils literal">docker images</tt>,
hoping to replace some ugly Sed and AWK trickery.
I could have used the <a class="reference external" href="https://docker-py.readthedocs.io/en/stable/">docker-py</a> library.
Instead I chose to use the poorly documented <tt class="docutils literal"><span class="pre">--format</span></tt> option to <tt class="docutils literal">docker images</tt>
(and some other Docker CLI commands).
Adrian Mouat gives some useful starting points at <a class="reference external" href="http://container-solutions.com/docker-inspect-template-magic/">Docker Inspect Template Magic</a>
and notes that formatting is built around <a class="reference external" href="https://golang.org/pkg/text/template/">Go templates</a>.</p>
<p>I quickly figured out that this format would meet my immediate need.</p>
<pre class="code bash literal-block">
sudo docker images --format <span class="s1">'{{.Repository}}:{{.Tag}}'</span> <span class="se">\
</span>    <span class="p">|</span> grep <span class="nv">$IMAGE_NAME</span> <span class="se">\
</span>    <span class="p">|</span> grep -v latest <span class="se">\
</span>    <span class="p">|</span> head -1
</pre>
<p>That's fine, but <span>&#8230;<a href="/blog/2017/01/30/JsonDataFromDockerImages.html" class="continue">continue</a>.</span></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/docker/" rel="tag">docker</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2017-01-19">2017-01-19</time>
        <h1>
            <a href="/blog/2017/01/19/BashEchoSuccessOfPreviousCommand.html" rel="bookmark canonical">Bash: echo success of previous command</a>
        </h1>
    </header>
    <p>C-like languages have a ternary operator,
<tt class="docutils literal">cond ? true_re&shy;sult : false_re&shy;sult</tt>.
Python has <tt class="docutils literal">true_re&shy;sult if cond else false_re&shy;sult</tt>.
Bash doesn't have a ternary operator, but there are <a class="reference external" href="http://stackoverflow.com/a/3953712/6364">various workarounds</a>.</p>
<p>I wanted to print <tt class="docutils literal">succeeded</tt> or <tt class="docutils literal">failed</tt>
based on the exit code of the previous command
in a shell script.
In Unix, all programs exit with an integer status code.
Successful programs exit with <tt class="docutils literal">0</tt>;
all other values, positive or negative, indicate <a class="reference external" href="http://www-numi.fnal.gov/offline_software/srt_public_context/WebDocs/Errors/unix_system_errors.html">failure</a>.
In Bash, the <a class="reference external" href="http://tldp.org/LDP/abs/html/exit-status.html">status code</a> of the previous program is held in <tt class="docutils literal">$?</tt>.</p>
<pre class="code bash literal-block">
some/command or-other fer example

<span class="nv">STATUS</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$?</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="m">0</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s1">'succeeded'</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s1">'failed'</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Results: </span><span class="nv">$STATUS</span><span class="s2">&quot;</span>
</pre>
<p>There are <a class="reference external" href="http://stackoverflow.com/a/3953712/6364">other ways</a> to handle this.</p>

    <footer>
        
        
            <p>tagged as
                <a href="/tag/bash/" rel="tag">bash</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2017-01-15">2017-01-15</time>
        <h1>
            <a href="/blog/2017/01/15/GitFileModes.html" rel="bookmark canonical">Git File Modes</a>
        </h1>
    </header>
    <p>Ever wonder what the six-digit file modes are in a Git commit?
The mysterious <tt class="docutils literal">100644</tt> and <tt class="docutils literal">100755</tt> modes?</p>
<pre class="code diff literal-block">
<span class="gh">diff --git a/foo/bar.py b/foo/bar.py</span><span class="w">
old mode 100644
new mode 100755
</span><span class="gh">index b829edea4..ee6bda024</span><span class="w">
</span><span class="gd">--- a/foo/bar.py</span><span class="w">
</span><span class="gi">+++ b/foo/bar.py</span><span class="w">
</span><span class="gu">&#64;&#64; -1,3 +1,4 &#64;&#64;</span><span class="w">
...</span>
</pre>
<p>I had made <tt class="docutils literal">foo/bar.py</tt> executable by using <tt class="docutils literal">chmod +x</tt>
and adding a <tt class="docutils literal"><span class="pre">#!/usr/bin/env</span> python</tt> shebang.
The last three digits are obviously the same <a class="reference external" href="http://weblogs.asp.net/george_v_reilly/archive/2004/12/13/284388.aspx">octal</a> digits that you can use with <tt class="docutils literal">chmod</tt>.
But what's that <tt class="docutils literal">100</tt> prefix?</p>
<p>The ex&shy;pla&shy;na&shy;tion can be found in a <a class="reference external" href="http://stackoverflow.com/a/8347325/6364">Stack&shy;Over&shy;flow answer</a>:</p>
<pre class="literal-block">
100644₈  regular file (non-executable)  S_IFREG | S_IRUSR | S_IWUSR
                     </pre><span>&#8230;<a href="/blog/2017/01/15/GitFileModes.html" class="continue">continue</a>.</span>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/git/" rel="tag">git</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2017-01-13">2017-01-13</time>
        <h1>
            <a href="/blog/2017/01/13/ComputedParallelBranchesInJenkinsPipeline.html" rel="bookmark canonical">Computed Parallel Branches in Jenkins Pipeline</a>
        </h1>
    </header>
    <p>I've been using Jenkins lately,
setting up <a class="reference external" href="https://jenkins.io/solutions/pipeline/">Pipeline</a> builds.
I have mixed feelings about that,
but I'm quite liking Groovy.</p>
<p>Here's an example of a <tt class="docutils literal">Closure</tt> called <tt class="docutils literal">ac&shy;cep&shy;tance_in&shy;te&shy;gra&shy;tion_tests</tt>,
where the <tt class="docutils literal">re&shy;lease_lev&shy;el</tt> parameter is a <tt class="docutils literal">String</tt>
which must be either <tt class="docutils literal">&quot;dev&quot;</tt> or <tt class="docutils literal">&quot;prod&quot;</tt>.</p>
<pre class="code groovy literal-block">
<span class="kt">def</span><span class="w"> </span><span class="n">acceptance_integration_tests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">release_level</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="k">assert</span><span class="w"> </span><span class="n">release_level</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="s">/^(dev|prod)$/</span><span class="w">
    </span><span class="n">String</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;--${release_level}&quot;</span><span class="w">

    </span><span class="kt">def</span><span class="w"> </span><span class="n">branches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="w">
        </span><span class="s2">&quot;${release_level}_acceptance_tests&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">{</span><span class="w">
            </span><span class="n">run_tests</span><span class="o">(</span><span class="s2">&quot;ci_acceptance_test&quot;</span><span class="o">,</span><span class="w"> </span><span class="n">arg</span><span class="o">,</span><span class="w"> </span><span class="s1">'**/*nosetests.xml'</span><span class="o">)</span><span class="w">
        </span><span class="o">},</span><span class="w">
       </span></pre><span>&#8230;<a href="/blog/2017/01/13/ComputedParallelBranchesInJenkinsPipeline.html" class="continue">continue</a>.</span>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/jenkins/" rel="tag">jenkins</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2017-01-11">2017-01-11</time>
        <h1>
            <a href="/blog/2017/01/11/DiffTransformedFile.html" rel="bookmark canonical">Diff a Transformed File</a>
        </h1>
    </header>
    <p>I wanted to diff two files.
One of them needed some <tt class="docutils literal">sed</tt>s on each line and sorting.
I wanted to do that on the fly,
without leaving a massaged in&shy;ter&shy;me&shy;di&shy;ate file lying around.</p>
<pre class="code bash literal-block">
colordiff --unified &lt;<span class="o">(</span>cat orphaned_permalinks.txt
                        <span class="p">|</span> sed <span class="s1">'s&#64;http://www.georgevreilly.com/&#64;&#64;'</span>
                        <span class="p">|</span> sed <span class="s1">'s/.aspx$/.html/'</span>
                </pre><span>&#8230;<a href="/blog/2017/01/11/DiffTransformedFile.html" class="continue">continue</a>.</span>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/programming/" rel="tag">programming</a>,
                <a href="/tag/bash/" rel="tag">bash</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2017-01-10">2017-01-10</time>
        <h1>
            <a href="/blog/2017/01/10/LKRhashScalableHashTables.html" rel="bookmark canonical">LKRhash: Scalable Hash Tables</a>
        </h1>
    </header>
    <p>LKRhash is a hashtable that scales to multiple processors and to millions of items.
LKRhash was invented at Microsoft in 1997
by Per-Åke (Paul) Larson of Microsoft Research
and Murali Krishnan and George Reilly of Internet In&shy;for&shy;ma&shy;tion Services.
LKRhash has been used in many Microsoft products.
The techniques that give LKRhash its per&shy;for&shy;mance
include <a class="reference external" href="https://en.wikipedia.org/wiki/Linear_hashing">linear hashing</a>, cache-friendly data structures, and fine-grained locking.</p>
<ul class="simple">
<li><a class="reference external" href="http://nwcpp.org/june-2012.html">Northwest C++ Users' Group talk</a>, June 2012. <a class="reference external" href="https://speakerdeck.com/georgevreilly/lkrhash-the-design-of-a-scalable-hashtable">Speaker Deck Slides</a>.</li>
<li><a class="reference external" href="/content/LKRhash-for-SoftwarePE.pdf">Un&shy;pub&shy;lished paper</a> submitted to <a class="reference external" href="http://www.wiley.com/WileyCDA/WileyTitle/productCd-SPE.html">Software: Practice &amp; Experience</a> (Oct 1999).</li>
<li><a class="reference external" href="https://patents.google.com/patent/US6578131B1/en">US 6,578,131 patent</a>. Associated <a class="reference external" href="https://www.google.com/patents/US6578131.pdf">PDF</a> contains some of the SP&amp;E paper.</li>
</ul>
<p>If Microsoft had had <a class="reference external" href="https://qz.com/115831/googles-20-time-which-brought-you-gmail-and-adsense-is-now-as-good-as-dead/">20% time</a>,
LKRhash would have been my main 20% project.
I put a lot of <span>&#8230;<a href="/blog/2017/01/10/LKRhashScalableHashTables.html" class="continue">continue</a>.</span></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/hashtables/" rel="tag">hashtables</a>,
                <a href="/tag/performance/" rel="tag">performance</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2017-01-05">2017-01-05</time>
        <h1>
            <a href="/blog/2017/01/05/GitPruningUnusedBranches.html" rel="bookmark canonical">Git: pruning unused branches</a>
        </h1>
    </header>
    <p>Ever had a Git repository where there's an over&shy;whelm&shy;ing number of branches,
most of which are surely abandoned?
You run <tt class="docutils literal">git branch <span class="pre">--remote</span></tt> and you see dozens of unfamiliar branches.
Where to begin?</p>
<ul class="simple">
<li>Use <a class="reference external" href="http://stackoverflow.com/a/11144311/6364">git for-each-ref --sort</a> to sort the branches
so that you can identify the oldest branches.</li>
<li>Use <a class="reference external" href="http://stackoverflow.com/a/227026/6364">git branch --remote --merged master</a>
to detect which branches have already been merged into <tt class="docutils literal">master</tt>.
It's likely that these are branches that weren't deleted
after a pull request was merged;
it's usually safe to delete these.</li>
<li><tt class="docutils literal"><span class="pre">--no-merged</span></tt> shows unmerged branches;
these require further in&shy;ves&shy;ti&shy;ga&shy;tion.</li>
</ul>
<p>Here's an example for <a class="reference external" href="https://github.com/cookbrite/flyingcloud">fly&shy;ing&shy;cloud</a>:</p>
<pre class="code console literal-block">
<span class="gp">$ </span>git <span class="k">for</span>-each-ref --sort<span class="o">=</span>-committerdate <span class="se">\
</span>    --format<span class="o">=</span><span class="s1">'%(committerdate:short) %(refname)'</span> refs/heads refs/remotes
<span class="go">2016-12-29 refs/remotes/origin/master
2016-12-29 refs/remotes/origin/HEAD
2016-12-29 refs/heads/master
2016-12-11 </span></pre><span>&#8230;<a href="/blog/2017/01/05/GitPruningUnusedBranches.html" class="continue">continue</a>.</span>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/git/" rel="tag">git</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2017-01-04">2017-01-04</time>
        <h1>
            <a href="/blog/2017/01/04/MarkdownLivePreview.html" rel="bookmark canonical">Markdown Live Preview</a>
        </h1>
    </header>
    <p>It's very useful when creating <a class="reference external" href="https://guides.github.com/features/mastering-markdown/">Markdown</a> to be able to preview it live.
For example, creating a complex pull request or a <tt class="docutils literal">README.md</tt>.
I usually use the built-in <a class="reference external" href="https://github.com/atom/markdown-preview">Atom Markdown Preview</a> package in <a class="reference external" href="https://atom.io/">Atom</a>.
Just type <tt class="docutils literal">⌃⇧M</tt> (aka <tt class="docutils literal">Ctrl+Shift+M</tt>) to see a live preview in an adjacent pane.
I use <a class="reference external" href="https://atom.io/packages/vim-mode-plus">vim-mode-plus</a> to edit in Atom,
which provides an acceptable emulation of Vim.</p>
<p>I recently discovered <a class="reference external" href="https://code.visualstudio.com/Docs/languages/markdown">VS Code Markdown Preview</a> in <a class="reference external" href="https://code.visualstudio.com/">Visual Studio Code</a>.
Type <tt class="docutils literal">⌘K&nbsp;V</tt> (aka <tt class="docutils literal">Ctrl+K&nbsp;V</tt> on Windows or Linux)
to invoke the side-by-side live preview.
I use <a class="reference external" href="https://github.com/VSCodeVim/Vim">VSCodeVim</a> to meet my Vim needs.</p>
<p>Un&shy;for&shy;tu&shy;nate&shy;ly, neither previewer gives identical results to GitHub's Markdown renderer.
GitHub itself seems to use different <span>&#8230;<a href="/blog/2017/01/04/MarkdownLivePreview.html" class="continue">continue</a>.</span></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/tech/" rel="tag">tech</a>,
                <a href="/tag/writing/" rel="tag">writing</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
        <article>
    <header>
        <time datetime="2016-09-06">2016-09-06</time>
        <h1>
            <a href="/blog/2016/09/06/AlembicDataMigrations.html" rel="bookmark canonical">Alembic: Data Migrations</a>
        </h1>
    </header>
    <p>We use <a class="reference external" href="http://alembic.zzzcomputing.com/en/latest/">Alembic</a> to perform schema migrations
whenever we add (or drop) tables or columns
from our databases.
It's less well known that Alembic can also perform data migrations,
updating existing data in tables.</p>
<p>Here's an example adapted from a migration I put together this afternoon.
I added a non-NULL Boolean <tt class="docutils literal">stooge</tt> column to the <tt class="docutils literal">old_timers</tt> table,
with a default value of <tt class="docutils literal">FALSE</tt>.
I wanted to update certain rows to have <tt class="docutils literal">stooge=TRUE</tt> as part of the migration.
The following works with PostgreSQL.</p>
<p>Note the <tt class="docutils literal">server_de&shy;fault=sa.false()</tt> in the de&shy;c&shy;la&shy;ra&shy;tion of the <tt class="docutils literal">stooge</tt> column,
which is needed to initially set all instances of <tt class="docutils literal">stooge=FALSE</tt>.
I then declare a <tt class="docutils literal">table</tt> which has only the two <span>&#8230;<a href="/blog/2016/09/06/AlembicDataMigrations.html" class="continue">continue</a>.</span></p>
    <footer>
        
        
            <p>tagged as
                <a href="/tag/python/" rel="tag">python</a>,
                <a href="/tag/sql/" rel="tag">sql</a>
                    and
                    
                <a href="/tag/til/" rel="tag">til</a>
                
            </p>
        
    </footer>
    <div class="comments"></div>
</article>


    
    
        <a href="/tag/til/3/" class="page floatright">
        Previous &raquo;
        </a>
    
    
        <a href="/tag/til/" class="page floatleft">
        &laquo; Next
        </a>
<footer>
    
    
    <p>written by <a href="mailto:george@reilly.org">George V. Reilly</a></p>
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="copyright license">
        <img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="by-nc-sa" />
    </a>
    <script data-goatcounter="https://georgevreilly.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>
    
    

  </footer>
</body>
</html>
