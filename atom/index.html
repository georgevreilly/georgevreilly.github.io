<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="https://www.w3.org/2005/Atom" xml:lang="en">
    <author>
        <name>George V. Reilly</name>
        <uri>https://www.georgevreilly.com/</uri>
        <email>george@reilly.org</email>
    </author>
    <title>George V. Reilly</title>
    <id>tag:www.georgevreilly.com,2011-06-11:/atom/</id>
    <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/" />
    <link rel="self" type="application/atom+xml" href="https://www.georgevreilly.com/atom/" />
    <icon>https://www.georgevreilly.com/favicon.ico</icon>
    <logo>https://www.georgevreilly.com/feed-logo.png</logo>
    <updated>2023-02-21T08:00:00Z</updated>
    <generator uri="https://github.com/posativ/acrylamid/" version="0.8.dev0">acrylamid</generator>
        <entry>
        <title>Compressing Tar Files in Parallel</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2023/02/21/CompressingTarFilesInParallel.html" />
        <id>tag:www.georgevreilly.com,2023-02-21:/blog/2023/02/21/CompressingTarFilesInParallel.html</id>
        <updated>2023-02-21T08:00:00Z</updated>
        <category term="linux" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;p&gt;TL;DR: use &lt;tt class=&#34;docutils literal&#34;&gt;tar &lt;span class=&#34;pre&#34;&gt;-I&lt;/span&gt; pigz&lt;/tt&gt; or &lt;tt class=&#34;docutils literal&#34;&gt;tar &lt;span class=&#34;pre&#34;&gt;-I&lt;/span&gt; lbzip2&lt;/tt&gt;
to compress large tar files much more quickly.&lt;/p&gt;
&lt;p&gt;I investigated various ways of compressing a 7GiB tar file.&lt;/p&gt;
&lt;p&gt;The built-in &lt;tt class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;--gzip&lt;/span&gt;&lt;/tt&gt; and &lt;tt class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;--bzip2&lt;/span&gt;&lt;/tt&gt; compression methods in GNU &lt;tt class=&#34;docutils literal&#34;&gt;tar&lt;/tt&gt;
are single-threaded.
If you invoke an external compressor with &lt;tt class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;--use-compress-program&lt;/span&gt;&lt;/tt&gt;,
you can get some huge reductions in compression time,
with slightly worse compression ratios.&lt;/p&gt;
&lt;p&gt;You can use &lt;a class=&#34;reference external&#34; href=&#34;https://zlib.net/pigz/&#34;&gt;pigz&lt;/a&gt; as a parallel replacement for &lt;tt class=&#34;docutils literal&#34;&gt;gzip&lt;/tt&gt;
and &lt;a class=&#34;reference external&#34; href=&#34;https://linux.die.net/man/1/lbzip2&#34;&gt;lbzip2&lt;/a&gt; as a parallel version of &lt;tt class=&#34;docutils literal&#34;&gt;bzip2&lt;/tt&gt;.
Both of them will make heavy use of all the cores in your system,
greatly reducing the &lt;em&gt;real&lt;/em&gt; time relative to the &lt;em&gt;user&lt;/em&gt; time.&lt;/p&gt;
&lt;p&gt;Single-threaded compression timing:
&lt;tt class=&#34;docutils literal&#34;&gt;gzip&lt;/tt&gt; is a lot faster than &lt;tt class=&#34;docutils literal&#34;&gt;bzip2&lt;/tt&gt;:&lt;/p&gt;
&lt;pre class=&#34;literal-block&#34;&gt;
$ time tar --bzip2 -cf huge-bzip2.tar.bz2 hugedir

real    13m15.352s
user    12m53.972s
sys     0m16.029s

$ time tar --gzip -cf huge-gzip.tar.gz hugedir

real    5m56.489s
user    5m30.271s
sys     0m14.633s
&lt;/pre&gt;
&lt;p&gt;&lt;tt class=&#34;docutils literal&#34;&gt;fast&lt;/tt&gt; parallel compression timing:
&lt;tt class=&#34;docutils literal&#34;&gt;pigz&lt;/tt&gt; is the clear winner:&lt;/p&gt;
&lt;pre class=&#34;literal-block&#34;&gt;
$ time tar --use-compress-program=&#39;lbzip2 --fast&#39; \
    -cf huge-lbzip2-fast.tar.bz2 hugedir

real    2m35.967s
user    11m38.865s
sys     0m26.981s

$ time tar --use-compress-program=&#39;pigz --fast&#39; \
    -cf huge-pigz-fast.tar.gz hugedir

real    0m58.222s
user    3m22.134s
sys     0m17.357s
&lt;/pre&gt;
&lt;p&gt;&lt;tt class=&#34;docutils literal&#34;&gt;best&lt;/tt&gt; parallel compression timing:
&lt;tt class=&#34;docutils literal&#34;&gt;lbzip2&lt;/tt&gt; is much quicker than &lt;tt class=&#34;docutils literal&#34;&gt;pigz&lt;/tt&gt;:&lt;/p&gt;
&lt;pre class=&#34;literal-block&#34;&gt;
$ time tar --use-compress-program=&#39;lbzip2 --best&#39; \
    -cf huge-lbzip2-best.tar.bz2 hugedir

real    1m44.365s
user    11m38.277s
sys     0m13.551s

$ time tar --use-compress-program=&#39;pigz --best&#39; \
    -cf huge-pigz-best.tar.gz hugedir

real    2m27.694s
user    16m20.441s
sys     0m16.092s
&lt;/pre&gt;
&lt;p&gt;Compressed file sizes:
&lt;tt class=&#34;docutils literal&#34;&gt;bzip2&lt;/tt&gt; family compresses better than &lt;tt class=&#34;docutils literal&#34;&gt;gzip&lt;/tt&gt; family;
&lt;tt class=&#34;docutils literal&#34;&gt;best&lt;/tt&gt; is smaller than default compression level which is smaller than &lt;tt class=&#34;docutils literal&#34;&gt;fast&lt;/tt&gt;:&lt;/p&gt;
&lt;pre class=&#34;literal-block&#34;&gt;
$ ls -lSr
-rw-r--r-- 1 user group 2460438578 Feb 22 03:03 huge-lbzip2-best.tar.bz2
-rw-r--r-- 1 user group 2461172874 Feb 22 03:19 huge-bzip2.tar.bz2
-rw-r--r-- 1 user group 2689784220 Feb 22 03:00 huge-lbzip2-fast.tar.bz2
-rw-r--r-- 1 user group 2691286852 Feb 22 03:06 huge-pigz-best.tar.gz
-rw-r--r-- 1 user group 2704591997 Feb 22 03:25 huge-gzip.tar.gz
-rw-r--r-- 1 user group 2950547862 Feb 22 03:01 huge-pigz-fast.tar.gz
-rw-r--r-- 1 user group 7365222400 Feb 22 03:00 huge.tar
&lt;/pre&gt;
</content>
    </entry>
    
        <entry>
        <title>Implementing the Tree command in Rust, part 2: Printing Trees</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2023/01/24/TreeInRust2PrintingTrees.html" />
        <id>tag:www.georgevreilly.com,2023-01-24:/blog/2023/01/24/TreeInRust2PrintingTrees.html</id>
        <updated>2023-01-24T08:00:00Z</updated>
        <category term="rust" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;p&gt;In &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2023/01/23/TreeInRust1WalkDirectories.html&#34;&gt;Part 1&lt;/a&gt;, we saw how to walk directory trees,
recursively using &lt;tt class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;fs::read_dir&lt;/span&gt;&lt;/tt&gt;
to construct an in-memory tree of &lt;tt class=&#34;docutils literal&#34;&gt;FileNode&lt;/tt&gt;s.
In Part 2, we&#39;ll implement the rest of the core of the &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Tree_(command)&#34;&gt;tree command&lt;/a&gt;:
printing the directory tree with &lt;a class=&#34;reference external&#34; href=&#34;https://www.compart.com/en/unicode/block/U+2500&#34;&gt;Box Drawing&lt;/a&gt; characters.&lt;/p&gt;
&lt;p&gt;Let&#39;s take a look at some output from &lt;tt class=&#34;docutils literal&#34;&gt;tree&lt;/tt&gt;:&lt;/p&gt;
&lt;pre class=&#34;literal-block&#34;&gt;
.
├── alloc.rs
├── ascii.rs
├── os
│&amp;nbsp;&amp;nbsp; ├── wasi
│&amp;nbsp;&amp;nbsp; │&amp;nbsp;&amp;nbsp; ├── ffi.rs
│&amp;nbsp;&amp;nbsp; │&amp;nbsp;&amp;nbsp; ├── mod.rs          ➊
│&amp;nbsp;&amp;nbsp; │&amp;nbsp;&amp;nbsp; └── net             ➋
│&amp;nbsp;&amp;nbsp; │&amp;nbsp;&amp;nbsp;     └── mod.rs
│&amp;nbsp;&amp;nbsp; └── windows
│&amp;nbsp;&amp;nbsp;     ├── ffi.rs          ➌
│&amp;nbsp;&amp;nbsp;     ├── fs.rs
│&amp;nbsp;&amp;nbsp;     ├── io
│&amp;nbsp;&amp;nbsp;     │&amp;nbsp;&amp;nbsp; └── tests.rs
│&amp;nbsp;&amp;nbsp;     ├── mod.rs
│&amp;nbsp;&amp;nbsp;     └── thread.rs
├── personality
│&amp;nbsp;&amp;nbsp; ├── dwarf
│&amp;nbsp;&amp;nbsp; │&amp;nbsp;&amp;nbsp; ├── eh.rs
│&amp;nbsp;&amp;nbsp; │&amp;nbsp;&amp;nbsp; ├── mod.rs
│&amp;nbsp;&amp;nbsp; │&amp;nbsp;&amp;nbsp; └── tests.rs
│&amp;nbsp;&amp;nbsp; ├── emcc.rs
│&amp;nbsp;&amp;nbsp; └── gcc.rs
└── personality.rs
&lt;/pre&gt;
&lt;p&gt;The first thing that we notice is that
most entries at any level, such as ➊,
are preceded by &lt;tt class=&#34;docutils literal&#34;&gt;├──&lt;/tt&gt;,
while the last entry, ➋, is preceded by &lt;tt class=&#34;docutils literal&#34;&gt;└──&lt;/tt&gt;.
This &lt;a class=&#34;reference external&#34; href=&#34;https://realpython.com/directory-tree-generator-python/&#34;&gt;article&lt;/a&gt; about building a directory tree generator
in Python calls them the &lt;em&gt;tee&lt;/em&gt; and &lt;em&gt;elbow&lt;/em&gt; connectors,
and I&#39;m going to use that terminology.&lt;/p&gt;
&lt;p&gt;The second thing we notice is that there are
multiple &lt;em&gt;prefixes&lt;/em&gt; before the connectors,
either &lt;tt class=&#34;docutils literal&#34;&gt;│&amp;nbsp;&amp;nbsp;&lt;/tt&gt;&amp;nbsp;(&lt;em&gt;pipe&lt;/em&gt;) or
&lt;tt class=&#34;docutils literal&#34;&gt;&amp;nbsp;&amp;nbsp; &lt;/tt&gt;&amp;nbsp;(&lt;em&gt;space&lt;/em&gt;),
one prefix for each level.
The rule is that children of a last entry,
such as &lt;tt class=&#34;docutils literal&#34;&gt;os/windows&lt;/tt&gt; ➌, get the space prefix,
while children of other entries,
such as &lt;tt class=&#34;docutils literal&#34;&gt;os/wasi&lt;/tt&gt; or &lt;tt class=&#34;docutils literal&#34;&gt;personality&lt;/tt&gt;,
get the pipe prefix.&lt;/p&gt;
&lt;p&gt;For both connectors and prefixes,
the last entry at a particular level gets special treatment.&lt;/p&gt;
&lt;div class=&#34;section&#34; id=&#34;the-print-tree-function&#34;&gt;
&lt;h3&gt;The &lt;tt class=&#34;docutils literal&#34;&gt;print_tree&lt;/tt&gt; function&lt;/h3&gt;
&lt;p&gt;A classic technique with recursion is to create a pair of functions:
an outer public function that calls a private helper function
with the initial set of parameters to visit recursively.&lt;/p&gt;
&lt;p&gt;Our &lt;tt class=&#34;docutils literal&#34;&gt;print_tree&lt;/tt&gt; function uses an inner &lt;tt class=&#34;docutils literal&#34;&gt;visit&lt;/tt&gt; function
to recursively do almost all of the work.&lt;/p&gt;
&lt;pre class=&#34;code rust literal-block&#34;&gt;
&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;print_tree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dir&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;Directory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OTHER_CHILD&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;│   &amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// prefix: pipe
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OTHER_ENTRY&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;├── &amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// connector: tee
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FINAL_CHILD&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;    &amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// prefix: no more siblings
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FINAL_ENTRY&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;└── &amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// connector: elbow
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;fm&#34;&gt;println!&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;{}&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                           &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➊&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;visit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;fm&#34;&gt;println!&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;{} directories, {} files&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;

    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;visit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;Directory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;-&amp;gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;usize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;usize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➋&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;mut&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dirs&lt;/span&gt;: &lt;span class=&#34;kt&#34;&gt;usize&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// counting this directory         ➌
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;mut&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;files&lt;/span&gt;: &lt;span class=&#34;kt&#34;&gt;usize&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;mut&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;entries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                         &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➍&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;entry&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;entries&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connector&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FINAL_ENTRY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OTHER_ENTRY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➎&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;entry&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FileTree&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;DirNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sub_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                     &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➏&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                    &lt;/span&gt;&lt;span class=&#34;fm&#34;&gt;println!&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;{}{}{}&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sub_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new_prefix&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;fm&#34;&gt;format!&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                       &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➐&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                        &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;{}{}&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FINAL_CHILD&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OTHER_CHILD&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;visit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sub_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➑&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dirs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;files&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FileTree&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;LinkNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;symlink&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                    &lt;/span&gt;&lt;span class=&#34;fm&#34;&gt;println!&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                        &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;{}{}{} -&amp;gt; {}&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;symlink&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;symlink&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;files&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FileTree&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;FileNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                    &lt;/span&gt;&lt;span class=&#34;fm&#34;&gt;println!&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;{}{}{}&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;files&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dirs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;files&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                               &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➒&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;ol class=&#34;arabic simple&#34;&gt;
&lt;li&gt;The outer function, &lt;tt class=&#34;docutils literal&#34;&gt;print_tree&lt;/tt&gt;,
simply prints the name of the root node on a line by itself;
calls the inner &lt;tt class=&#34;docutils literal&#34;&gt;visit&lt;/tt&gt; function with the &lt;tt class=&#34;docutils literal&#34;&gt;dir&lt;/tt&gt; node and an empty prefix;
and finally prints the number of directories and files visited.
This is for compatibility with the output of &lt;tt class=&#34;docutils literal&#34;&gt;tree&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;The inner &lt;tt class=&#34;docutils literal&#34;&gt;visit&lt;/tt&gt; function takes two parameters:
&lt;tt class=&#34;docutils literal&#34;&gt;node&lt;/tt&gt;, a &lt;tt class=&#34;docutils literal&#34;&gt;Directory&lt;/tt&gt;, and
&lt;tt class=&#34;docutils literal&#34;&gt;prefix&lt;/tt&gt;, a string which is initially empty.&lt;/li&gt;
&lt;li&gt;Keep track of the number of &lt;tt class=&#34;docutils literal&#34;&gt;dirs&lt;/tt&gt; and &lt;tt class=&#34;docutils literal&#34;&gt;files&lt;/tt&gt; seen at this level
and in sub-directories.&lt;/li&gt;
&lt;li&gt;We count downwards from the number of entries in this directory to zero.
When &lt;tt class=&#34;docutils literal&#34;&gt;count&lt;/tt&gt; is zero, we are on the last entry, which gets special treatment.&lt;/li&gt;
&lt;li&gt;Compute the connector,
&lt;tt class=&#34;docutils literal&#34;&gt;└──&lt;/tt&gt; (&lt;em&gt;elbow&lt;/em&gt;) for the last entry;
&lt;tt class=&#34;docutils literal&#34;&gt;├──&lt;/tt&gt; (&lt;em&gt;tee&lt;/em&gt;) otherwise.&lt;/li&gt;
&lt;li&gt;Match the &lt;tt class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;FileTree::DirNode&lt;/span&gt;&lt;/tt&gt; variant
and &lt;a class=&#34;reference external&#34; href=&#34;https://doc.rust-lang.org/reference/patterns.html#destructuring&#34;&gt;destructure&lt;/a&gt; the value into &lt;tt class=&#34;docutils literal&#34;&gt;sub_dir&lt;/tt&gt;, a &lt;tt class=&#34;docutils literal&#34;&gt;&amp;amp;Directory&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;Before recursively visiting a sub-directory,
we compute a new prefix,
by appending the appropriate sub-prefix to the current prefix.
If there are further entries (&lt;tt class=&#34;docutils literal&#34;&gt;count &amp;gt; 0&lt;/tt&gt;),
the sub-prefix for the current level is &lt;tt class=&#34;docutils literal&#34;&gt;│&amp;nbsp;&amp;nbsp;&lt;/tt&gt;&amp;nbsp;(&lt;em&gt;pipe&lt;/em&gt;);
otherwise, it&#39;s &lt;tt class=&#34;docutils literal&#34;&gt;&amp;nbsp;&amp;nbsp; &lt;/tt&gt;&amp;nbsp;(&lt;em&gt;spaces&lt;/em&gt;).&lt;/li&gt;
&lt;li&gt;Call &lt;tt class=&#34;docutils literal&#34;&gt;visit&lt;/tt&gt; recursively, then add to the
running totals of &lt;tt class=&#34;docutils literal&#34;&gt;dirs&lt;/tt&gt; and &lt;tt class=&#34;docutils literal&#34;&gt;files&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;tt class=&#34;docutils literal&#34;&gt;visit&lt;/tt&gt; returns a tuple of the counts of directories and files
that were recursively visited.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;One subtlety that is not obvious from the above is that
&lt;tt class=&#34;docutils literal&#34;&gt;OTHER_CHILD&lt;/tt&gt; actually contains two &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Non-breaking_space&#34;&gt;non-breaking spaces&lt;/a&gt;:&lt;/p&gt;
&lt;pre class=&#34;code rust literal-block&#34;&gt;
&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OTHER_CHILD&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;│&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\u{00A0}\u{00A0}&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; &amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// prefix: pipe&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;This is for compatibility with the output of &lt;tt class=&#34;docutils literal&#34;&gt;tree&lt;/tt&gt;:&lt;/p&gt;
&lt;pre class=&#34;code bash literal-block&#34;&gt;
$ diff &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;cargo run -q -- ./tests&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;tree ./tests&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;no difference&amp;quot;&lt;/span&gt;
no difference
&lt;/pre&gt;
&lt;p&gt;Using &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2022/01/31/DiffFileFragment.html&#34;&gt;process substitution&lt;/a&gt; to generate two different inputs for &lt;tt class=&#34;docutils literal&#34;&gt;diff&lt;/tt&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section&#34; id=&#34;the-main-function&#34;&gt;
&lt;h3&gt;The &lt;tt class=&#34;docutils literal&#34;&gt;main&lt;/tt&gt; function&lt;/h3&gt;
&lt;p&gt;Let&#39;s tie it all together.&lt;/p&gt;
&lt;pre class=&#34;code rust literal-block&#34;&gt;
&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;-&amp;gt; &lt;span class=&#34;nc&#34;&gt;io&lt;/span&gt;::&lt;span class=&#34;nb&#34;&gt;Result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;env&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unwrap_or&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➊&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dir&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;Directory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dir_walk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                              &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➋&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PathBuf&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;clone&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                           &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➌&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_not_hidden&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sort_by_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                         &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➍&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;print_tree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                    &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➎&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Ok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(())&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                                      &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➏&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;ol class=&#34;arabic simple&#34;&gt;
&lt;li&gt;The simplest possible way to get a single, optional command-line argument.
If omitted, we default to &lt;tt class=&#34;docutils literal&#34;&gt;.&lt;/tt&gt;, the current directory.
For more sophisticated argument parsing, we could use &lt;a class=&#34;reference external&#34; href=&#34;https://docs.rs/clap/latest/clap/&#34;&gt;Clap&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Use &lt;tt class=&#34;docutils literal&#34;&gt;dir_walk&lt;/tt&gt; from &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2023/01/23/TreeInRust1WalkDirectories.html&#34;&gt;Part 1&lt;/a&gt; to recursively build
a directory of &lt;tt class=&#34;docutils literal&#34;&gt;FileTree&lt;/tt&gt; nodes.&lt;/li&gt;
&lt;li&gt;Create a &lt;tt class=&#34;docutils literal&#34;&gt;PathBuf&lt;/tt&gt; from &lt;tt class=&#34;docutils literal&#34;&gt;root&lt;/tt&gt;, a string;
&lt;tt class=&#34;docutils literal&#34;&gt;clone&lt;/tt&gt; is needed because &lt;tt class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;PathBuf::from&lt;/span&gt;&lt;/tt&gt; takes ownership of the string buffer.
Use the &lt;tt class=&#34;docutils literal&#34;&gt;is_not_hidden&lt;/tt&gt; filter and the &lt;tt class=&#34;docutils literal&#34;&gt;sort_by_name&lt;/tt&gt; comparator from &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2023/01/23/TreeInRust1WalkDirectories.html&#34;&gt;Part 1&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;The &lt;a class=&#34;reference external&#34; href=&#34;https://doc.rust-lang.org/reference/expressions/operator-expr.html#the-question-mark-operator&#34;&gt;postfix question mark operator&lt;/a&gt;, &lt;tt class=&#34;docutils literal&#34;&gt;?&lt;/tt&gt;, is used to propagate errors.&lt;/li&gt;
&lt;li&gt;Let &lt;tt class=&#34;docutils literal&#34;&gt;print_tree&lt;/tt&gt; draw the diagram.&lt;/li&gt;
&lt;li&gt;Return the &lt;tt class=&#34;docutils literal&#34;&gt;Ok&lt;/tt&gt; &lt;a class=&#34;reference external&#34; href=&#34;https://doc.rust-lang.org/std/primitive.unit.html&#34;&gt;unit&lt;/a&gt; result to indicate success.&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class=&#34;section&#34; id=&#34;baum&#34;&gt;
&lt;h3&gt;Baum&lt;/h3&gt;
&lt;p&gt;You can find the &lt;a class=&#34;reference external&#34; href=&#34;https://github.com/georgevreilly/baum&#34;&gt;Baum&lt;/a&gt; source code on GitHub.&lt;/p&gt;
&lt;p&gt;In Part 3, we&#39;ll discuss testing.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section&#34; id=&#34;resources&#34;&gt;
&lt;h3&gt;Resources&lt;/h3&gt;
&lt;ul class=&#34;simple&#34;&gt;
&lt;li&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://github.com/Old-Man-Programmer/tree/&#34;&gt;Official tree source&lt;/a&gt;:
The actual source for &lt;tt class=&#34;docutils literal&#34;&gt;tree&lt;/tt&gt;, written in old-school C.&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://two-wrongs.com/draw-a-tree-structure-with-only-css.html&#34;&gt;Draw a Tree Structure With Only CSS&lt;/a&gt;:
Use CSS to draw links in nested, unordered lists.&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://realpython.com/directory-tree-generator-python/&#34;&gt;Build a Python Directory Tree Generator for the Command Line&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Kevin Newton has implemented &lt;a class=&#34;reference external&#34; href=&#34;https://github.com/kddnewton/tree&#34;&gt;Tree in Multiple Languages&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://github.com/dduan/tre&#34;&gt;Tre&lt;/a&gt; is a modern alternative to &lt;tt class=&#34;docutils literal&#34;&gt;tree&lt;/tt&gt; in Rust.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content>
    </entry>
    
        <entry>
        <title>Implementing the Tree command in Rust, part 1: Walking Directories</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2023/01/23/TreeInRust1WalkDirectories.html" />
        <id>tag:www.georgevreilly.com,2023-01-23:/blog/2023/01/23/TreeInRust1WalkDirectories.html</id>
        <updated>2023-01-23T08:00:00Z</updated>
        <category term="rust" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;img alt=&#34;tree tree core/src/num for Rust&#34; class=&#34;right-float&#34; src=&#34;https://www.georgevreilly.com/content/binary/rust-core-src-num-tree.png&#34; style=&#34;width: 160px;&#34;/&gt;
&lt;p&gt;I&#39;ve been learning Rust lately.
I started by reading several books,
including &lt;a class=&#34;reference external&#34; href=&#34;https://www.manning.com/books/rust-in-action&#34;&gt;Rust in Action&lt;/a&gt;,
&lt;a class=&#34;reference external&#34; href=&#34;https://www.manning.com/books/code-like-a-pro-in-rust&#34;&gt;Code Like a Pro in Rust&lt;/a&gt;,
and most of &lt;a class=&#34;reference external&#34; href=&#34;https://learning.oreilly.com/library/view/programming-rust-2nd/9781492052586/&#34;&gt;Programming Rust&lt;/a&gt;.
Now, I&#39;m starting to actually write code.&lt;/p&gt;
&lt;p&gt;I read the &lt;a class=&#34;reference external&#34; href=&#34;https://www.goodreads.com/review/show/5183138397&#34;&gt;Command-Line Rust&lt;/a&gt; book last month,
which challenged readers to write
our own implementations of the &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Tree_(command)&#34;&gt;tree command&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I decided to accept the challenge.&lt;/p&gt;
&lt;p&gt;At its simplest, &lt;tt class=&#34;docutils literal&#34;&gt;tree&lt;/tt&gt; simply prints a directory tree,
using some of the Unicode &lt;a class=&#34;reference external&#34; href=&#34;https://www.compart.com/en/unicode/block/U+2500&#34;&gt;Box Drawing&lt;/a&gt; characters
to show the hierarchical relationship,
as in the image at right.&lt;/p&gt;
&lt;p&gt;I&#39;ve split the code into two phases,
which will be covered in two blog posts.&lt;/p&gt;
&lt;ol class=&#34;arabic simple&#34;&gt;
&lt;li&gt;Walking the directory tree on disk to build an in-memory tree.&lt;/li&gt;
&lt;li&gt;Pretty-printing the in-memory tree.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;While it&#39;s certainly possible to print a subtree as it&#39;s being read,
separating the two phases
yields code that is cleaner, simpler, and more testable.&lt;/p&gt;
&lt;p&gt;In future, I will insert a third phase, &lt;em&gt;processing&lt;/em&gt;,
between the reading and writing phases,
by a weak analogy with Extract-Transform-Load (&lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Extract,_transform,_load&#34;&gt;ETL&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&#34;section&#34; id=&#34;walking-the-directory-tree&#34;&gt;
&lt;h3&gt;Walking the Directory Tree&lt;/h3&gt;
&lt;p&gt;There are three kinds of file tree node that I care about:
&lt;tt class=&#34;docutils literal&#34;&gt;File&lt;/tt&gt;, &lt;tt class=&#34;docutils literal&#34;&gt;Directory&lt;/tt&gt;, and &lt;tt class=&#34;docutils literal&#34;&gt;Symlink&lt;/tt&gt;.
These are the variants exposed by Rust&#39;s &lt;a class=&#34;reference external&#34; href=&#34;https://doc.rust-lang.org/std/fs/struct.FileType.html&#34;&gt;FileType&lt;/a&gt;.&lt;/p&gt;
&lt;ul class=&#34;simple&#34;&gt;
&lt;li&gt;&lt;tt class=&#34;docutils literal&#34;&gt;File&lt;/tt&gt; has a name and file system metadata;&lt;/li&gt;
&lt;li&gt;&lt;tt class=&#34;docutils literal&#34;&gt;Symlink&lt;/tt&gt; has a name, a target, and metadata;&lt;/li&gt;
&lt;li&gt;&lt;tt class=&#34;docutils literal&#34;&gt;Directory&lt;/tt&gt; has a name and a list of child file tree nodes.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here, &lt;em&gt;name&lt;/em&gt; refers to the last component of a path;
e.g., the &lt;tt class=&#34;docutils literal&#34;&gt;gamma&lt;/tt&gt; in &lt;tt class=&#34;docutils literal&#34;&gt;alpha/beta/gamma&lt;/tt&gt;.
The file system metadata is not currently used,
but will be in future.&lt;/p&gt;
&lt;pre class=&#34;code rust literal-block&#34;&gt;
&lt;span class=&#34;cp&#34;&gt;#[derive(Debug)]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;File&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;metadata&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;fs&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;Metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;

&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#[derive(Debug)]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Symlink&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;metadata&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;fs&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;Metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;

&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#[derive(Debug)]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Directory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;entries&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;Vec&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FileTree&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;File and directory paths are not guaranteed to be UTF-8.
Indeed, Unix file paths are an arbitrary sequence of bytes,
while Windows file paths are an opaque sequence of 16-bit integers.
You might think that I should be using &lt;tt class=&#34;docutils literal&#34;&gt;OsString&lt;/tt&gt; here,
since it holds a &lt;a class=&#34;reference external&#34; href=&#34;https://doc.rust-lang.org/std/ffi/struct.OsString.html&#34;&gt;platform-native string&lt;/a&gt;.
&lt;tt class=&#34;docutils literal&#34;&gt;String&lt;/tt&gt; has to be valid UTF-8; &lt;tt class=&#34;docutils literal&#34;&gt;OsString&lt;/tt&gt; doesn&#39;t.
Unfortunately, it&#39;s not easy to look at the actual data in an &lt;tt class=&#34;docutils literal&#34;&gt;OsString&lt;/tt&gt;,
unless you convert it (possibly lossily) to a &lt;tt class=&#34;docutils literal&#34;&gt;String&lt;/tt&gt;.
See &lt;a class=&#34;reference external&#34; href=&#34;https://docs.rs/bstr/0.2.8/bstr/#file-paths-and-os-strings&#34;&gt;File paths and OS strings&lt;/a&gt; for more.&lt;/p&gt;
&lt;p&gt;The obvious way to represent a file tree node in Rust
is as an &lt;a class=&#34;reference external&#34; href=&#34;https://hashrust.com/blog/why-rust-enums-are-so-cool/&#34;&gt;enum&lt;/a&gt; with three tuple-like variants.&lt;/p&gt;
&lt;pre class=&#34;code rust literal-block&#34;&gt;
&lt;span class=&#34;cp&#34;&gt;#[derive(Debug)]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;FileTree&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DirNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Directory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FileNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;File&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LinkNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Symlink&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Here, each variant in the enum holds a struct of similar name.
We will be able to take advantage of Rust&#39;s &lt;a class=&#34;reference external&#34; href=&#34;https://doc.rust-lang.org/book/ch18-03-pattern-syntax.html#destructuring-enums&#34;&gt;pattern matching&lt;/a&gt;
to handle each variant.&lt;/p&gt;
&lt;p&gt;We&#39;ll use &lt;tt class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;fs::read_dir&lt;/span&gt;&lt;/tt&gt; to read each directory in the hierarchy.
The &lt;a class=&#34;reference external&#34; href=&#34;https://doc.rust-lang.org/std/fs/struct.ReadDir.html&#34;&gt;read_dir&lt;/a&gt; function returns an iterator
that yields instances of &lt;tt class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;io::Result&amp;lt;DirEntry&amp;gt;&lt;/span&gt;&lt;/tt&gt;.
If a &lt;tt class=&#34;docutils literal&#34;&gt;DirEntry&lt;/tt&gt; is a directory,
we can recursively invoke our &lt;tt class=&#34;docutils literal&#34;&gt;dir_walk&lt;/tt&gt; function
to read the child directory
and add its contents to our in-memory tree.&lt;/p&gt;
&lt;p&gt;The &lt;a class=&#34;reference external&#34; href=&#34;https://docs.rs/walkdir/latest/walkdir/&#34;&gt;walkdir&lt;/a&gt; crate also walks through a directory tree,
but it hides the recursion from you.
It&#39;s an excellent choice otherwise.&lt;/p&gt;
&lt;div class=&#34;section&#34; id=&#34;skipping-and-sorting&#34;&gt;
&lt;h4&gt;Skipping and Sorting&lt;/h4&gt;
&lt;p&gt;In each directory that we read,
we need to consider two factors.&lt;/p&gt;
&lt;ol class=&#34;arabic simple&#34;&gt;
&lt;li&gt;Which entries to skip, such as hidden files.&lt;/li&gt;
&lt;li&gt;How to sort the entries.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We almost always want to skip &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Hidden_file_and_hidden_directory&#34;&gt;hidden files and directories&lt;/a&gt;—on Unix, those entries whose names start with the &lt;tt class=&#34;docutils literal&#34;&gt;.&lt;/tt&gt; character.
Every directory includes entries
for &lt;tt class=&#34;docutils literal&#34;&gt;.&lt;/tt&gt; (itself) and &lt;tt class=&#34;docutils literal&#34;&gt;..&lt;/tt&gt; (parent directory),
and may include other hidden files or directories,
such as &lt;tt class=&#34;docutils literal&#34;&gt;.vimrc&lt;/tt&gt; or &lt;tt class=&#34;docutils literal&#34;&gt;.git&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;On Windows, hidden files are controlled by an &lt;a class=&#34;reference external&#34; href=&#34;https://www.raymond.cc/blog/reset-system-and-hidden-attributes-for-files-or-folders-caused-by-virus/&#34;&gt;attribute&lt;/a&gt;, not by their name.&lt;/p&gt;
&lt;p&gt;For more complicated usage,
we might want to skip &lt;a class=&#34;reference external&#34; href=&#34;https://git-scm.com/docs/gitignore&#34;&gt;ignored files&lt;/a&gt;,
as specified in &lt;tt class=&#34;docutils literal&#34;&gt;.gitignore&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;The simplest useful filter for entry names
is one that rejects hidden files and directories.&lt;/p&gt;
&lt;pre class=&#34;code rust literal-block&#34;&gt;
&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;is_not_hidden&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;-&amp;gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;starts_with&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sc&#34;&gt;&#39;.&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Disk I/O is &lt;a class=&#34;reference external&#34; href=&#34;https://louwrentius.com/understanding-storage-performance-iops-and-latency.html&#34;&gt;costly and slow&lt;/a&gt;, compared to memory access.
It&#39;s far more efficient to not read a directory at all
than it is to eliminate a subtree at a later stage.
Even if the OS has cached the relevant directory contents,
there&#39;s still a &lt;a class=&#34;reference external&#34; href=&#34;https://gms.tf/on-the-costs-of-syscalls.html&#34;&gt;cost to the syscall&lt;/a&gt; to retrieve that data from the kernel.&lt;/p&gt;
&lt;p&gt;There is &lt;a class=&#34;reference external&#34; href=&#34;https://stackoverflow.com/a/8977490/6364&#34;&gt;no specific order&lt;/a&gt; to entries in a directory
or to the results returned by low-level APIs like &lt;tt class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;fs::read_dir&lt;/span&gt;&lt;/tt&gt;.
By default, &lt;tt class=&#34;docutils literal&#34;&gt;ls&lt;/tt&gt; sorts entries alphabetically,
but it can also sort by creation time, modification time, or size,
in ascending or descending order.&lt;/p&gt;
&lt;p&gt;Unix filesystems are case-sensitive,
but Mac filesystems (APFS and HFS+) are case-insensitive by default,
although they preserve the case of the original filename.
Windows&#39; filesystems (NTFS, exFAT, and FAT32)
are &lt;a class=&#34;reference external&#34; href=&#34;https://learn.microsoft.com/en-us/windows/win32/fileio/filesystem-functionality-comparison&#34;&gt;likewise&lt;/a&gt; case-preserving and case-insensitive.&lt;/p&gt;
&lt;p&gt;Here is a case-sensitive &lt;a class=&#34;reference external&#34; href=&#34;https://doc.rust-lang.org/std/vec/struct.Vec.html#method.sort_by&#34;&gt;comparator&lt;/a&gt; for use with &lt;tt class=&#34;docutils literal&#34;&gt;sort_by&lt;/tt&gt;:&lt;/p&gt;
&lt;pre class=&#34;code rust literal-block&#34;&gt;
&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;sort_by_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;fs&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;DirEntry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;fs&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;DirEntry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;-&amp;gt; &lt;span class=&#34;nc&#34;&gt;Ordering&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a_name&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unwrap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unwrap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;into&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➊&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b_name&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unwrap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unwrap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;into&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                             &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➋&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;ol class=&#34;arabic simple&#34;&gt;
&lt;li&gt;This messy expression is necessary to get the &lt;em&gt;name&lt;/em&gt; as a &lt;tt class=&#34;docutils literal&#34;&gt;String&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;tt class=&#34;docutils literal&#34;&gt;cmp&lt;/tt&gt; returns &lt;tt class=&#34;docutils literal&#34;&gt;Less&lt;/tt&gt;, &lt;tt class=&#34;docutils literal&#34;&gt;Equal&lt;/tt&gt;, or &lt;tt class=&#34;docutils literal&#34;&gt;Greater&lt;/tt&gt; from the &lt;tt class=&#34;docutils literal&#34;&gt;Ordering&lt;/tt&gt; enum.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;More on &lt;tt class=&#34;docutils literal&#34;&gt;Ordering&lt;/tt&gt; &lt;a class=&#34;reference external&#34; href=&#34;https://www.philipdaniels.com/blog/2019/rust-equality-and-ordering/&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;section&#34; id=&#34;the-dir-walk-function&#34;&gt;
&lt;h3&gt;The &lt;tt class=&#34;docutils literal&#34;&gt;dir_walk&lt;/tt&gt; function&lt;/h3&gt;
&lt;p&gt;Finally, the recursive &lt;tt class=&#34;docutils literal&#34;&gt;dir_walk&lt;/tt&gt; function that
creates the tree of &lt;tt class=&#34;docutils literal&#34;&gt;FileTree&lt;/tt&gt; nodes.&lt;/p&gt;
&lt;pre class=&#34;code rust literal-block&#34;&gt;
&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dir_walk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;PathBuf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;fn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;-&amp;gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➊&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;compare&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;fn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;fs&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;DirEntry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;fs&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;DirEntry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;-&amp;gt; &lt;span class=&#34;nc&#34;&gt;Ordering&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;-&amp;gt; &lt;span class=&#34;nc&#34;&gt;io&lt;/span&gt;::&lt;span class=&#34;nb&#34;&gt;Result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Directory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;mut&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;entries&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;Vec&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fs&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;DirEntry&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fs&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;read_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter_map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;collect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                 &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➋&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;entries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sort_by&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;compare&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;mut&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;directory&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;Vec&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FileTree&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Vec&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;with_capacity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;entries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➌&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;entries&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unwrap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unwrap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;into&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                         &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➍&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fs&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unwrap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                     &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➎&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FileTree&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;DirNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➏&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dir_walk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;compare&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_symlink&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FileTree&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;LinkNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Symlink&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;into&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;fs&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;read_link&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unwrap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_string_lossy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;metadata&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FileTree&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;FileNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;File&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;into&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;metadata&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;fm&#34;&gt;unreachable!&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;directory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;push&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unwrap_or&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OsStr&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➐&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unwrap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;into&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Ok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Directory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                  &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;➑&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;entries&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;directory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;ol class=&#34;arabic simple&#34;&gt;
&lt;li&gt;Currently, the &lt;tt class=&#34;docutils literal&#34;&gt;filter&lt;/tt&gt; and &lt;tt class=&#34;docutils literal&#34;&gt;compare&lt;/tt&gt; parameters are &lt;tt class=&#34;docutils literal&#34;&gt;fn&lt;/tt&gt;s.
They could probably be &lt;tt class=&#34;docutils literal&#34;&gt;FnMut&lt;/tt&gt; traits.&lt;/li&gt;
&lt;li&gt;Read directory.
Discard any &lt;tt class=&#34;docutils literal&#34;&gt;Error&lt;/tt&gt; results.
Collect into a &lt;tt class=&#34;docutils literal&#34;&gt;Vec&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;We&#39;ll need at most this many entries.&lt;/li&gt;
&lt;li&gt;Use &lt;tt class=&#34;docutils literal&#34;&gt;filter&lt;/tt&gt; to discard names that won&#39;t be visited.&lt;/li&gt;
&lt;li&gt;Match the path as a &lt;tt class=&#34;docutils literal&#34;&gt;DirNode&lt;/tt&gt;, &lt;tt class=&#34;docutils literal&#34;&gt;LinkNode&lt;/tt&gt;, or &lt;tt class=&#34;docutils literal&#34;&gt;FileNode&lt;/tt&gt;,
by using &lt;a class=&#34;reference external&#34; href=&#34;https://doc.rust-lang.org/book/ch18-03-pattern-syntax.html#extra-conditionals-with-match-guards&#34;&gt;match guards&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Visit the subdirectory recursively.&lt;/li&gt;
&lt;li&gt;If &lt;tt class=&#34;docutils literal&#34;&gt;root&lt;/tt&gt; was &lt;tt class=&#34;docutils literal&#34;&gt;&amp;quot;.&amp;quot;&lt;/tt&gt;, the &lt;tt class=&#34;docutils literal&#34;&gt;file_name()&lt;/tt&gt; will be &lt;tt class=&#34;docutils literal&#34;&gt;None&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;Return a &lt;tt class=&#34;docutils literal&#34;&gt;Directory&lt;/tt&gt; for this directory, wrapped in an &lt;tt class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;io::Result&lt;/span&gt;&lt;/tt&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2023/01/24/TreeInRust2PrintingTrees.html&#34;&gt;Part 2&lt;/a&gt;, we&#39;ll print the directory tree.&lt;/p&gt;
&lt;/div&gt;
</content>
    </entry>
    
        <entry>
        <title>fsymbols for Unicode weirdness</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2022/12/31/FSymbolsForUnicodeWeirdness.html" />
        <id>tag:www.georgevreilly.com,2022-12-31:/blog/2022/12/31/FSymbolsForUnicodeWeirdness.html</id>
        <updated>2023-01-01T04:35:00Z</updated>
        <category term="font" />
        <category term="unicode" />
        <category term="til" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;p&gt;My display name on Twitter currently looks like @ɢᴇᴏʀɢᴇᴠʀᴇɪʟʟʏ@ᴛᴇᴄʜ.ʟɢʙᴛ,
an attempt to route around Twitter&#39;s apparent censorship of Mastodon information.&lt;/p&gt;
&lt;p&gt;I used the &lt;a href=&#34;https://fsymbols.com/generators/&#34;&gt;FSymbols Generators&lt;/a&gt; to produce several variants.&lt;/p&gt;
&lt;div class=&#34;codehilite&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;@𝕘𝕖𝕠𝕣𝕘𝕖𝕧𝕣𝕖𝕚𝕝𝕝𝕪@𝕥𝕖𝕔𝕙.𝕝𝕘𝕓𝕥
ʇqƃʅ.ɥɔǝʇ@ʎʅʅᴉǝɹʌǝƃɹoǝƃ@
@𝗀𝖾𝗈𝗋𝗀𝖾𝗏𝗋𝖾𝗂𝗅𝗅𝗒@𝗍𝖾𝖼𝗁.𝗅𝗀𝖻𝗍
@𝘨𝘦𝘰𝘳𝘨𝘦𝘷𝘳𝘦𝘪𝘭𝘭𝘺@𝘵𝘦𝘤𝘩.𝘭𝘨𝘣𝘵
@𝑔𝑒𝑜𝑟𝑔𝑒𝑣𝑟𝑒𝑖𝑙𝑙𝑦@𝑡𝑒𝑐ℎ.𝑙𝑔𝑏𝑡
@𝙜𝙚𝙤𝙧𝙜𝙚𝙫𝙧𝙚𝙞𝙡𝙡𝙮@𝙩𝙚𝙘𝙝.𝙡𝙜𝙗𝙩
@𝚐𝚎𝚘𝚛𝚐𝚎𝚟𝚛𝚎𝚒𝚕𝚕𝚢@𝚝𝚎𝚌𝚑.𝚕𝚐𝚋𝚝
@𝔤𝔢𝔬𝔯𝔤𝔢𝔳𝔯𝔢𝔦𝔩𝔩𝔶@𝔱𝔢𝔠𝔥.𝔩𝔤𝔟𝔱
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Many of these variants come from
&lt;a href=&#34;https://www.compart.com/en/unicode/block/U+1D400&#34;&gt;Unicode Block &#34;Mathematical Alphanumeric Symbols&#34;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are a lot more things you can do with Unicode
than just &lt;a href=&#34;https://www.georgevreilly.com/blog/2016/02/12/UnicodeUpsideDownMappingPart2.html&#34;&gt;upside-down text&lt;/a&gt;.&lt;/p&gt;</content>
    </entry>
    
        <entry>
        <title>Backwards Ranges in Python</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2022/12/19/BackwardsRangesInPython.html" />
        <id>tag:www.georgevreilly.com,2022-12-19:/blog/2022/12/19/BackwardsRangesInPython.html</id>
        <updated>2022-12-19T23:20:00Z</updated>
        <category term="python" />
        <category term="til" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;p&gt;In Python, if you want to specify a sequence of numbers
from &lt;code&gt;a&lt;/code&gt; up to (but excluding) &lt;code&gt;b&lt;/code&gt;,
you can write &lt;code&gt;range(a, b)&lt;/code&gt;.
This generates the sequence &lt;code&gt;a, a+1, a+2, ..., b-1&lt;/code&gt;.
You start at &lt;code&gt;a&lt;/code&gt; and keep going until the next number would be &lt;code&gt;b&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In Python 3, &lt;code&gt;range&lt;/code&gt; is &lt;em&gt;lazy&lt;/em&gt;
and the values in the sequence do not materialize
until you consume the range.&lt;/p&gt;
&lt;div class=&#34;codehilite&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;range(3, 12)&lt;/span&gt;
&lt;span class=&#34;gp&#34;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;[3, 4, 5, 6, 7, 8, 9, 10, 11]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Trey Hunner makes the point that
&lt;a href=&#34;https://treyhunner.com/2018/02/python-range-is-not-an-iterator/&#34;&gt;range is a lazy iterable&lt;/a&gt;
rather than an iterator.&lt;/p&gt;
&lt;p&gt;You can also &lt;em&gt;step&lt;/em&gt; by an increment other than one:
&lt;code&gt;range(a, b, s)&lt;/code&gt;.
This generates &lt;code&gt;a, a+s, a+2*s, ..., b-s&lt;/code&gt;
(assuming that &lt;code&gt;(b - a) % s == 0&lt;/code&gt;;
i.e., &lt;code&gt;a&lt;/code&gt; and &lt;code&gt;b&lt;/code&gt; are separated by an exact multiple of &lt;code&gt;s&lt;/code&gt;.)&lt;/p&gt;
&lt;div class=&#34;codehilite&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;[3, 6, 9]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;What if you want to count down?
&lt;code&gt;range(b, a, -s)&lt;/code&gt; won&#39;t do what you want.&lt;/p&gt;
&lt;div class=&#34;codehilite&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;[12, 9, 6]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Why? Because you&#39;re starting at &lt;code&gt;b&lt;/code&gt;,
a value that doesn&#39;t appear in the forward range,
and you&#39;re ending before you reach &lt;code&gt;a&lt;/code&gt;,
a value that is certainly in the forward range.
You have to subtract &lt;code&gt;s&lt;/code&gt; from both &lt;code&gt;b&lt;/code&gt; and &lt;code&gt;a&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;When you use &lt;code&gt;range(b-s, a-s, -s)&lt;/code&gt;,
you get &lt;code&gt;b-s, b-2*s, ..., a+s, a&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;codehilite&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;[9, 6, 3]&lt;/span&gt;
&lt;span class=&#34;gp&#34;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)),&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;reversed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;([9, 6, 3], [9, 6, 3])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content>
    </entry>
    
        <entry>
        <title>Ulysses at 100</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2022/02/02/UlyssesAt100.html" />
        <id>tag:www.georgevreilly.com,2022-02-02:/blog/2022/02/02/UlyssesAt100.html</id>
        <updated>2022-02-02T08:00:00Z</updated>
        <category term="jamesjoyce" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;a class=&#34;reference external image-reference&#34; href=&#34;https://www.irishtimes.com/news/ireland/irish-news/an-post-launches-new-stamps-to-celebrate-centenary-of-ulysses-1.4787040&#34;&gt;&lt;img alt=&#34;new stamps celebrating the centenary of Ulysses&#34; src=&#34;https://www.irishtimes.com/polopoly_fs/1.4787039.1643276940!/image/image.jpg_gen/derivatives/box_620_330/image.jpg&#34;/&gt;&lt;/a&gt;
&lt;p&gt;On 2nd February 1882, in the Dublin suburb of Rathgar,
a son was given unto John and May Joyce.
James Joyce celebrated his 40th birthday in Paris on 2nd February 1922
by receiving the first printed copy of his novel &lt;em&gt;Ulysses&lt;/em&gt;.
Parts of it had already been published in literary magazines and
the book was eagerly received by the cognoscenti.
It took more than a decade for &lt;em&gt;Ulysses&lt;/em&gt; to be published
in Britain and the United States.
Censors had considered the book obscene,
but the courts established that it had legitimate literary merit.&lt;/p&gt;
&lt;p&gt;For decades, &lt;em&gt;Ulysses&lt;/em&gt; was poorly received in Ireland.
The book was considered &lt;a class=&#34;reference external&#34; href=&#34;https://www.irishtimes.com/news/ireland/irish-news/the-year-of-ulysses-2022-marks-centenary-of-joyce-s-experimental-masterpiece-1.4766055&#34;&gt;blasphemous&lt;/a&gt; and obscene by many.
Worse, Joyce had freely borrowed from life,
populating the pages of &lt;em&gt;Ulysses&lt;/em&gt; with people he had known in Dublin.&lt;/p&gt;
&lt;p&gt;By the time of the centenary of Joyce&#39;s birth in 1982,
attitudes had changed in Ireland.
&lt;em&gt;Ulysses&lt;/em&gt; was now celebrated, if not widely read.
RTÉ Radio broadcast a &lt;a class=&#34;reference external&#34; href=&#34;https://www.rte.ie/archives/exhibitions/681-history-of-rte/706-rte-1980s/327476-ulysses-broadcast/&#34;&gt;25-hour reading&lt;/a&gt; of the entire book.&lt;/p&gt;
&lt;p&gt;I was a schoolboy of almost seventeen in Dublin in February 1982.
I did not, alas, listen to the &lt;a class=&#34;reference external&#34; href=&#34;https://archive.org/details/Ulysses-Audiobook-Merged&#34;&gt;RTÉ recording&lt;/a&gt; at the time,
but at some point that year, I started reading &lt;em&gt;Ulysses&lt;/em&gt; for myself.
And like so many would-be readers before and since,
I hit Episode 3, &amp;quot;Proteus&amp;quot;,
which opens with &amp;quot;Ineluctable modality of the visible&amp;quot;
and promptly dives into Stephen Dedalus&#39;s impenetrable thoughts.
If I could give some advice to myself 40 years ago,
it would be to &amp;quot;skip over the hard bits&amp;quot;.
I&#39;m in good company on that recommendation.
Daniel Mulhall, Ireland&#39;s Ambassador to the US
and author of the recent &lt;a class=&#34;reference external&#34; href=&#34;https://www.amazon.com/dp/1848408293/?tag=georgvreill-20&#34;&gt;Ulysses: A Reader&#39;s Odyssey&lt;/a&gt;,
gives the same advice.
Episode 4, &amp;quot;Calypso&amp;quot;, introduces us to Leopold Bloom
and is far more enjoyable.&lt;/p&gt;
&lt;p&gt;Unfortunately, I did not have the benefit of that advice then,
and I had little to do with &lt;em&gt;Ulysses&lt;/em&gt; for the next two decades.
In &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2003/06/11/Bloomsday.html&#34;&gt;2003&lt;/a&gt;, I took part in the &lt;a class=&#34;reference external&#34; href=&#34;https://www.wildgeeseseattle.org/&#34;&gt;Wild Geese Players of Seattle&lt;/a&gt;&#39;s
staged reading of Episodes 8 and 9, &amp;quot;Lestrygonians&amp;quot; and &amp;quot;Scylla and Charybdis&amp;quot;.
In 2004, I helped adapt the next episode, &amp;quot;Wandering Rocks&amp;quot;, for that year&#39;s staged reading.
When Kieran O&#39;Malley, the group&#39;s original founder, moved back to Ireland in 2005 or 2006,
I took over as dramaturg.
I&#39;ve led the Geese for many years now,
and I&#39;ve &lt;a class=&#34;reference external&#34; href=&#34;https://github.com/WildGeeseSeattle/Ulysses&#34;&gt;adapted scripts&lt;/a&gt; for the entire book.&lt;/p&gt;
&lt;p&gt;Why?
The connection with Dublin that I share with Joyce is certainly part of it.
I&#39;ve come to love the book.
(Most of it; there are certainly parts that I find tedious.)
It&#39;s a book in which very little happens,
and yet it encompasses everything.
We get an extremely rounded picture of Bloom and his inner life.
It&#39;s funny and sad and erudite and annoying and wise.
Joyce has distilled the human condition into one summer&#39;s day in Dublin.&lt;/p&gt;
&lt;p&gt;And now it is the centenary of the publication of &lt;em&gt;Ulysses&lt;/em&gt;.
I posted some &lt;a class=&#34;reference external&#34; href=&#34;https://www.wildgeeseseattle.org/ulysses-at-100.html&#34;&gt;centenary material&lt;/a&gt; at the Wild Geese website.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ulysses&lt;/em&gt; has become an ineluctable part of my life.&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>Diffing a fragment of a file</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2022/01/31/DiffFileFragment.html" />
        <id>tag:www.georgevreilly.com,2022-01-31:/blog/2022/01/31/DiffFileFragment.html</id>
        <updated>2022-01-31T08:00:00Z</updated>
        <category term="programming" />
        <category term="bash" />
        <category term="til" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;p&gt;A while back, I had extracted some code out of a large file
into a separate file and made some modifications.
I wanted to check that the differences were minimal.
Let&#39;s say that the extracted code had been between
lines 123 and 456 of &lt;tt class=&#34;docutils literal&#34;&gt;large_old_file&lt;/tt&gt;.&lt;/p&gt;
&lt;pre class=&#34;code bash literal-block&#34;&gt;
diff -u &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;sed -n &lt;span class=&#34;s1&#34;&gt;&#39;123,456p;457q&#39;&lt;/span&gt; large_old_file&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; new_file
&lt;/pre&gt;
&lt;p&gt;What&#39;s happening here?&lt;/p&gt;
&lt;ul class=&#34;simple&#34;&gt;
&lt;li&gt;&lt;tt class=&#34;docutils literal&#34;&gt;sed &lt;span class=&#34;pre&#34;&gt;-n&lt;/span&gt; &#39;123,456p&#39;&lt;/tt&gt; is printing lines 123–456 of &lt;tt class=&#34;docutils literal&#34;&gt;large_old_file&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;The &lt;tt class=&#34;docutils literal&#34;&gt;457q&lt;/tt&gt; tells sed to abandon the file at line 457.
Otherwise, it will keep reading all the way to the end.&lt;/li&gt;
&lt;li&gt;The &lt;tt class=&#34;docutils literal&#34;&gt;&amp;lt;(sed &lt;span class=&#34;pre&#34;&gt;...)&lt;/span&gt;&lt;/tt&gt; is an example of &lt;a class=&#34;reference external&#34; href=&#34;https://tldp.org/LDP/abs/html/process-sub.html&#34;&gt;process substitution&lt;/a&gt;.
The &lt;em&gt;output&lt;/em&gt; of the &lt;tt class=&#34;docutils literal&#34;&gt;sed&lt;/tt&gt; invocation
becomes the first &lt;em&gt;input&lt;/em&gt; of the &lt;tt class=&#34;docutils literal&#34;&gt;diff&lt;/tt&gt; command.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A similar example: &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2017/01/11/DiffTransformedFile.html&#34;&gt;Diff a Transformed File&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;BTW, these days, I usually use &lt;a class=&#34;reference external&#34; href=&#34;https://github.com/dandavison/delta&#34;&gt;delta&lt;/a&gt; for diffing at the command line,
especially with Git.&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>40 Years of Programming</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2022/01/31/40YearsOfProgramming.html" />
        <id>tag:www.georgevreilly.com,2022-01-31:/blog/2022/01/31/40YearsOfProgramming.html</id>
        <updated>2022-01-31T08:00:00Z</updated>
        <category term="personal" />
        <category term="programming" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;p&gt;40 years ago this month,
I sat down at a computer and wrote a program.
(Or &amp;quot;programme&amp;quot;, as I spelled it then.)
It was the first time I had ever used a computer.
Very few people had used computers in 1982,
in Ireland or elsewhere.&lt;/p&gt;
&lt;p&gt;What was the program?
No idea.
Just a few lines of AppleSoft Basic.
But it was enough to get me hooked and change my life.&lt;/p&gt;
&lt;p&gt;I still get a hit when a little bit of code unlocks in my brain.
It&#39;s quite addictive.
There&#39;s always more to learn and to see.&lt;/p&gt;
&lt;p&gt;I wrote more about this in 2012: &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2012/01/26/30YearsOfProgramming.html&#34;&gt;30 Years of Programming&lt;/a&gt;.&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>On Circumnavigating the Aubreyiad Again</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2021/12/30/CircumnavigatingAubreyiad.html" />
        <id>tag:www.georgevreilly.com,2021-12-30:/blog/2021/12/30/CircumnavigatingAubreyiad.html</id>
        <updated>2021-12-30T08:00:00Z</updated>
        <category term="books" />
        <category term="reviews" />
        <category term="fiction" />
        <category term="history" />
        <category term="aubrey-maturin" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;p&gt;At the beginning of 2021,
prompted by Russell Crowe&#39;s defense of &lt;em&gt;Master and Commander&lt;/em&gt;,
I began yet another re-read of the twenty Aubrey-Maturin novels.
Or, as the fandom would have it, another circumnavigation.
It&#39;s probably my fifth or sixth circumnavigation,
since I bought the complete boxed set as a Christmas present to myself
in the early aughts.&lt;/p&gt;
&lt;p&gt;I completed the twentieth book, &lt;em&gt;Blue at the Mizzen&lt;/em&gt;, yesterday,
and also the few pages of the final, unfinished novel, &lt;em&gt;21&lt;/em&gt;.
(I also read about &lt;a class=&#34;reference external&#34; href=&#34;https://www.goodreads.com/user/year_in_books/2021/3723742&#34;&gt;120 other books&lt;/a&gt; in 2021,
down from a stupendous &lt;a class=&#34;reference external&#34; href=&#34;https://www.goodreads.com/user/year_in_books/2020/3723742&#34;&gt;200 books in 2020&lt;/a&gt;,
but that&#39;s neither here nor there.)&lt;/p&gt;
&lt;blockquote class=&#34;twitter-tweet&#34;&gt;
&lt;p lang=&#34;en&#34; dir=&#34;ltr&#34;&gt;I think I&amp;#39;m due for another re-read of Patrick O&amp;#39;Brian&amp;#39;s Aubrey/Maturin novels (all 6,500 pages) and a rewatch of Master and Commander.
&lt;a href=&#34;https://t.co/gVf9IBan7e&#34;&gt;pic.twitter.com/gVf9IBan7e&lt;/a&gt;&lt;/p&gt;&amp;mdash; George V. Reilly (@georgevreilly)
&lt;a href=&#34;https://twitter.com/georgevreilly/status/1350913122345783297?ref_src=twsrc%5Etfw&#34;&gt;
January 17, 2021&lt;/a&gt;
&lt;/blockquote&gt;
&lt;script async src=&#34;https://platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;p&gt;Why did I put myself through re-reading 6,500 pages of a dense &lt;em&gt;roman-fleuve&lt;/em&gt; yet again?
For the sheer pleasure of joining up once more with my old friends,
Captain Jack Aubrey and Dr Stephen Maturin,
in their 15-year fight against Napoleon.&lt;/p&gt;
&lt;p&gt;They are an unlikely pair of friends.
Jack Aubrey, a big, hearty English naval officer,
is utterly competent in his domain,
magnificent at sea but naïve and easily duped on land.
Stephen Maturin, the illegitimate son of an Irish officer and a Catalan lady,
is a renowned physician and naturalist,
a former &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Society_of_United_Irishmen&#34;&gt;United Irishman&lt;/a&gt; turned British intelligence agent,
a Catholic in a Protestant service,
and a perpetual landlubber and sloven.
They have little in common, save a shared love of music and of natural philosophy.
Both are Fellows of the &lt;a class=&#34;reference external&#34; href=&#34;https://royalsociety.org/about-us/history/&#34;&gt;Royal Society&lt;/a&gt;—Jack, to many&#39;s surprise, is a mathematician and astronomer.&lt;/p&gt;
&lt;p&gt;And yet, they are fast friends and Stephen follows Jack from ship to ship.
A captain must hold himself aloof from his crew and his officers.
He is the sole authority, often months of sailing away from his superiors.
He dines alone, save when invited to the officers&#39; wardroom
or when he invites them to join him.
Stephen, as Jack&#39;s particular friend, is exempt from the normal strictures,
allowing Jack to retain his humanity on the long voyages.&lt;/p&gt;
&lt;p&gt;It is the friendship and the two main characters that hold me,
along with the adventure and the travel.
O&#39;Brian immersed himself in the eighteenth and early nineteenth centuries,
and his encyclopaedic knowledge helped him bring the era to life
with incredible verisimilitude.
O&#39;Brian was an accomplished storyteller and often &lt;a class=&#34;reference external&#34; href=&#34;https://quotingobrian.tumblr.com/&#34;&gt;very funny&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The characters sound and act like people of the time,
not like transplanted twentieth century Americans.
Jack, Stephen, and the other characters
would be at home in the pages of Jane Austen
(sister to two Royal Navy officers).&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://www.tor.com/series/re-reading-patrick-obrians-aubrey-maturin-series/&#34;&gt;Jo Walton&#39;s re-read&lt;/a&gt; will give you a taste of the books.&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>Review: Crafting Interpreters</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2021/12/28/ReviewCraftingInterpreters.html" />
        <id>tag:www.georgevreilly.com,2021-12-28:/blog/2021/12/28/ReviewCraftingInterpreters.html</id>
        <updated>2021-12-28T08:00:00Z</updated>
        <category term="books" />
        <category term="reviews" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;a class=&#34;reference external image-reference&#34; href=&#34;https://www.amazon.com/dp/0990582930/?tag=georgvreill-20&#34;&gt;&lt;img alt=&#34;Crafting Interpreters&#34; class=&#34;right-float&#34; src=&#34;https://images-na.ssl-images-amazon.com/images/I/41-7uSeOyCL._SX398_BO1,204,203,200_.jpg&#34;/&gt;&lt;/a&gt;
&lt;div class=&#34;line-block&#34;&gt;
&lt;div class=&#34;line&#34;&gt;Title: &lt;a class=&#34;reference external&#34; href=&#34;https://craftinginterpreters.com/&#34;&gt;Crafting Interpreters&lt;/a&gt;&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Author: Robert Nystrom&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Rating: ★ ★ ★ ★ ★&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Publisher: Genever Benning&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Copyright: 2021&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;ISBN: &lt;a class=&#34;reference external&#34; href=&#34;https://www.amazon.com/dp/0990582930/?tag=georgvreill-20&#34;&gt;978-0990582939&lt;/a&gt;&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Pages: 640&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Keywords: programming, interpreters&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Reading period: 10–28 December, 2021&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;I&#39;ve read hundreds of technical books over the last 40 years.
&lt;em&gt;Crafting Interpreters&lt;/em&gt; is an instant classic,
and far more readable and fun than many of the classics.&lt;/p&gt;
&lt;p&gt;Nystrom covers a lot of ground in this book,
building two very different interpreters for Lox,
a small dynamic language of his own design.
He takes us through &lt;em&gt;every line&lt;/em&gt; of
jlox, a Java-based tree-walk interpreter,
and of clox, a bytecode virtual machine written in C.&lt;/p&gt;
&lt;p&gt;For the first implementation, jlox,
he covers such topics as scanning,
parsing expressions with recursive descent,
evaluating expressions, control flow,
functions and closures, classes, and inheritance.&lt;/p&gt;
&lt;p&gt;Starting with an empty slate,
Nystrom adds just enough code to implement the topic
of each chapter,
having a working albeit incomplete implementation of the interpreter
by the end of the chapter.
He adds new code as he goes,
inserting an extra &lt;tt class=&#34;docutils literal&#34;&gt;case&lt;/tt&gt; into a &lt;tt class=&#34;docutils literal&#34;&gt;switch&lt;/tt&gt; here
or writing a new function there,
or replacing a few lines of an earlier implementation
with something that&#39;s just been explained.
Knuth&#39;s &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Literate_programming&#34;&gt;Literate Programming&lt;/a&gt; explains a finished implementation,
broken into separate pieces for exposition.
Nystrom&#39;s continual, ever-evolving exposition is slower to get to the point,
but it&#39;s excellent pedagogy.
I would be remiss if I didn&#39;t mention the hundreds of hand-drawn illustrations,
which add a quirky flavor to the tone of the book.
He has a blog post on how he &lt;a class=&#34;reference external&#34; href=&#34;http://journal.stuffwithstuff.com/2020/04/05/crafting-crafting-interpreters/&#34;&gt;pulled this organization off&lt;/a&gt;
and another on how he created a &lt;a class=&#34;reference external&#34; href=&#34;http://journal.stuffwithstuff.com/2021/07/29/640-pages-in-15-months/&#34;&gt;physical book&lt;/a&gt; from the text.&lt;/p&gt;
&lt;p&gt;clox is a very different second implementation of a Lox interpreter.
Instead of a slow interpreter walking an abstract syntax tree,
he develops a stack-based virtual machine,
compiles Lox into bytecode,
and interprets the bytecode.
He covers theory and practical considerations
for creating a bytecode virtual machine,
makes use of Pratt’s “top-down operator precedence parsing”,
and implements closures and classes in C.
In jlox, he used Java&#39;s &lt;tt class=&#34;docutils literal&#34;&gt;HashMap&lt;/tt&gt; to manage identifiers
and relied on Java&#39;s garbage collection for memory management.
For clox, he implements a hash table and a mark-and-sweep garbage collector.
Although he has to cover similar topics (parsing, local variables, closures) each time,
he finds a fresh perspective for the second implementation.&lt;/p&gt;
&lt;p&gt;I read the entire book for free at &lt;a class=&#34;reference external&#34; href=&#34;https://craftinginterpreters.com/&#34;&gt;https://craftinginterpreters.com/&lt;/a&gt;,
but I liked it so much that I&#39;ve ordered a physical copy.
In fact, I actually read much of the book on the website in 2020,
but life intervened and I didn&#39;t finish it,
so this month, I read it again from the start.&lt;/p&gt;
&lt;p&gt;This book is not a textbook and you don&#39;t get an exhaustive introduction
to building interpreters, much less compilers.
In the final year of my Computer Science degree at Trinity College Dublin in 1986–87,
I studied the &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Compilers:_Principles,_Techniques,_and_Tools&#34;&gt;Dragon Book&lt;/a&gt; when the first edition was brand new.
&lt;em&gt;Crafting Interpreters&lt;/em&gt; is a lot more fun than the Dragon Book.&lt;/p&gt;
&lt;p&gt;Highly recommended!&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>Path Traversal Attacks</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2021/10/05/PathTraversalAttacks.html" />
        <id>tag:www.georgevreilly.com,2021-10-05:/blog/2021/10/05/PathTraversalAttacks.html</id>
        <updated>2021-10-05T08:00:00Z</updated>
        <category term="iis" />
        <category term="security" />
        <category term="unicode" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;p&gt;I was surprised to read this evening that the Apache Web Server
just fixed an actively exploited path traversal flaw.&lt;/p&gt;
&lt;blockquote class=&#34;twitter-tweet&#34;&gt;
&lt;p lang=&#34;en&#34; dir=&#34;ltr&#34;&gt;
🚨 Apache has disclosed an *actively exploited* Path traversal flaw
in the &lt;a href=&#34;https://twitter.com/hashtag/opensource?src=hash&amp;amp;ref_src=twsrc%5Etfw&#34;&gt;#opensource&lt;/a&gt;
&amp;quot;httpd&amp;quot; server.
Over 112,000 exposed Apache servers run version 2.4.49,
and should be upgraded now!&lt;br&gt;
New fix checks for encoded path traversal characters
e.g. /../.%2E/&lt;a href=&#34;https://t.co/1tLNc3LAul&#34;&gt;https://t.co/1tLNc3LAul&lt;/a&gt;
&lt;a href=&#34;https://t.co/mDHLEU3k9N&#34;&gt;pic.twitter.com/mDHLEU3k9N&lt;/a&gt;
&lt;/p&gt;&amp;mdash; Ax Sharma (@Ax_Sharma)
&lt;a href=&#34;https://twitter.com/Ax_Sharma/status/1445391350053183500?ref_src=twsrc%5Etfw&#34;&gt;October 5, 2021&lt;/a&gt;
&lt;/blockquote&gt;
&lt;script async src=&#34;https://platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;p&gt;Apparently, it was &lt;a class=&#34;reference external&#34; href=&#34;https://github.com/apache/httpd/commit/4c79fd280dfa3eede5a6f3baebc7ef2e55b3eb6a&#34;&gt;introduced over a year ago&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I&#39;m gobsmacked that Apache didn&#39;t have a robust suite of tests for this.&lt;/p&gt;
&lt;p&gt;Directory Traversal attacks have been a problem for web servers
since the beginning.
&lt;a class=&#34;reference external&#34; href=&#34;https://owasp.org/www-community/attacks/Path_Traversal&#34;&gt;OWASP&lt;/a&gt;, &lt;a class=&#34;reference external&#34; href=&#34;https://portswigger.net/web-security/file-path-traversal&#34;&gt;PortSwigger&lt;/a&gt;, and &lt;a class=&#34;reference external&#34; href=&#34;https://spanning.com/blog/directory-traversal-web-based-application-security-part-8/&#34;&gt;Spanning&lt;/a&gt; all have explanations that you can read.
The essence is that you make a request to a URL that looks like
&lt;tt class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;http://example.com/cgi-bin/../../../../etc/passwd&lt;/span&gt;&lt;/tt&gt;
and, voilà, you get access to something that you shouldn&#39;t.
Each of the &lt;tt class=&#34;docutils literal&#34;&gt;..&lt;/tt&gt; path segments climbs up a level of the file system.
Even the simplest web server knows better than to blindly allow
a sequence of &lt;tt class=&#34;docutils literal&#34;&gt;..&lt;/tt&gt; path segments,
so you have to be a little clever about how you express them.&lt;/p&gt;
&lt;div class=&#34;section&#34; id=&#34;iis-unicode-exploit&#34;&gt;
&lt;h3&gt;IIS Unicode Exploit&lt;/h3&gt;
&lt;p&gt;I remember when I worked on the IIS development team at Microsoft in 1997–2004,
we got hit by &lt;a class=&#34;reference external&#34; href=&#34;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-0884&#34;&gt;CVE-2000-0884&lt;/a&gt; in 2000,
which made use of an &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/UTF-8#Overlong_encodings&#34;&gt;overlong UTF-8 encoding&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;URLs allow &lt;a class=&#34;reference external&#34; href=&#34;https://developer.mozilla.org/en-US/docs/Glossary/percent-encoding&#34;&gt;percent encoding&lt;/a&gt; for characters that can&#39;t be sent literally.
For example, &lt;tt class=&#34;docutils literal&#34;&gt;%3D&lt;/tt&gt; encodes an &lt;tt class=&#34;docutils literal&#34;&gt;=&lt;/tt&gt;
as the two-digit hexadecimal value of &lt;tt class=&#34;docutils literal&#34;&gt;=&lt;/tt&gt;’s ASCII code.
UTF-8 characters beyond U+007F require two or more bytes of storage,
each of which can be percent encoded;
e.g., U+00C1 (&lt;tt class=&#34;docutils literal&#34;&gt;Á&lt;/tt&gt;) is encoded as the &lt;tt class=&#34;docutils literal&#34;&gt;C3 81&lt;/tt&gt; byte pair in UTF-8,
and as &lt;tt class=&#34;docutils literal&#34;&gt;%C3%81&lt;/tt&gt; in percent encoding.&lt;/p&gt;
&lt;p&gt;The slash character, &lt;tt class=&#34;docutils literal&#34;&gt;/&lt;/tt&gt; or U+002F, can be percent encoded as &lt;tt class=&#34;docutils literal&#34;&gt;%2F&lt;/tt&gt;.
IIS 4 and 5 were smart enough to treat &lt;tt class=&#34;docutils literal&#34;&gt;%2F&lt;/tt&gt; as a slash
and to defend against sequences like &lt;tt class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;..%2F..%2F&lt;/span&gt;&lt;/tt&gt;.
However, the attackers encoded a slash as &lt;tt class=&#34;docutils literal&#34;&gt;%C0%AF&lt;/tt&gt;—a sequence that is burned into my brain.
This two-byte UTF-8 sequence can be decoded as U+002F,
though it should not be treated as valid
as it is &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/UTF-8#Overlong_encodings&#34;&gt;overlong&lt;/a&gt;:
the five payload bits in the leading byte are all zero.&lt;/p&gt;
&lt;p&gt;The &lt;a class=&#34;reference external&#34; href=&#34;https://www.giac.org/paper/gcih/115/iis-unicode-exploit/101163&#34;&gt;GIAC paper&lt;/a&gt; explains in some detail how this could be exploited.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section&#34; id=&#34;windows-security-push&#34;&gt;
&lt;h3&gt;Windows Security Push&lt;/h3&gt;
&lt;p&gt;Windows XP went on sale in late 2001,
touted as the most secure version of Windows ever.
(It was, at that time.)&lt;/p&gt;
&lt;p&gt;Right around Christmas 2001,
the &lt;a class=&#34;reference external&#34; href=&#34;https://www.giac.org/paper/gcih/274/windows-xp-upnp-exploits/102906&#34;&gt;UPnP vulnerabilty&lt;/a&gt; was disclosed.
Brian Valentine, the Senior VP who ran Windows, threw a shitfit.
It was announced that &lt;em&gt;all&lt;/em&gt; of Windows would spend the month of February 2002
undergoing security training,
so that we could &lt;a class=&#34;reference external&#34; href=&#34;https://owasp.org/www-community/Threat_Modeling&#34;&gt;threat model&lt;/a&gt; and review our code.&lt;/p&gt;
&lt;p&gt;For IIS 6, which would be released in Windows Server 2003,
we had fundamentally rearchitected it with a new worker process model
(inspired by Apache&#39;s) and we had rewritten much of it.
There was a new kernel mode driver, http.sys,
that terminated all requests and routed them
to the appropriate handler in kernel or user mode.
I was part of the http.sys dev team at that point.&lt;/p&gt;
&lt;p&gt;IIS had already gotten serious about security by then.
We had to, after &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Code_Red_(computer_worm)&#34;&gt;Code Red&lt;/a&gt;, &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Nimda&#34;&gt;Nimda&lt;/a&gt;, the Unicode exploit, and others.
&lt;a class=&#34;reference external&#34; href=&#34;https://www.linkedin.com/in/mikehow/&#34;&gt;Mike Howard&lt;/a&gt; had been the IIS Security Program Manager
before he went on to bigger responsiblities.
A lot of the first edition of his &lt;a class=&#34;reference external&#34; href=&#34;https://www.amazon.com/Writing-Secure-Second-Developer-Practices/dp/0735617228&#34;&gt;Writing Secure Code&lt;/a&gt; book
was based on his experience with securing IIS,
and a lot of the second edition benefited from the Security Push experience.&lt;/p&gt;
&lt;p&gt;Since http.sys was new and an obvious target,
our team actually spent two months carefully reviewing everything.
It turned out that we had done a good job over the previous couple of years
and we didn&#39;t find much to worry about.&lt;/p&gt;
&lt;p&gt;We did identify that the URL canonicalization in http.sys
was overly complicated.
I rewrote that component and I created a ton of unit tests for it.
Developers writing unit tests was not common at Microsoft back in 2002:
we had a separate caste of testers to write tests.&lt;/p&gt;
&lt;p&gt;I&#39;ve been out of the loop since I left IIS in 2004,
but to my knowledge, there were no further vulnerabilities in URL handling.&lt;/p&gt;
&lt;p&gt;I&#39;m surprised and disappointed that Apache would mess up path traversal in the 2020s.&lt;/p&gt;
&lt;/div&gt;
</content>
    </entry>
    
        <entry>
        <title>Accidentally Quadratic: Python List Membership</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2021/10/04/AccidentallyQuadraticPythonListMembership.html" />
        <id>tag:www.georgevreilly.com,2021-10-04:/blog/2021/10/04/AccidentallyQuadraticPythonListMembership.html</id>
        <updated>2021-10-04T08:00:00Z</updated>
        <category term="python" />
        <category term="performance" />
        <category term="til" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;p&gt;We had a performance regression in a test suite recently
when the median test time jumped by two minutes.&lt;/p&gt;
&lt;a class=&#34;reference external image-reference&#34; href=&#34;https://www.bigocheatsheet.com/&#34;&gt;&lt;img alt=&#34;Big O Cheat Sheet&#34; src=&#34;https://www.georgevreilly.com/content/binary/bigochart.gif&#34;/&gt;&lt;/a&gt;
&lt;p&gt;We tracked it down to this (simplified) code fragment:&lt;/p&gt;
&lt;pre class=&#34;code python literal-block&#34;&gt;
&lt;span class=&#34;n&#34;&gt;task_inclusions&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;some_collection_of_tasks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;invalid_tasks&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;task_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;airflow_tasks&lt;/span&gt;
                 &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;task_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;task_inclusions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;This looks fairly innocuous—and it was—until the size of the result returned from &lt;tt class=&#34;docutils literal&#34;&gt;some_collection_of_tasks()&lt;/tt&gt;
jumped from a few hundred to a few thousand.&lt;/p&gt;
&lt;p&gt;The &lt;a class=&#34;reference external&#34; href=&#34;https://docs.python.org/3/reference/expressions.html#membership-test-operations&#34;&gt;in comparison operator&lt;/a&gt; conveniently works
with all of Python&#39;s standard sequences and collections,
but its efficiency varies.
For a &lt;tt class=&#34;docutils literal&#34;&gt;list&lt;/tt&gt; and other sequences,
&lt;tt class=&#34;docutils literal&#34;&gt;in&lt;/tt&gt; must search linearly through all the elements
until it finds a matching element
&lt;em&gt;or&lt;/em&gt; the list is exhausted.
In other words, &lt;tt class=&#34;docutils literal&#34;&gt;x in some_list&lt;/tt&gt; takes &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;O&lt;/i&gt;(&lt;i&gt;n&lt;/i&gt;)&lt;/span&gt; time.
For a &lt;tt class=&#34;docutils literal&#34;&gt;set&lt;/tt&gt; or a &lt;tt class=&#34;docutils literal&#34;&gt;dict&lt;/tt&gt;, however,
&lt;tt class=&#34;docutils literal&#34;&gt;x in container&lt;/tt&gt; takes, on average, only &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;O&lt;/i&gt;(1)&lt;/span&gt; time.
See &lt;a class=&#34;reference external&#34; href=&#34;https://wiki.python.org/moin/TimeComplexity&#34;&gt;Time Complexity&lt;/a&gt; for more.&lt;/p&gt;
&lt;p&gt;The &lt;tt class=&#34;docutils literal&#34;&gt;invalid_tasks&lt;/tt&gt; list comprehension
was explicitly looping through one list, &lt;tt class=&#34;docutils literal&#34;&gt;airflow_tasks&lt;/tt&gt;,
and implicitly doing a linear search through &lt;tt class=&#34;docutils literal&#34;&gt;task_inclusions&lt;/tt&gt;
for each value of &lt;tt class=&#34;docutils literal&#34;&gt;t&lt;/tt&gt;.
The nested loop was hidden
and its effect only became apparent
when &lt;tt class=&#34;docutils literal&#34;&gt;task_inclusions&lt;/tt&gt; grew large.&lt;/p&gt;
&lt;p&gt;The list comprehension was actually taking &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;O&lt;/i&gt;(&lt;i&gt;n&lt;/i&gt;&lt;sup&gt;2&lt;/sup&gt;)&lt;/span&gt; time.
When &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;n&lt;/i&gt;&lt;/span&gt; was comparatively small (a few hundred),
this wasn&#39;t a problem.
When &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;n&lt;/i&gt;&lt;/span&gt; grew to several thousand,
it became a big problem.&lt;/p&gt;
&lt;p&gt;This is a classic example of an &lt;a class=&#34;reference external&#34; href=&#34;https://accidentallyquadratic.tumblr.com/&#34;&gt;accidentally quadratic&lt;/a&gt; algorithm.
Indeed, Nelson describes a very similar problem with &lt;a class=&#34;reference external&#34; href=&#34;https://accidentallyquadratic.tumblr.com/post/161243900944/mercurial-changegroup-application&#34;&gt;Mercurial changegroups&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This performance regression was compounded because this fragment of code
was being called thousands of times—I believe once for each task—
making the overall cost cubic, &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;O&lt;/i&gt;(&lt;i&gt;n&lt;/i&gt;&lt;sup&gt;3&lt;/sup&gt;)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;The fix here is similar:
Use a &lt;tt class=&#34;docutils literal&#34;&gt;set&lt;/tt&gt; instead of a &lt;tt class=&#34;docutils literal&#34;&gt;list&lt;/tt&gt;
and get &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;O&lt;/i&gt;(1)&lt;/span&gt; membership testing.
The &lt;tt class=&#34;docutils literal&#34;&gt;invalid_tasks&lt;/tt&gt; list comprehension now takes
the expected &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;O&lt;/i&gt;(&lt;i&gt;n&lt;/i&gt;)&lt;/span&gt; time.&lt;/p&gt;
&lt;pre class=&#34;code python literal-block&#34;&gt;
&lt;span class=&#34;n&#34;&gt;task_inclusions&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;some_collection_of_tasks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;invalid_tasks&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;task_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;airflow_tasks&lt;/span&gt;
                 &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;task_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;task_inclusions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;More at &lt;a class=&#34;reference external&#34; href=&#34;https://www.coengoedegebure.com/understanding-big-o-notation/&#34;&gt;Understanding Big-O Notation&lt;/a&gt; and the &lt;a class=&#34;reference external&#34; href=&#34;https://www.bigocheatsheet.com/&#34;&gt;Big-O Cheat Sheet&lt;/a&gt;.&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>Passphrase Generators</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2021/05/10/PassphraseGenerators.html" />
        <id>tag:www.georgevreilly.com,2021-05-10:/blog/2021/05/10/PassphraseGenerators.html</id>
        <updated>2021-05-10T08:00:00Z</updated>
        <category term="tech" />
        <category term="security" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;a class=&#34;reference external image-reference&#34; href=&#34;https://xkcd.com/936/&#34;&gt;&lt;img alt=&#34;Password Strength&#34; src=&#34;https://imgs.xkcd.com/comics/password_strength.png&#34;/&gt;&lt;/a&gt;
&lt;p&gt;I&#39;ve been using &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Password_manager&#34;&gt;password managers&lt;/a&gt; for at least 15 years
to keep track of all my passwords.
I have separate, distinct, strong passwords for hundreds of sites,
and I&#39;ve only memorized the handful that I need to actually type regularly.&lt;/p&gt;
&lt;p&gt;I started out with the &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2006/02/06/200KeePassEntries.html&#34;&gt;KeePass&lt;/a&gt; desktop app originally,
but I switched to the online &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2016/01/07/DicewareAndLastpass.html&#34;&gt;LastPass&lt;/a&gt; app about a decade ago.
At work, we use &lt;a class=&#34;reference external&#34; href=&#34;https://1password.com/&#34;&gt;1Password&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;When I register for a site,
LastPass generates a random password for me,
such as:&lt;/p&gt;
&lt;pre class=&#34;literal-block&#34;&gt;
tV%5joS$U6^uY5xU
T2oEUY!g70Iv1b&amp;amp;I
8kNHg9*A5GMR9%8D
&lt;/pre&gt;
&lt;p&gt;LastPass securely syncs my passwords between machines and devices.
Its browser integration and its Android and iPhone apps
mean that I rarely ever have to actually type any of those ugly messes in.&lt;/p&gt;
&lt;p&gt;But when I do have to type in such a password,
it&#39;s unpleasant in a browser.
It doesn&#39;t help that LastPass in some cases displays passwords
in a sans-serif font that makes it easy to &lt;a class=&#34;reference external&#34; href=&#34;https://typography.guru/journal/letters-symbols-misrecognition/&#34;&gt;misrecognize&lt;/a&gt; letters
such as &lt;tt class=&#34;docutils literal&#34;&gt;Il&lt;/tt&gt;, &lt;tt class=&#34;docutils literal&#34;&gt;0O&lt;/tt&gt;, &lt;tt class=&#34;docutils literal&#34;&gt;5S&lt;/tt&gt;, or &lt;tt class=&#34;docutils literal&#34;&gt;8B&lt;/tt&gt;.
It&#39;s far more painful in an Android app,
where you have to switch the keyboard in and out of symbol mode.
It&#39;s usually even worse in iPhone apps,
which rarely offer you an option to see your password in the clear
as you&#39;re laboriously typing it,
so it&#39;s easy to make a mistake.
When I tried to use a remote control
to enter my Netflix and Amazon Prime passwords into a new set-top box,
I got so annoyed that I brought down a real keyboard
and plugged it into the USB port.&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://theintercept.com/2015/03/26/passphrases-can-memorize-attackers-cant-guess/&#34;&gt;Passphrases&lt;/a&gt; have nice properties compared to random passwords:
they&#39;re human readable,
they&#39;re much easier—if longer—to type,
and you can actually remember them if you have to.
A passphrase of at least five words (chosen by a secure random generator)
is computationally infeasible to crack.&lt;/p&gt;
&lt;p&gt;The ur-example of random passphrase generators is &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Diceware&#34;&gt;Diceware&lt;/a&gt; from 1995.
There are various problems with the Diceware wordlist,
which are rectified by more modern lists,
such as the &lt;a class=&#34;reference external&#34; href=&#34;https://www.eff.org/deeplinks/2016/07/new-wordlists-random-passphrases&#34;&gt;EFF Wordlists&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Which would you rather type?
The &lt;a class=&#34;reference external&#34; href=&#34;http://www.catb.org/jargon/html/L/line-noise.html&#34;&gt;line noise&lt;/a&gt; above or one of these passphrases?:&lt;/p&gt;
&lt;pre class=&#34;literal-block&#34;&gt;
confident starfish aftermost elsewhere jasmine
shun baggage chaps reward cuddle
avenue rut pardon skating earlobe
latter blissful snippet jolt corroding
upstage-divinely-ninth-unfilled-skeleton
SkimmingMachinistBlessHesitancyKissableRink
&lt;/pre&gt;
&lt;p&gt;When I want to generate a random passphrase,
I tend to use either the &lt;a class=&#34;reference external&#34; href=&#34;https://github.com/ulif/diceware&#34;&gt;Python diceware&lt;/a&gt; command-line tool
or Glenn Rempe&#39;s JavaScript-based &lt;a class=&#34;reference external&#34; href=&#34;https://www.rempe.us/diceware/#eff&#34;&gt;Diceware website&lt;/a&gt;.
Both use cryptographic random number generators
to generate excellent passphrases.&lt;/p&gt;
&lt;p&gt;The &lt;a class=&#34;reference external&#34; href=&#34;https://1password.com/password-generator/&#34;&gt;1Password Online Generator&lt;/a&gt; (in Memorable Password mode)
also generates passphrases,
as do the desktop and browser versions of 1Password.&lt;/p&gt;
&lt;p&gt;My master password for LastPass is a passphrase,
as is my laptop password.
I&#39;m also using &lt;a class=&#34;reference external&#34; href=&#34;https://authy.com/&#34;&gt;Authy&lt;/a&gt; for 2FA, but that&#39;s a post for another time.&lt;/p&gt;
&lt;div class=&#34;admonition tip&#34;&gt;
&lt;p class=&#34;first admonition-title&#34;&gt;Tip&lt;/p&gt;
&lt;p&gt;If you have to supply answers
for one of those misbegotten &lt;a class=&#34;reference external&#34; href=&#34;https://www.okta.com/blog/2021/03/security-questions/&#34;&gt;security questions&lt;/a&gt;,
such as your favorite movie or your first car,
&lt;em&gt;do not answer truthfully&lt;/em&gt;.
Truthful answers increase your risk of identity theft.
The answers are often guessable,
can frequently be learned easily about you,
and may be obtained through a password breach on another site.&lt;/p&gt;
&lt;p&gt;Instead, generate a passphrase as the &amp;quot;answer&amp;quot;
&lt;em&gt;and store it and the question
in the Notes field of your password manager&lt;/em&gt;.
If you have to supply the answer to a security question
over the phone to a customer service rep,
you&#39;ll be thankful that you chose something
that you can clearly say aloud.&lt;/p&gt;
&lt;p class=&#34;last&#34;&gt;Also &lt;a class=&#34;reference external&#34; href=&#34;https://www.mentalfloss.com/article/522136/taking-facebook-quizzes-could-put-you-risk-identity-theft&#34;&gt;Facebook quizzes&lt;/a&gt; and memes like
&amp;quot;Your porn name is your middle name and the first car you had&amp;quot;
are trying to obtain your answers to common security questions.
Don&#39;t answer them.&lt;/p&gt;
&lt;/div&gt;
</content>
    </entry>
    
        <entry>
        <title>Punctuating James Joyce</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2021/05/08/PunctuatingJamesJoyce.html" />
        <id>tag:www.georgevreilly.com,2021-05-08:/blog/2021/05/08/PunctuatingJamesJoyce.html</id>
        <updated>2021-05-08T08:00:00Z</updated>
        <category term="jamesjoyce" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;a class=&#34;reference external image-reference&#34; href=&#34;https://www.writermag.com/improve-your-writing/revision-grammar/punctuation-bootcamp/&#34;&gt;&lt;img alt=&#34;Punctuation Boot Camp: Our ultimate grammar guide&#34; src=&#34;https://cdn.writermag.com/2018/07/punctuationbootcamp_news-e1540567976133.jpg&#34;/&gt;&lt;/a&gt;
&lt;p&gt;In &lt;a class=&#34;reference external&#34; href=&#34;https://lithub.com/the-punctuation-marks-loved-and-hated-by-famous-writers/&#34;&gt;The Punctuation Marks Loved (and Hated) by Famous Writers&lt;/a&gt;,
Emily Temple relays a range of opinions from writers
such as Tom Wolfe, Elmore Leonard, and Ursula K. Le Guin
on periods, semicolons, hyphens and more.&lt;/p&gt;
&lt;p&gt;On commas:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Listens to the sound of the sentence, and is always right, Bob: Toni Morrison&lt;/p&gt;
&lt;blockquote&gt;
[On her editor, Bob Gottlieb, who famously
“was always inserting commas into Morrison’s sentences
and she was always taking them out”]
We read the same way.
We think the same way.
He is overwhelmingly aggressive about commas and all sorts of things.
He does not understand that commas are for pauses and breath.
He thinks commas are for grammatical things.
We have come to an understanding, but it is still a fight.&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;p&gt;On periods:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Tolerates it, if he must: Cormac McCarthy&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I believe in periods, in capitals, in the occasional comma, and that’s it.&lt;/p&gt;
&lt;ul class=&#34;simple&#34;&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;James Joyce is a good model for punctuation.
He keeps it to an absolute minimum.
There’s no reason to blot the page up with weird little marks.
I mean, if you write properly you shouldn’t have to punctuate.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;p&gt;My own prose tends towards longer sentences,
often sprinkled with dashes, parentheses, and semicolons.&lt;/p&gt;
&lt;p&gt;Since 2004, I&#39;ve adapted all of James Joyce&#39;s &lt;em&gt;Ulysses&lt;/em&gt; for staged readings
by the &lt;a class=&#34;reference external&#34; href=&#34;https://www.wildgeeseseattle.org/&#34;&gt;Wild Geese Players of Seattle&lt;/a&gt;,
and I&#39;m in the Morrison camp, not the McCarthy–Joyce one.&lt;/p&gt;
&lt;p&gt;Paragraphs like these work on the printed page.
(More or less.)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The tear is bloody near your eye.
Talking through his bloody hat.
Fitter for him go home to the little sleepwalking bitch he married,
Mooney, the bumbailiff&#39;s daughter,
mother kept a kip in Hardwicke street,
that used to be stravaging about the landings
Bantam Lyons told me
that was stopping there at two in the morning without a stitch on her,
exposing her person, open to all comers, fair field and no favour.&lt;/p&gt;
&lt;p class=&#34;attribution&#34;&gt;&amp;mdash;Anonymous narrator, Episode 12, “Cyclops”, L400&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Martin Cunningham forgot to give us his &lt;a class=&#34;reference external&#34; href=&#34;http://www.jjon.org/joyce-s-allusions/spellingbee-conundrum&#34;&gt;spellingbee conundrum&lt;/a&gt; this morning.
It is amusing to view the unpar one ar alleled embarra two ars is it?
double ess ment of a harassed pedlar while gauging au the symmetry with a y
of a peeled pear under a cemetery wall.
Silly, isn&#39;t it? Cemetery put in of course on account of the symmetry.&lt;/p&gt;
&lt;p class=&#34;attribution&#34;&gt;&amp;mdash;Mr Bloom, Episode 7, “Aeolus”, L170&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;But imagine trying to read those sentences &lt;em&gt;aloud&lt;/em&gt; during a performance
and bring the sense of the text to the audience.&lt;/p&gt;
&lt;p&gt;As an aide to my performers,
I&#39;ve introduced “cadence bars” (denoted by ‘≀’) to the scripts
to augment Joyce&#39;s sparse punctuation
and to bring out the individual fragments.&lt;/p&gt;
&lt;blockquote&gt;
The tear is bloody near your eye.
Talking through his bloody hat.
Fitter for him go home ≀
to the little sleepwalking bitch he married,
Mooney,
the bum·bailiff&#39;s daughter,
mother kept a kip in Hardwicke street,
that used to be stravaging about the landings ≀
Bantam Lyons told me ≀
that was stopping there at two in the morning ≀
without a stitch on her,
exposing her person,
open to all comers,
fair field and no favour.&lt;/blockquote&gt;
&lt;p&gt;&lt;/p&gt;
&lt;blockquote&gt;
Martin Cunningham forgot to give us his spelling·bee conundrum this morning.
It is amusing to view the ≀
unpar ≀
one ar ≀
alleled ≀
embarra ≀
two ars is it? ≀
double ess ≀
ment ≀
of a harassed pedlar ≀
while gauging ≀
au ≀
the symmetry ≀
with a y ≀
of a peeled pear ≀
under a cemetery wall.
Silly, isn&#39;t it?
Cemetery put in of course ≀
on account of the symmetry.&lt;/blockquote&gt;
&lt;p&gt;I&#39;ve also added some pseudo-hyphens
(bum·bailiff, spelling·bee, what·do·you·call·him)
to counteract Joyce&#39;s Germanic habit of stringing several words into one.&lt;/p&gt;
&lt;p&gt;This seems to help,
though some of our readers have to fight a tendency to pause too much
when they encounter a ‘≀’ symbol.&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>Now You Have 32 Problems</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2020/04/23/regex-32-problems.html" />
        <id>tag:www.georgevreilly.com,2020-04-23:/blog/2020/04/23/regex-32-problems.html</id>
        <updated>2020-04-23T08:00:00Z</updated>
        <category term="regex" />
        <category term="performance" />
        <category term="til" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;p&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Some people, when confronted with a problem, think
“I know, I&#39;ll use regular expressions.”
&lt;a class=&#34;reference external&#34; href=&#34;http://regex.info/blog/2006-09-15/247&#34;&gt;Now they have two problems&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;
— Jaime Zawinksi&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;p&gt;A Twitter thread about &lt;a class=&#34;reference external&#34; href=&#34;https://twitter.com/nbashaw/status/1253186961482715136&#34;&gt;very long regexes&lt;/a&gt;
reminded me of the &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2009/07/11/64bitWindows7.html&#34;&gt;longest regex&lt;/a&gt; that I ever ran afoul of,
a particularly horrible multilevel mess
that had worked acceptably on the 32-bit .NET CLR,
but brought the 64-bit CLR to its knees.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Whenever I ran our ASP.NET web application [on Win64],
it would go berserk, eat up all 4GB of my physical RAM,
push the working set of IIS&#39;s w3wp.exe to &lt;em&gt;12GB&lt;/em&gt;,
and max out one of my 4&amp;nbsp;cores!
The only way to maintain any sanity was to run &lt;tt class=&#34;docutils literal&#34;&gt;iisreset&lt;/tt&gt;
every 20&amp;nbsp;minutes to gently kill the process.&lt;/p&gt;
&lt;p&gt;WinDbg and Process Explorer showed that the rogue thread was stuck in a loop in
&lt;tt class=&#34;docutils literal&#34;&gt;mscorjit!LifetimesListInteriorBlocksHelperIterative&amp;lt;GCInfoLiveRecordManipulator&amp;gt;&lt;/tt&gt;.
I passed a minidump on to my former colleagues in IIS, who sent it to the CLR team.
They said:&lt;/p&gt;
&lt;blockquote&gt;
The only thing I can tell is that it is Regex,
and some regex expression compiled down to a method with 456KB of IL.
That is &lt;em&gt;huge&lt;/em&gt;, and yes 12GB of RAM consumed for something like that is expected.&lt;/blockquote&gt;
&lt;p&gt;With that clue, I was able to track down the problem,
a particularly foul regex, built from a 10KB string,
with 32&amp;nbsp;alternating expressions,
each of which contains dozens of alternated subexpressions.
The string is built from many smaller strings,
so it&#39;s not obvious in the source just how ugly it is.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I never wrote a followup post explaining how I dealt with this beast.&lt;/p&gt;
&lt;p&gt;The regex was used on the &lt;a class=&#34;reference external&#34; href=&#34;https://www.cozi.com/calendar/&#34;&gt;Cozi calendar&lt;/a&gt;
to parse appointments in everyday language,
such as “Ann/John Dinner out Friday at 8pm”
or “John&#39;s birthday every Dec. 7”.
These would get translated into (possibly recurring) &lt;a class=&#34;reference external&#34; href=&#34;https://tools.ietf.org/html/rfc5545&#34;&gt;iCalendar&lt;/a&gt; appointments.&lt;/p&gt;
&lt;p&gt;Some of the subexpressions mentioned above looked like:&lt;/p&gt;
&lt;ul class=&#34;simple&#34;&gt;
&lt;li&gt;&lt;tt class=&#34;docutils literal&#34;&gt;ordinals = &lt;span class=&#34;pre&#34;&gt;&amp;quot;1st|2nd|...|31st&amp;quot;&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class=&#34;docutils literal&#34;&gt;short_days = &lt;span class=&#34;pre&#34;&gt;&amp;quot;Sun|Mon|...|Sat&amp;quot;&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class=&#34;docutils literal&#34;&gt;full_days = &lt;span class=&#34;pre&#34;&gt;&amp;quot;Sunday|Monday|...|Saturday&amp;quot;&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class=&#34;docutils literal&#34;&gt;short_months = &lt;span class=&#34;pre&#34;&gt;&amp;quot;Jan|Feb|...|Dec&amp;quot;&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class=&#34;docutils literal&#34;&gt;full_months = &lt;span class=&#34;pre&#34;&gt;&amp;quot;January|February|...|December&amp;quot;&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class=&#34;docutils literal&#34;&gt;recurrence = &lt;span class=&#34;pre&#34;&gt;&amp;quot;((every|each)?&lt;/span&gt; (first|second|third|fourth|fifth|last)? &amp;quot;
+ &amp;quot;(&amp;quot; + short_days + &amp;quot;|&amp;quot; + full_days + &amp;quot;)&amp;quot; + ...&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I&#39;ve elided the intermediate values but they were spelled out in the original.
Some of the simpler subexpressions were repeated several times,
nested inside others.&lt;/p&gt;
&lt;p&gt;This all screamed &lt;em&gt;grammar&lt;/em&gt; and &lt;em&gt;real parser&lt;/em&gt; to me,
but the test suite also screamed &lt;em&gt;here be dragons!&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;I resisted the temptation
to rewrite the appointment parser from scratch with a proper grammar,
or to experiment with a real natural language parser,
though it remained on my personal todo list for the rest of my time at Cozi.
We were migrating from C# to Python at that point,
and the legacy appointment parser was one of the few remaining pieces
that prevented us from shutting down the .NET servers.&lt;/p&gt;
&lt;p&gt;Instead, I changed the appointment parser code
so that it didn&#39;t attempt to match the entire 10KB monster in one go.
I looped through each of the 32 top-level disjunctions,
manually performing the alternation.
If any one of those matched, then I had what I needed.
Reducing the regexes to a few hundred characters each
tamed the combinatorial explosion of backtracking state.&lt;/p&gt;
&lt;p&gt;Regexes definitely have a place,
but do not try to implement a full grammar as a single regular expression.&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>Weirdest Birthday Ever</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2020/03/15/WeirdestBirthdayEver.html" />
        <id>tag:www.georgevreilly.com,2020-03-15:/blog/2020/03/15/WeirdestBirthdayEver.html</id>
        <updated>2020-03-15T08:00:00Z</updated>
        <category term="personal" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;p&gt;When I said that Emma and I would be spending &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2019/11/22/Dublin2020.html&#34;&gt;2020 in Dublin&lt;/a&gt;,
I could not possibly have anticipated what would be happening in Seattle
while we were gone.&lt;/p&gt;
&lt;p&gt;Today is my 55th birthday and it&#39;s the weirdest birthday ever,
in what must be the weirdest week that most of us have lived through.
(So far.)&lt;/p&gt;
&lt;p&gt;COVID-19 is all that anyone can talk about:
where it&#39;s spreading, how it&#39;s being handled, what comes next.&lt;/p&gt;
&lt;p&gt;I started working from home on Tuesday, March 10th.
Emma&#39;s general health and immune system are not good.
My parents, who live nearby,
are now both 80 years old and neither is in great health.
It seemed prudent to minimize my risk of passing something on to any of them.
Since then, Stripe has closed most offices,
as have many other companies.&lt;/p&gt;
&lt;p&gt;Ireland has closed schools, banned large gatherings,
and is generally trying not to become like Italy.
St Patrick&#39;s Day parades are cancelled.
Most pubs have not yet closed and I wish they would,
since they are now a public health risk.&lt;/p&gt;
&lt;p&gt;If Ireland institutes a full lockdown,
we&#39;ll move in with my parents for the duration—assuming that none of us are showing signs of COVID-19.&lt;/p&gt;
&lt;p&gt;Seattle has been ground zero for coronavirus in the US.
All of the initial deaths were there.
Some hospitals are already overwhelmed,
and I&#39;m sure others will be as the number of cases
rises exponentially.
Governor Inslee and other state and city leaders
have been doing a good job of managing the crisis.&lt;/p&gt;
&lt;p&gt;I wish I could say the same about the United States as a whole.
It was &lt;em&gt;always&lt;/em&gt; obvious that Trump was wholly unfit to be president,
but it&#39;s never been more clear over the past month.
I fear for my adopted country.&lt;/p&gt;
&lt;p&gt;Anyway, we&#39;re heading off to my parents soon,
for a subdued birthday celebration.&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>Dublin for 2020</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2019/11/22/Dublin2020.html" />
        <id>tag:www.georgevreilly.com,2019-11-22:/blog/2019/11/22/Dublin2020.html</id>
        <updated>2019-11-22T08:00:00Z</updated>
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;a class=&#34;reference external image-reference&#34; href=&#34;https://www.irishcalendars.ie/products/dublin-calendar&#34;&gt;&lt;img alt=&#34;Dublin Calendar 2020&#34; src=&#34;https://www.georgevreilly.com/content/binary/dublin-calendar-2020.jpg&#34;/&gt;&lt;/a&gt;
&lt;p&gt;I left in the Eighties; I&#39;m going back in the Twenties.&lt;/p&gt;
&lt;p&gt;I am transferring to a Dublin-based team at &lt;a class=&#34;reference external&#34; href=&#34;https://stripe.com/&#34;&gt;Stripe&lt;/a&gt; for a one-year rotation.
Emma and I will be moving to Dublin just before Christmas.
Emma has never lived in Ireland
and I haven&#39;t lived there since January 1989.
After 30 years in the US, I&#39;m about to spend a year in my hometown.&lt;/p&gt;
&lt;p&gt;I grew up in Dublin,
earned a Bachelor&#39;s degree in Computer Science at Trinity College Dublin in 1987,
and moved to the US in 1989
to get a Master&#39;s degree in Comp Sci at Brown University in Providence, RI.
Microsoft moved me to Seattle, WA in 1992,
where I&#39;ve lived ever since.
Between 1992 and 2005,
I worked at Microsoft three times
for a total of ten years.
I joined Stripe in Seattle in mid-2018,
after eleven years at two startups,
Cozi and Cookbrite/MetaBrite.&lt;/p&gt;
&lt;p&gt;Emma and I met in 1997,
and married and bought a house in 2000.
We are now frantically trying to get that house into shape
to rent out during our year&#39;s absence.
We&#39;ve been working all-out for several weeks
and now there&#39;s only four weeks to go.
She carried the burden by herself last week,
as I spent the week in Dublin, meeting my new team.
I had done so much painting of interior rooms
before I went to Dublin two weeks ago,
that the fingerprint readers on my laptop and phones
were rejecting my fingerprint.
My fingerprint works again,
but there&#39;s still a little painting to be done.&lt;/p&gt;
&lt;p&gt;We&#39;re excited and nervous.
It&#39;s not easy to pick up and move after spending decades in one city.
We have plenty of storage in our Seattle house
and had little impetus—until now—to shed stuff.
And there&#39;s lots and lots of stuff.
Thousands upon thousands of books,
the impedimenta of various hobbies,
and twenty years of odds and ends.
We&#39;ve purged a lot but the end is not yet in sight.
I&#39;ll be spending the second week of December in the San Jose and San Francisco,
so I&#39;ll need to spend Thanksgiving working on the house.&lt;/p&gt;
&lt;p&gt;Stripe has been great in providing relocation assistance to us,
providing services in both Seattle and Dublin.
I lined up an apartment in Dublin the day before I returned.
We&#39;ll be living at the top of a Georgian house on Adelaide Road.
It&#39;s not too small, but it&#39;ll feel cramped compared to our Seattle house.&lt;/p&gt;
&lt;p&gt;A few weeks ago, I moved from an infrastructure team in the Stripe Seattle office
to a new security team (Anti-Abuse) in the Stripe Dublin office.
Not only is the team new, all of the team members are new to Stripe:
most joined in August and the longest-tenured joined in March.
They&#39;ve already accomplished quite a bit,
but they&#39;ve left a few things for me to do.&lt;/p&gt;
&lt;p&gt;My family are excited too.
I have two siblings living in Ireland,
but they&#39;re both over two hours&#39; drive
from my parents&#39; home in Dublin.
My sister&#39;s in rural Cork and one of my brothers is in rural Mayo.
We&#39;re all going down to Cork for a few days at Christmas.&lt;/p&gt;
&lt;p&gt;Ireland, here we come!&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>A Use for Octal: Calculating Modulo 36 from Modulo 9</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2019/09/15/use-for-octal.html" />
        <id>tag:www.georgevreilly.com,2019-09-15:/blog/2019/09/15/use-for-octal.html</id>
        <updated>2019-09-15T08:00:00Z</updated>
        <category term="octal" />
        <category term="math" />
        <category term="go" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;!--  --&gt;
&lt;blockquote&gt;
(I posted an &lt;a class=&#34;reference external&#34; href=&#34;https://weblogs.asp.net/george_v_reilly/284388&#34;&gt;earlier version&lt;/a&gt; of this in December 2004 on my old technical blog.
A discussion at work last week about 36-bit computers at the &lt;a class=&#34;reference external&#34; href=&#34;https://livingcomputers.org/&#34;&gt;Living Computers Museum&lt;/a&gt;
prompted me to write an updated post with improved explanations and much better typography.)&lt;/blockquote&gt;
&lt;p&gt;I&#39;ve been programming in C since 1985 and C++ since 1991,
but I&#39;ve never found a use for &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Octal&#34;&gt;octal&lt;/a&gt; representation until [2004],
aside from the permissions argument for &lt;a class=&#34;reference external&#34; href=&#34;http://en.wikipedia.org/wiki/Chmod&#34;&gt;chmod&lt;/a&gt;.
Octal has always seemed as vestigial as a human appendix,
a leftover from the early days of computers,
when &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Word_(computer_architecture)&#34;&gt;word sizes&lt;/a&gt; were often a multiple of three:
6-, 12-, 24-, or 36-bits wide.
All modern computers use word sizes that are powers of two—16-, 32-, or 64-bits wide—with 8-bit bytes,
so octal is less useful than hex,
which evenly subdivides bytes and words.
I&#39;ve done a lot of bit twiddling
and hexadecimal has always been indispensable,
while octal has remained a curiosity.&lt;/p&gt;
&lt;p&gt;The other day [in 2004], a mathematician friend described to me a problem
that he had solved at a previous company.
They were designing hardware that emulated some old &lt;a class=&#34;reference external&#34; href=&#34;https://retrocomputing.stackexchange.com/questions/11801/what-was-the-rationale-behind-36-bit-computer-architectures&#34;&gt;36-bit computers&lt;/a&gt;.
For backward compatibility,
the various shift instructions
had to accept an arbitrarily large shift count, &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;k&lt;/i&gt;&lt;/span&gt;,
and shift left or right by &lt;span class=&#34;formula&#34;&gt;(&lt;i&gt;k&lt;/i&gt;&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;36)&lt;/span&gt;.
Now, divisions are not cheap to implement in hardware,
so they needed to come up with an alternate approach
to calculate the modulus.&lt;/p&gt;
&lt;p&gt;My friend tried to do something with the factors of 36: &lt;span class=&#34;formula&#34;&gt;4×9&lt;/span&gt;.
Four and nine are &lt;a class=&#34;reference external&#34; href=&#34;https://artofproblemsolving.com/wiki/index.php/Relatively_prime&#34;&gt;relatively prime&lt;/a&gt;:
they have no common factors other than one.
By the &lt;a class=&#34;reference external&#34; href=&#34;https://medium.com/@astartekraus/the-chinese-remainder-theorem-ea110f48248c&#34;&gt;Chinese Remainder Theorem&lt;/a&gt; therefore,
the combination of &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;k&lt;/i&gt;&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;4&lt;/span&gt;
and &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;k&lt;/i&gt;&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9&lt;/span&gt; is enough to uniquely
determine &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;k&lt;/i&gt;&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;36&lt;/span&gt;.
By inspection, this is true for the following table of “residues”.
All the integers in the range &lt;span class=&#34;formula&#34;&gt;[0, 36)&lt;/span&gt; appear exactly once.&lt;/p&gt;
&lt;table border=&#34;1&#34; class=&#34;docutils align-right&#34;&gt;
&lt;colgroup&gt;
&lt;col width=&#34;18%&#34;/&gt;
&lt;col width=&#34;9%&#34;/&gt;
&lt;col width=&#34;9%&#34;/&gt;
&lt;col width=&#34;9%&#34;/&gt;
&lt;col width=&#34;9%&#34;/&gt;
&lt;col width=&#34;9%&#34;/&gt;
&lt;col width=&#34;9%&#34;/&gt;
&lt;col width=&#34;9%&#34;/&gt;
&lt;col width=&#34;9%&#34;/&gt;
&lt;col width=&#34;9%&#34;/&gt;
&lt;/colgroup&gt;
&lt;thead valign=&#34;bottom&#34;&gt;
&lt;tr&gt;&lt;th class=&#34;head&#34;&gt;4 \ 9&lt;/th&gt;
&lt;th class=&#34;head&#34;&gt;0&lt;/th&gt;
&lt;th class=&#34;head&#34;&gt;1&lt;/th&gt;
&lt;th class=&#34;head&#34;&gt;2&lt;/th&gt;
&lt;th class=&#34;head&#34;&gt;3&lt;/th&gt;
&lt;th class=&#34;head&#34;&gt;4&lt;/th&gt;
&lt;th class=&#34;head&#34;&gt;5&lt;/th&gt;
&lt;th class=&#34;head&#34;&gt;6&lt;/th&gt;
&lt;th class=&#34;head&#34;&gt;7&lt;/th&gt;
&lt;th class=&#34;head&#34;&gt;8&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign=&#34;top&#34;&gt;
&lt;tr&gt;&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;28&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;32&lt;/td&gt;
&lt;td&gt;24&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;29&lt;/td&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;13&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;33&lt;/td&gt;
&lt;td&gt;25&lt;/td&gt;
&lt;td&gt;17&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;18&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;30&lt;/td&gt;
&lt;td&gt;22&lt;/td&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;34&lt;/td&gt;
&lt;td&gt;26&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;27&lt;/td&gt;
&lt;td&gt;19&lt;/td&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;31&lt;/td&gt;
&lt;td&gt;23&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;35&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Calculating &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;k&lt;/i&gt;&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;4&lt;/span&gt; is easy in hardware:
it&#39;s the two least-significant bits.&lt;/p&gt;
&lt;p&gt;How to calculate &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;k&lt;/i&gt;&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9&lt;/span&gt; in hardware is not so obvious.&lt;/p&gt;
&lt;div class=&#34;section&#34; id=&#34;shifting-and-masking&#34;&gt;
&lt;h3&gt;Shifting and Masking&lt;/h3&gt;
&lt;p&gt;Several programming languages now provide a &lt;tt class=&#34;docutils literal&#34;&gt;0b&lt;/tt&gt; prefix for binary literals
to go along with the &lt;tt class=&#34;docutils literal&#34;&gt;0x&lt;/tt&gt; prefix for hex literals
and the &lt;tt class=&#34;docutils literal&#34;&gt;0o&lt;/tt&gt; prefix for octal literals.
(Older languages, such as C, use a &lt;tt class=&#34;docutils literal&#34;&gt;0&lt;/tt&gt; prefix for octal and have no &lt;tt class=&#34;docutils literal&#34;&gt;0b&lt;/tt&gt; prefix.)
See the discussion in &lt;a class=&#34;reference external&#34; href=&#34;https://github.com/golang/proposal/blob/master/design/19308-number-literals.md&#34;&gt;Go number literals&lt;/a&gt; for more detail on &lt;tt class=&#34;docutils literal&#34;&gt;0b&lt;/tt&gt;,
including a list of languages that now support this notation.&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;formula&#34;&gt;2&lt;sup&gt;&lt;i&gt;n&lt;/i&gt;&lt;/sup&gt;&lt;/span&gt;, written in binary, looks like &lt;tt class=&#34;docutils literal&#34;&gt;1&lt;/tt&gt; followed by &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;n&lt;/i&gt;&lt;/span&gt;&amp;nbsp;&lt;tt class=&#34;docutils literal&#34;&gt;0&lt;/tt&gt;s.
For example, &lt;span class=&#34;formula&#34;&gt;2&lt;sup&gt;3&lt;/sup&gt; = 1000&lt;sub&gt;2&lt;/sub&gt;&lt;/span&gt;.
In C-like languages, &lt;span class=&#34;formula&#34;&gt;2&lt;sup&gt;&lt;i&gt;n&lt;/i&gt;&lt;/sup&gt;&lt;/span&gt; can be written as &lt;tt class=&#34;docutils literal&#34;&gt;1 &amp;lt;&amp;lt; n&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Similarly, &lt;span class=&#34;formula&#34;&gt;2&lt;sup&gt;&lt;i&gt;n&lt;/i&gt;&lt;/sup&gt; − 1&lt;/span&gt;, &lt;tt class=&#34;docutils literal&#34;&gt;(1 &amp;lt;&amp;lt; n) - 1&lt;/tt&gt;,
written in binary, looks like &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;n&lt;/i&gt;&lt;/span&gt;&amp;nbsp;&lt;tt class=&#34;docutils literal&#34;&gt;1&lt;/tt&gt;s.
For example, &lt;span class=&#34;formula&#34;&gt;2&lt;sup&gt;5&lt;/sup&gt; − 1 = 31&lt;sub&gt;10&lt;/sub&gt; = 11111&lt;sub&gt;2&lt;/sub&gt;&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;We can &lt;strong&gt;multiply&lt;/strong&gt; an unsigned integer, &lt;tt class=&#34;docutils literal&#34;&gt;u&lt;/tt&gt;, by &lt;span class=&#34;formula&#34;&gt;2&lt;sup&gt;&lt;i&gt;n&lt;/i&gt;&lt;/sup&gt;&lt;/span&gt;
by &lt;strong&gt;shifting&lt;/strong&gt; &lt;tt class=&#34;docutils literal&#34;&gt;u&lt;/tt&gt; &lt;strong&gt;left&lt;/strong&gt; by &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;n&lt;/i&gt;&lt;/span&gt; bits, &lt;tt class=&#34;docutils literal&#34;&gt;u &amp;lt;&amp;lt; n&lt;/tt&gt;,
introducing &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;n&lt;/i&gt;&lt;/span&gt;&amp;nbsp;zeroes as the low-order bits.
For example, using 8-bit numbers without loss of generality,
written as modern Go/Rust number literals:&lt;/p&gt;
&lt;pre class=&#34;code rust literal-block&#34;&gt;
&lt;span class=&#34;mb&#34;&gt;0b_0001_0101&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mb&#34;&gt;0b_1010_1000&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Similarly, we can &lt;strong&gt;divide&lt;/strong&gt; &lt;tt class=&#34;docutils literal&#34;&gt;u&lt;/tt&gt; by &lt;span class=&#34;formula&#34;&gt;2&lt;sup&gt;&lt;i&gt;n&lt;/i&gt;&lt;/sup&gt;&lt;/span&gt;
by &lt;strong&gt;shifting&lt;/strong&gt; &lt;tt class=&#34;docutils literal&#34;&gt;u&lt;/tt&gt; &lt;strong&gt;right&lt;/strong&gt; by &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;n&lt;/i&gt;&lt;/span&gt;&amp;nbsp;bits, &lt;tt class=&#34;docutils literal&#34;&gt;u &amp;gt;&amp;gt;&amp;gt; n&lt;/tt&gt;,
which drops the &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;n&lt;/i&gt;&lt;/span&gt;&amp;nbsp;low-order bits
and introduces &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;n&lt;/i&gt;&lt;/span&gt;&amp;nbsp;zeroes as the high-order bits.&lt;/p&gt;
&lt;pre class=&#34;code rust literal-block&#34;&gt;
&lt;span class=&#34;mb&#34;&gt;0b_0101_0110&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mb&#34;&gt;0b_0000_1010&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;A sign-extending or arithmetic right shift introduces &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;n&lt;/i&gt;&lt;/span&gt;&amp;nbsp;copies
of the sign bit as the high-order bits.
In some languages, such as Java and JavaScript,
&lt;tt class=&#34;docutils literal&#34;&gt;&amp;gt;&amp;gt;&lt;/tt&gt;&amp;nbsp;means an arithmetic right shift and
&lt;tt class=&#34;docutils literal&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/tt&gt;&amp;nbsp;means a zero-extending right shift.
In other languages, including C, C++, and Go,
there is only a &lt;tt class=&#34;docutils literal&#34;&gt;&amp;gt;&amp;gt;&lt;/tt&gt; operator and
sign-extension generally depends upon the type of the left operand,
&lt;tt class=&#34;docutils literal&#34;&gt;signed&lt;/tt&gt; or &lt;tt class=&#34;docutils literal&#34;&gt;unsigned&lt;/tt&gt;.
However, sign extension is not guaranteed in C/C++.&lt;/p&gt;
&lt;pre class=&#34;code rust literal-block&#34;&gt;
&lt;span class=&#34;mb&#34;&gt;0b_0101_0110&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mb&#34;&gt;0b_0001_0101&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;mb&#34;&gt;0b_1001_0110&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mb&#34;&gt;0b_1110_0101&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Finally, we can find the &lt;strong&gt;remainder&lt;/strong&gt; of dividing &lt;tt class=&#34;docutils literal&#34;&gt;u&lt;/tt&gt; by &lt;span class=&#34;formula&#34;&gt;2&lt;sup&gt;&lt;i&gt;n&lt;/i&gt;&lt;/sup&gt;&lt;/span&gt;
by &lt;strong&gt;masking&lt;/strong&gt; &lt;tt class=&#34;docutils literal&#34;&gt;u&lt;/tt&gt; with &lt;span class=&#34;formula&#34;&gt;2&lt;sup&gt;&lt;i&gt;n&lt;/i&gt;&lt;/sup&gt; − 1&lt;/span&gt;,
that is, &lt;strong&gt;bitwise-and&lt;/strong&gt; with &lt;tt class=&#34;docutils literal&#34;&gt;(1 &amp;lt;&amp;lt; n) - 1&lt;/tt&gt;,
to extract the &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;n&lt;/i&gt;&lt;/span&gt;&amp;nbsp;&lt;strong&gt;low-order bits&lt;/strong&gt;:&lt;/p&gt;
&lt;pre class=&#34;code rust literal-block&#34;&gt;
&lt;span class=&#34;mb&#34;&gt;0b_0101_0110&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mb&#34;&gt;0b_0000_0111&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mb&#34;&gt;0b_0000_0110&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;In other words, &lt;tt class=&#34;docutils literal&#34;&gt;u % 8 == u &amp;amp; 7&lt;/tt&gt; and &lt;tt class=&#34;docutils literal&#34;&gt;u / 8 == u &amp;gt;&amp;gt; 3&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Read &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Bitwise_operation&#34;&gt;bitwise operations&lt;/a&gt; for more background.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section&#34; id=&#34;casting-out-nines&#34;&gt;
&lt;h3&gt;Casting Out Nines&lt;/h3&gt;
&lt;p&gt;There&#39;s an old trick for checking the results of arithmetic operations,
known as &lt;a class=&#34;reference external&#34; href=&#34;http://mathworld.wolfram.com/CastingOutNines.html&#34;&gt;casting out nines&lt;/a&gt; or &lt;a class=&#34;reference external&#34; href=&#34;http://web.archive.org/web/20060101140519/http://web.mit.edu/mwpstr/www/dropnine.htm&#34;&gt;dropping nines&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Add up the decimal digits of each number.
Apply the arithmetic operation to these digit sums.
They should be &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Congruence_relation&#34;&gt;congruent&lt;/a&gt;, modulo 9.&lt;/p&gt;
&lt;p&gt;For example, &lt;span class=&#34;formula&#34;&gt;12, 345×8, 765 = 108, 203, 925&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;To check the multiplication,
compute the &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Digit_sum&#34;&gt;digit sum&lt;/a&gt; of each number,
by adding up each decimal digit:&lt;/p&gt;
&lt;div class=&#34;line-block&#34;&gt;
&lt;div class=&#34;line&#34;&gt;&lt;span class=&#34;formula&#34;&gt;1 + 2 + 3 + 4 + 5 = 15 ≡ 6 (&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9)&lt;/span&gt;&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Note: &lt;span class=&#34;formula&#34;&gt;12, 345&lt;span class=&#34;textrm&#34;&gt;  mod &lt;/span&gt;9 = 6&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;and&lt;/p&gt;
&lt;div class=&#34;line-block&#34;&gt;
&lt;div class=&#34;line&#34;&gt;&lt;span class=&#34;formula&#34;&gt;8 + 7 + 6 + 5 = 26 ≡ 8 (&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9)&lt;/span&gt;&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Note: &lt;span class=&#34;formula&#34;&gt;8, 765&lt;span class=&#34;textrm&#34;&gt;  mod &lt;/span&gt;9 = 8&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Take the first two digit sums, modulo 9, and multiply them:&lt;/p&gt;
&lt;div class=&#34;line-block&#34;&gt;
&lt;div class=&#34;line&#34;&gt;&lt;span class=&#34;formula&#34;&gt;6×8 = 48 ≡ 3 (&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9)&lt;/span&gt;&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Note: &lt;span class=&#34;formula&#34;&gt;15×26 = 390 ≡ 3 (&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9)&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Check against the sum of the digits of the product:&lt;/p&gt;
&lt;div class=&#34;line-block&#34;&gt;
&lt;div class=&#34;line&#34;&gt;&lt;span class=&#34;formula&#34;&gt;1 + 0 + 8 + 2 + 0 + 3 + 9 + 2 + 5 = 30 ≡ 3 (&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9)&lt;/span&gt;&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Note: &lt;span class=&#34;formula&#34;&gt;108, 203, 925&lt;span class=&#34;textrm&#34;&gt;  mod &lt;/span&gt;9 = 3&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This works because &lt;span class=&#34;formula&#34;&gt;10&lt;sup&gt;&lt;i&gt;n&lt;/i&gt;&lt;/sup&gt; ≡ 1 (&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Consider 758:&lt;/p&gt;
&lt;div class=&#34;formula&#34;&gt;
758 = 7×100 + 5×10 + 8
&lt;/div&gt;
&lt;div class=&#34;formula&#34;&gt;
758 = 7×(9 + 1)×(9 + 1) + 5×(9 + 1) + 8
&lt;/div&gt;
&lt;div class=&#34;formula&#34;&gt;
758 = 7×(9&lt;sup&gt;2&lt;/sup&gt; + 2×9 + 1) + 5×(9 + 1) + 8
&lt;/div&gt;
&lt;p&gt;Dropping the nines from each term leaves the digit sum,
which is &lt;em&gt;congruent&lt;/em&gt; to the original number modulo nine:&lt;/p&gt;
&lt;div class=&#34;formula&#34;&gt;
7×1 + 5×1 + 8 = 7 + 5 + 8 = 20 ≡ 2 (&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9)
&lt;/div&gt;
&lt;p&gt;Checking: &lt;span class=&#34;formula&#34;&gt;758&lt;span class=&#34;textrm&#34;&gt;  mod &lt;/span&gt;9 = 2&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://www.math.nyu.edu/faculty/hausner/congruence.pdf&#34;&gt;Congruences&lt;/a&gt; have a number of useful properties.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section&#34; id=&#34;casting-out-elevens&#34;&gt;
&lt;h3&gt;Casting Out Elevens&lt;/h3&gt;
&lt;p&gt;Let&#39;s use 11, instead of 9.
Since &lt;span class=&#34;formula&#34;&gt;10 = 11 − 1&lt;/span&gt;, then &lt;span class=&#34;formula&#34;&gt;10&lt;sup&gt;&lt;i&gt;n&lt;/i&gt;&lt;/sup&gt; ≡  − 1&lt;sup&gt;&lt;i&gt;n&lt;/i&gt;&lt;/sup&gt; (&lt;span class=&#34;textrm&#34;&gt;mod &lt;/span&gt;11)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Consider 5234:&lt;/p&gt;
&lt;div class=&#34;formula&#34;&gt;
5234 = 5×10&lt;sup&gt;3&lt;/sup&gt; + 2×10&lt;sup&gt;2&lt;/sup&gt; + 3×10&lt;sup&gt;1&lt;/sup&gt; + 4×10&lt;sup&gt;0&lt;/sup&gt;
&lt;/div&gt;
&lt;div class=&#34;formula&#34;&gt;
5234 = 5×(11 − 1)×(11 − 1)×(11 − 1) + 2×(11 − 1)×(11 − 1) + 3×(11 − 1) + 4
&lt;/div&gt;
&lt;div class=&#34;formula&#34;&gt;
5234 = 5×(11&lt;sup&gt;3&lt;/sup&gt; − 3×11&lt;sup&gt;2&lt;/sup&gt;×1 + 3×11×1&lt;sup&gt;2&lt;/sup&gt; − 1&lt;sup&gt;3&lt;/sup&gt;) + 2×(11&lt;sup&gt;2&lt;/sup&gt; − 2×11×1 + 1&lt;sup&gt;2&lt;/sup&gt;) + 3×(11 − 1) + 4
&lt;/div&gt;
&lt;p&gt;Dropping the elevens from each term leaves the alternating digit sum:&lt;/p&gt;
&lt;div class=&#34;formula&#34;&gt;
5× − 1 + 2×1 + 3× − 1 + 4 =  − 5 + 2 − 3 + 4 =  − 2 ≡ 9 (&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;11)
&lt;/div&gt;
&lt;p&gt;It&#39;s more convenient to proceed rightwards from the least significant digit,
&lt;span class=&#34;formula&#34;&gt;4 − 3 + 2 − 5&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Checking: &lt;span class=&#34;formula&#34;&gt;5234&lt;span class=&#34;textrm&#34;&gt;  mod &lt;/span&gt;11 = 9&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;To cast out elevens,
we calculate the &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Alternating_sum&#34;&gt;alternating sum&lt;/a&gt; &lt;em&gt;from right to left&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Casting out elevens catches some &lt;a class=&#34;reference external&#34; href=&#34;http://mathyear2013.blogspot.com/2013/01/casting-out-elevens.html&#34;&gt;transposition errors&lt;/a&gt;, unlike casting out nines.
For more, see &lt;a class=&#34;reference external&#34; href=&#34;https://artofproblemsolving.com/wiki/index.php/Divisibility_rules/Rule_for_11_proof&#34;&gt;divisibility rule for 11&lt;/a&gt;
and &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Divisibility_rule#Proof_using_basic_algebra&#34;&gt;proof for alternating sum&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section&#34; id=&#34;modulo-9&#34;&gt;
&lt;h3&gt;Modulo 9&lt;/h3&gt;
&lt;p&gt;At last, we turn to base 8, octal.
Nine bears the same relationship
to eight in octal,
as eleven does to ten in decimal:
&lt;span class=&#34;formula&#34;&gt;9&lt;sub&gt;10&lt;/sub&gt; = 11&lt;sub&gt;8&lt;/sub&gt;&lt;/span&gt;,
base plus one,
and &lt;span class=&#34;formula&#34;&gt;8&lt;sup&gt;&lt;i&gt;n&lt;/i&gt;&lt;/sup&gt; ≡  − 1&lt;sup&gt;&lt;i&gt;n&lt;/i&gt;&lt;/sup&gt; (&lt;span class=&#34;textrm&#34;&gt;mod &lt;/span&gt;9)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;We can calculate &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;k&lt;/i&gt;&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9&lt;/span&gt; in base 8 by alternately
adding and subtracting the octal digits, from right to left.
For example,
&lt;span class=&#34;formula&#34;&gt;1234&lt;sub&gt;8&lt;/sub&gt;&lt;span class=&#34;textrm&#34;&gt;  mod &lt;/span&gt;9 = 4 − 3 + 2 − 1 = 2&lt;/span&gt;.
This gives the right answer.&lt;/p&gt;
&lt;p&gt;Here&#39;s a simple, albeit incomplete, algorithm in Go.
We&#39;re masking and shifting three bits at a time,
which is tantamount to working with the octal representation of &lt;tt class=&#34;docutils literal&#34;&gt;k&lt;/tt&gt;.&lt;/p&gt;
&lt;pre class=&#34;code go literal-block&#34;&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mod9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sign&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;

    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sign&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sign&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sign&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;

    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;What about &lt;span class=&#34;formula&#34;&gt;617&lt;sub&gt;8&lt;/sub&gt;&lt;/span&gt;?&lt;/p&gt;
&lt;div class=&#34;formula&#34;&gt;
7 − 1 + 6 = 12 ≡ 3 (&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9)
&lt;/div&gt;
&lt;div class=&#34;formula&#34;&gt;
617&lt;sub&gt;8&lt;/sub&gt;&lt;span class=&#34;textrm&#34;&gt;  mod &lt;/span&gt;9 = 3
&lt;/div&gt;
&lt;p&gt;And &lt;span class=&#34;formula&#34;&gt;6172&lt;sub&gt;8&lt;/sub&gt;&lt;/span&gt;?&lt;/p&gt;
&lt;div class=&#34;formula&#34;&gt;
2 − 7 + 1 − 6 =  − 10 ≡ 8 (&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9)
&lt;/div&gt;
&lt;div class=&#34;formula&#34;&gt;
6172&lt;sub&gt;8&lt;/sub&gt;&lt;span class=&#34;textrm&#34;&gt;  mod &lt;/span&gt;9 = 8
&lt;/div&gt;
&lt;p&gt;Almost there!&lt;/p&gt;
&lt;blockquote&gt;
Casting out “octal-elevens” (&lt;span class=&#34;formula&#34;&gt;11&lt;sub&gt;8&lt;/sub&gt; = 9&lt;sub&gt;10&lt;/sub&gt;&lt;/span&gt;) in octal,
by an alternating sum of the base-eight digits,
computes a small number
&lt;em&gt;congruent&lt;/em&gt; to the original number number modulo nine.&lt;/blockquote&gt;
&lt;p&gt;The algorithm above is calculating numbers
that are congruent to the correct answer modulo nine,
but which may be outside the desired range.
If the intermediate sum dips below zero or rises above eight,
we have to add nine or subtract nine respectively
to keep the running total in the range &lt;span class=&#34;formula&#34;&gt;[0, 9)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Here&#39;s a complete algorithm for Modulo 9 in Go,
computing the alternating sum of the octal digits:&lt;/p&gt;
&lt;pre class=&#34;code go literal-block&#34;&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mod9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;negative&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;

    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;negative&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
                &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// assert(0 &amp;lt;= m &amp;amp;&amp;amp; m &amp;lt; 9)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;negative&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;negative&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;

    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Clearly, this algorithm can be implemented in much simpler circuitry
than that required to compute a remainder through full-blown division.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section&#34; id=&#34;modulo-36&#34;&gt;
&lt;h3&gt;Modulo 36&lt;/h3&gt;
&lt;p&gt;We now have enough to calculate &lt;span class=&#34;formula&#34;&gt;&lt;i&gt;k&lt;/i&gt;&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;36&lt;/span&gt;
from &lt;tt class=&#34;docutils literal&#34;&gt;Mod9&lt;/tt&gt; and the Chinese Remainder Theorem:&lt;/p&gt;
&lt;pre class=&#34;code go literal-block&#34;&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mod36&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Residues&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;28&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;24&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;33&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;17&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;18&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;34&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;26&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;27&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;19&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;23&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;35&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Residues&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mod9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;My friend says that he later learned that similar tricks were
used in classic 36-bit hardware.&lt;/p&gt;
&lt;p&gt;I looked everywhere I could think of to see if I could
find this algorithm to calculate modulo 9 described.
I found something that hinted at it in
Knuth&#39;s &lt;a class=&#34;reference external&#34; href=&#34;http://www-cs-faculty.stanford.edu/~knuth/taocp.html&#34;&gt;Seminumerical Algorithms&lt;/a&gt;, §4.4.C,
discussing &lt;a class=&#34;reference external&#34; href=&#34;https://books.google.com/books?id=Zu-HAwAAQBAJ&amp;amp;pg=PT532&amp;amp;lpg=PT532&amp;amp;dq=octal+cast+out+nines+modulo+36&amp;amp;source=bl&amp;amp;ots=9nglVlTuaU&amp;amp;sig=ACfU3U0_RR51okwrvfY3WwC0xBudfLGhuw&amp;amp;hl=en&amp;amp;sa=X&amp;amp;ved=2ahUKEwih44eUxc_kAhVVo54KHcgKDeEQ6AEwDXoECAgQAg#v=onepage&amp;amp;q=octal%20cast%20out%20nines%20modulo%2036&amp;amp;f=false&#34;&gt;converting octal integers to decimal&lt;/a&gt; by hand,
where he mentions using casting out nines in octal and in decimal
to check the result.
There was no mention of it in Warren&#39;s marvelous
&lt;a class=&#34;reference external&#34; href=&#34;http://www.informit.com/articles/article.asp?p=28678&#34;&gt;Hacker&#39;s Delight&lt;/a&gt; or in &lt;a class=&#34;reference external&#34; href=&#34;http://home.pipeline.com/~hbaker1/hakmem/hakmem.html&#34;&gt;HAKMEM&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I tried to come up with an analytic way to calculate the
elements of the &lt;span class=&#34;formula&#34;&gt;9&lt;i&gt;x&lt;/i&gt;4&lt;/span&gt; table.
The best that I found is
&lt;span class=&#34;formula&#34;&gt;(72 − 8×(&lt;i&gt;k&lt;/i&gt;&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9) + 9×(&lt;i&gt;k&lt;/i&gt;&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;4))&lt;span class=&#34;textrm&#34;&gt;  mod &lt;/span&gt;36&lt;/span&gt;!
The inner expression yields a number in the range &lt;span class=&#34;formula&#34;&gt;[0, 99]&lt;/span&gt;,
which can be reduced to &lt;span class=&#34;formula&#34;&gt;[0, 36)&lt;/span&gt;
by subtracting 36 at most twice.
From &lt;a class=&#34;reference external&#34; href=&#34;http://www-cs-faculty.stanford.edu/~knuth/gkp.html&#34;&gt;Concrete Mathematics&lt;/a&gt;,
mod 36 can be derived from mod 4 and mod 9
by looking at the [0][1] and [1][0] elements of the table:
&lt;span class=&#34;formula&#34;&gt;(9×(&lt;i&gt;k&lt;/i&gt;&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;4) + 28×(&lt;i&gt;k&lt;/i&gt;&lt;span class=&#34;textrm&#34;&gt; mod &lt;/span&gt;9))&lt;span class=&#34;textrm&#34;&gt;  mod &lt;/span&gt;36&lt;/span&gt;.
It works, but it&#39;s even worse.
A table lookup is clearly more efficient.&lt;/p&gt;
&lt;p&gt;Most, if not all, of the computer architectures
designed in the last forty years
use a word size that is a power of two.
Useful relationships like shifting and masking are one big reason
why non-power-of-two word sizes have gone out of fashion.&lt;/p&gt;
&lt;p&gt;Another big reason is the success of C and Unix,
which have a bias towards 8-bit bytes.
&lt;a class=&#34;reference external&#34; href=&#34;http://www.parashift.com/c++-faq-lite/intrinsic-types.html&#34;&gt;C doesn&#39;t require 8-bit bytes&lt;/a&gt;,
but there&#39;s a lot of software which tacitly assumes that
&lt;tt class=&#34;docutils literal&#34;&gt;char&lt;/tt&gt; has exactly 8 bits.&lt;/p&gt;
&lt;p&gt;On systems with 9-bit bytes,
like the 36-bit computers,
octal is useful,
since a 9-bit byte can hold all values up to &lt;span class=&#34;formula&#34;&gt;777&lt;sub&gt;8&lt;/sub&gt;&lt;/span&gt;
and the word size is a multiple of three.&lt;/p&gt;
&lt;p&gt;And there you have it: an unexpected use for octal notation.
It&#39;s not exactly an important use,
but then 36-bit computers aren&#39;t exactly important any more either.&lt;/p&gt;
&lt;/div&gt;
</content>
    </entry>
    
        <entry>
        <title>Decrypting Blackbox secrets at build time with Paperkey</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2019/09/02/gpg-blackbox-paperkey.html" />
        <id>tag:www.georgevreilly.com,2019-09-02:/blog/2019/09/02/gpg-blackbox-paperkey.html</id>
        <updated>2019-09-02T08:00:00Z</updated>
        <category term="gpg" />
        <category term="blackbox" />
        <category term="jenkins" />
        <category term="bash" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;blockquote&gt;
“Security is 1% technology plus 99% following the procedures correctly” — Tom Limoncelli&lt;/blockquote&gt;
&lt;p&gt;Having dealt with GPG last week at work,
I remembered that I had intended to write a blog post
about how we used &lt;a class=&#34;reference external&#34; href=&#34;https://gnupg.org/&#34;&gt;GPG&lt;/a&gt;, &lt;a class=&#34;reference external&#34; href=&#34;https://github.com/StackExchange/blackbox&#34;&gt;Blackbox&lt;/a&gt;, and &lt;a class=&#34;reference external&#34; href=&#34;http://www.jabberwocky.com/software/paperkey/&#34;&gt;Paperkey&lt;/a&gt; to store secrets in Git
at my &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2018/12/31/2018-review.html&#34;&gt;previous job&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We used Blackbox to manage secrets that were needed
during development, build, deployment, and runtime.
These secrets included AWS credentials, Docker registry credentials,
our private PyPI credentials, database credentials, and certificates.
We wanted these secrets to be under version control,
but also to be secure.&lt;/p&gt;
&lt;p&gt;For example, we had a &lt;tt class=&#34;docutils literal&#34;&gt;credentials.sh&lt;/tt&gt; that exported environment variables,
which was managed by Blackbox:&lt;/p&gt;
&lt;pre class=&#34;code bash literal-block&#34;&gt;
&lt;span class=&#34;c1&#34;&gt;# Save current value of xtrace option from $-; disable echoing of executed commands
&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$-&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep -q &lt;span class=&#34;s2&#34;&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;XT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;-x&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;XT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;+x&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; +x&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&amp;gt;/dev/null

&lt;span class=&#34;c1&#34;&gt;# export environment variables, many containing secrets
&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;AWS_ACCESS_KEY_ID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;...&#39;&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;AWS_SECRET_ACCESS_KEY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;...&#39;&lt;/span&gt;

&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PYPI_USER&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;build&#39;&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PYPI_PASSWD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;...&#39;&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PIP_INDEX_URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;https://&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$PYPI_USER&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$PYPI_PASSWD&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#64;pypi.example.com/pypi/&amp;quot;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Restore previous value of xtrace option
&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$XT&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;The &lt;tt class=&#34;docutils literal&#34;&gt;XT&lt;/tt&gt; prologue ensures that even if this script is &lt;tt class=&#34;docutils literal&#34;&gt;source&lt;/tt&gt;’d
with &lt;a class=&#34;reference external&#34; href=&#34;https://renenyffenegger.ch/notes/Linux/shell/bash/built-in/set/x&#34;&gt;set -x&lt;/a&gt; (debug tracing) enabled,
that executing this script will not leak secrets into build logs.
The epilogue turns the &lt;tt class=&#34;docutils literal&#34;&gt;xtrace&lt;/tt&gt; option back on again if it was on at the start.&lt;/p&gt;
&lt;p&gt;We used &lt;a class=&#34;reference external&#34; href=&#34;https://www.lastpass.com/&#34;&gt;LastPass&lt;/a&gt; to manage personal credentials that were needed in a browser,
but it wasn&#39;t suitable for automated use in CI.&lt;/p&gt;
&lt;div class=&#34;section&#34; id=&#34;how-blackbox-works&#34;&gt;
&lt;h3&gt;How Blackbox Works&lt;/h3&gt;
&lt;p&gt;Blackbox builds on top of &lt;a class=&#34;reference external&#34; href=&#34;https://gnupg.org/&#34;&gt;GNU Privacy Guard&lt;/a&gt; (aka GnuPG aka GPG)
to automate the secure management
of a set of files containing secrets
that are “encrypted at rest”
and stored in a Version Control System (VCS), such as Git.
These registered files are owned collectively by a set of administrators,
each of whom has their own separate keypair
(a public key and a private key)
stored in their own keyrings.
The administrators&#39; public keys are also present in Blackbox&#39;s keyring,
which is stored in the VCS.
Using Blackbox&#39;s commands,
any administrator can decrypt a file containing secrets,
update the secrets in the file,
encrypt the updated secrets file,
and commit that encrypted file into the VCS.
Administrators can be removed from a Blackbox installation,
after which they will not be able to decrypt the updated secrets files&lt;a class=&#34;footnote-reference&#34; href=&#34;https://www.georgevreilly.com/blog/2019/09/02/gpg-blackbox-paperkey.html/#revocation&#34; id=&#34;footnote-reference-1&#34;&gt;[1]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;How does Blackbox encrypt a file so that any administrator can decrypt it?
It uses GPG to encrypt the file for multiple recipients,
say, &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Alice_and_Bob#Cast_of_characters&#34;&gt;Alice, Bob, and Carol&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;When GPG encrypts a file, it:&lt;/p&gt;
&lt;ul class=&#34;simple&#34;&gt;
&lt;li&gt;creates a random &lt;em&gt;session key&lt;/em&gt; for &lt;a class=&#34;reference external&#34; href=&#34;https://www.ssl2buy.com/wiki/symmetric-vs-asymmetric-encryption-what-are-differences&#34;&gt;symmetric encryption&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;writes a header for &lt;em&gt;each recipient&lt;/em&gt;, containing:&lt;ul&gt;
&lt;li&gt;the ID of the recipient&#39;s public key&lt;/li&gt;
&lt;li&gt;the result of asymmetrically encrypting the session key
with the recipient&#39;s public key&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;possibly signs the data&lt;/li&gt;
&lt;li&gt;compresses the (signed) data&lt;/li&gt;
&lt;li&gt;symmetrically encrypts the compressed data with the session key&lt;/li&gt;
&lt;li&gt;writes the encrypted, compressed data&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Only the recipients have the private keys (in theory, at least).
Therefore, only a recipient can decrypt the encrypted file.&lt;/p&gt;
&lt;p&gt;To decrypt the file for a recipient, GPG:&lt;/p&gt;
&lt;ul class=&#34;simple&#34;&gt;
&lt;li&gt;finds the encrypted session key packet
whose keyID matches the recipient&#39;s public key&lt;/li&gt;
&lt;li&gt;decrypts the session key using the recipient&#39;s private key&lt;/li&gt;
&lt;li&gt;decrypts the encrypted, compressed data using the session key&lt;/li&gt;
&lt;li&gt;decompresses the decrypted data&lt;/li&gt;
&lt;li&gt;verifies the signature, if present&lt;/li&gt;
&lt;li&gt;writes the cleartext&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This is a hybrid scheme.
Symmetric encryption is a lot &lt;a class=&#34;reference external&#34; href=&#34;https://www.ssl2buy.com/wiki/symmetric-vs-asymmetric-encryption-what-are-differences&#34;&gt;faster and more compact&lt;/a&gt;
than public key/private key asymmetric encryption,
so it&#39;s used to encrypt the actual data.
Furthermore, if the data were entirely encrypted with a recipient&#39;s public key,
then encrypting for &lt;em&gt;N&lt;/em&gt; recipients would mean that the size of the result
would be proportional to the
(number of recipients) × (the length of the original data).
With the hybrid scheme,
the header grows a &lt;a class=&#34;reference external&#34; href=&#34;https://security.stackexchange.com/questions/8245/gpg-file-size-with-multiple-recipients&#34;&gt;few hundred bytes&lt;/a&gt; for each recipient
but the data is encrypted only once, with faster encryption.&lt;/p&gt;
&lt;p&gt;Blackbox encrypts a registered file
with all of the administrators as the recipients,
so any administrator can decrypt the file.&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;a class=&#34;reference external image-reference&#34; href=&#34;http://www.cse.tkk.fi/fi/opinnot/T-110.5240/2009/luennot-files/Lecture%202.pdf&#34;&gt;&lt;img alt=&#34;Typical PGP Message&#34; src=&#34;https://www.georgevreilly.com/content/binary/typical-pgp-message.jpg&#34;/&gt;&lt;/a&gt;
&lt;p class=&#34;caption&#34;&gt;Typical PGP Message&lt;/p&gt;
&lt;div class=&#34;legend&#34;&gt;
(Figure from &lt;a class=&#34;reference external&#34; href=&#34;http://www.cse.tkk.fi/fi/opinnot/T-110.5240/2009/luennot-files/Lecture%202.pdf&#34;&gt;Network Security: Email Security, PKI&lt;/a&gt;, Tuomas Aura)&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;You can use &lt;tt class=&#34;docutils literal&#34;&gt;gpg &lt;span class=&#34;pre&#34;&gt;--list-packets&lt;/span&gt;&lt;/tt&gt; to dump the contents of any GPG message.
&lt;a class=&#34;reference external&#34; href=&#34;https://begriffs.com/posts/2016-11-05-advanced-intro-gnupg.html&#34;&gt;An Advanced Intro to GnuPG&lt;/a&gt; dives into the message format in more detail.&lt;/p&gt;
&lt;p&gt;Going back to my original example,
&lt;tt class=&#34;docutils literal&#34;&gt;credentials.sh&lt;/tt&gt; is a file registered in &lt;tt class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;blackbox-files.txt&lt;/span&gt;&lt;/tt&gt;.
This file should never be committed to the VCS—add it to &lt;a class=&#34;reference external&#34; href=&#34;https://git-scm.com/docs/gitignore&#34;&gt;gitignore&lt;/a&gt; to prevent accidentally committing it.
Instead, &lt;tt class=&#34;docutils literal&#34;&gt;credentials.sh.gpg&lt;/tt&gt; is committed.
Since the latter is a binary file,
comparing two versions in cleartext is tricky.&lt;/p&gt;
&lt;table class=&#34;docutils footnote&#34; frame=&#34;void&#34; id=&#34;revocation&#34; rules=&#34;none&#34;&gt;
&lt;colgroup&gt;&lt;col class=&#34;label&#34;/&gt;&lt;col /&gt;&lt;/colgroup&gt;
&lt;tbody valign=&#34;top&#34;&gt;
&lt;tr&gt;&lt;td class=&#34;label&#34;&gt;&lt;a class=&#34;fn-backref&#34; href=&#34;https://www.georgevreilly.com/blog/2019/09/02/gpg-blackbox-paperkey.html/#footnote-reference-1&#34;&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;If they have a snapshot of the VCS before their access was revoked,
they will still be able to decrypt the secrets as they were then.
In principle, you should be changing passwords and certificates
every time someone&#39;s access is revoked.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;section&#34; id=&#34;private-keys-and-paperkey&#34;&gt;
&lt;h3&gt;Private Keys and Paperkey&lt;/h3&gt;
&lt;p&gt;Administrators can encrypt and decrypt Blackbox&#39;d files
because they have their private key on a local keyring.&lt;/p&gt;
&lt;p&gt;Getting a private key onto other hosts can be tricky.
We developed this technique when we were using Atlassian&#39;s hosted Bamboo CI service.
We later used it with hosted Jenkins at Cloudbees.
Because we were using a hosted Continuous Integration (CI) service,
we had limited control over what we could install.
If I remember correctly,
Bamboo had support for secret environment variables,
but did not provide a way to store a keyring file.
There was also a limit on the length of the environment variables, I believe.&lt;/p&gt;
&lt;p&gt;We were able to get past this by using &lt;a class=&#34;reference external&#34; href=&#34;http://www.jabberwocky.com/software/paperkey/&#34;&gt;Paperkey&lt;/a&gt;
to (de)serialize the secret key.
Paperkey can extract just the secret part of a secret key:
‘Due to metadata and redundancy,
OpenPGP secret keys are significantly larger than just the &amp;quot;secret bits&amp;quot;.
In fact, the secret key contains a complete copy of the public key.’&lt;/p&gt;
&lt;p&gt;We created a keypair for the CI on a secure host,
serialized the secret with Paperkey,
and pasted the secret into the CI&#39;s UI to become an environment variable.
At build time, we used Paperkey on the CI box to deserialize the secret key
from the environment variable,
before decrypting the secrets needed with Blackbox.&lt;/p&gt;
&lt;p&gt;To create the CI keypair,
follow the portion of the &lt;a class=&#34;reference external&#34; href=&#34;https://github.com/StackExchange/blackbox#set-up-automated-users-or-role-accounts&#34;&gt;Blackbox &amp;quot;role accounts&amp;quot; instructions&lt;/a&gt;
that create a sub-key with no password for &lt;tt class=&#34;docutils literal&#34;&gt;ci&amp;#64;example.com&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Then, serialize the public key and the secret with Paperkey:&lt;/p&gt;
&lt;pre class=&#34;code bash literal-block&#34;&gt;
&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; /tmp/NEWMASTER
gpg --homedir . --export ci&amp;#64;example.com &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 &amp;gt; public_key.txt
gpg --homedir . --export-secret-keys ci&amp;#64;example.com &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; paperkey --output-type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;raw &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 &amp;gt; secret.txt
&lt;/pre&gt;
&lt;p&gt;Copy and paste the contents of &lt;tt class=&#34;docutils literal&#34;&gt;public_key.txt&lt;/tt&gt;
to the &lt;tt class=&#34;docutils literal&#34;&gt;GPG_PUBLIC_KEY&lt;/tt&gt; environment variable in the CI.
Similarly, copy &lt;tt class=&#34;docutils literal&#34;&gt;secret.txt&lt;/tt&gt; to &lt;tt class=&#34;docutils literal&#34;&gt;GPG_SECRET&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Securely delete everything in &lt;tt class=&#34;docutils literal&#34;&gt;/tmp/NEWMASTER&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;We used a script like this on the CI to reconstitute the keypair
and to decrypt the other secrets from Blackbox:&lt;/p&gt;
&lt;pre class=&#34;code bash literal-block&#34;&gt;
&lt;span class=&#34;ch&#34;&gt;#!/usr/bin/env bash
&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Run during a CI build to decrypt all Blackbox-encrypted files in this repo.
# Can also be used interactively.
&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; -ex

&lt;span class=&#34;c1&#34;&gt;# Root of Git working tree
&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SERVICES_DIR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;dirname &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$0&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/..&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;pwd&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$CI_BUILD&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;true&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
    &lt;span class=&#34;nv&#34;&gt;GPG_HOMEDIR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;mktemp -d -t gnupg.XXX&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;
    &lt;span class=&#34;nv&#34;&gt;SECRET_KEY_FILE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$GPG_HOMEDIR&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/secret.key&amp;quot;&lt;/span&gt;
    &lt;span class=&#34;nv&#34;&gt;PUBLIC_KEY_FILE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$GPG_HOMEDIR&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/public_key.gpg&amp;quot;&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# this variable is how you can customize how GPG is used in Blackbox
&lt;/span&gt;    &lt;span class=&#34;nv&#34;&gt;GPG&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;gpg --homedir=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$GPG_HOMEDIR&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# Remove secrets from filesystem on exit.
&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; clean_up &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;# TODO: use shred, if available
&lt;/span&gt;        rm -rf &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$GPG_HOMEDIR&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;trap&lt;/span&gt; clean_up EXIT&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;Unpacking keys; exiting debug mode to redact...&amp;quot;&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; +x

    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -z &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$GPG_PUBLIC_KEY&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt; -o -z &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$GPG_SECRET&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;Missing CI credential env vars for GPG key and secret&amp;quot;&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# unpack public key
&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$GPG_PUBLIC_KEY&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$PUBLIC_KEY_FILE&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# unpack secret key
&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$GPG_SECRET&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$SECRET_KEY_FILE&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;

    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;Secrets unpacked...&amp;quot;&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; -x

    &lt;span class=&#34;c1&#34;&gt;# reconstitute and import full key into $GPG_HOMEDIR
&lt;/span&gt;    paperkey --pubring &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$PUBLIC_KEY_FILE&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt; --secrets &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$SECRET_KEY_FILE&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$GPG&lt;/span&gt; --import

    &lt;span class=&#34;c1&#34;&gt;# TODO: vendor Blackbox
&lt;/span&gt;    &lt;span class=&#34;nv&#34;&gt;BLACKBOX_DIR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;mktemp -d -t blackbox.XXX&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;
    &lt;span class=&#34;nv&#34;&gt;BLACKBOX_BIN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$BLACKBOX_DIR&lt;/span&gt;/bin

    &lt;span class=&#34;c1&#34;&gt;# Shallow clone of Blackbox with most-recent commit only
&lt;/span&gt;    git clone --depth &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; https://github.com/StackExchange/blackbox.git &lt;span class=&#34;nv&#34;&gt;$BLACKBOX_DIR&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# So that you only have to enter your password once when running interactively
&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;eval&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;gpg-agent --daemon&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# No custom GPG_HOMEDIR needed
&lt;/span&gt;    &lt;span class=&#34;nv&#34;&gt;GPG&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;gpg&amp;quot;&lt;/span&gt;

    &lt;span class=&#34;nv&#34;&gt;BLACKBOX_POSTDEPLOY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; -v blackbox_postdeploy&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ret&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$?&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$BLACKBOX_POSTDEPLOY&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;# Use the Blackbox that&#39;s on the path
&lt;/span&gt;        &lt;span class=&#34;nv&#34;&gt;BLACKBOX_BIN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;dirname &lt;span class=&#34;nv&#34;&gt;$BLACKBOX_POSTDEPLOY&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;# Assume Blackbox is checked out in a sibling dir to $SERVICES_DIR
&lt;/span&gt;        &lt;span class=&#34;nv&#34;&gt;BLACKBOX_BIN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$SERVICES_DIR&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/..&amp;quot;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;pwd&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;/blackbox/bin
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; ! -f &lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$BLACKBOX_BIN&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/blackbox_postdeploy&amp;quot;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
            &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;Can&#39;t find Blackbox binaries&amp;quot;&lt;/span&gt;
            &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# decrypt secrets in $SERVICES_DIR using custom GPG_HOMEDIR
&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;GPG&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$GPG&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$BLACKBOX_BIN&lt;/span&gt;/blackbox_postdeploy

&lt;span class=&#34;c1&#34;&gt;# test that decryption worked
&lt;/span&gt;grep &lt;span class=&#34;s1&#34;&gt;&#39;congrats!&#39;&lt;/span&gt; test_secret.txt
&lt;/pre&gt;
&lt;p&gt;At the end of the build,
run &lt;tt class=&#34;docutils literal&#34;&gt;blackbox_shred_all_files&lt;/tt&gt; to destroy any decrypted files.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section&#34; id=&#34;more-reading&#34;&gt;
&lt;h3&gt;More Reading&lt;/h3&gt;
&lt;ul class=&#34;simple&#34;&gt;
&lt;li&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://github.com/StackExchange/blackbox&#34;&gt;Blackbox&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;reference external&#34; href=&#34;http://www.jabberwocky.com/software/paperkey/&#34;&gt;Paperkey&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;reference external&#34; href=&#34;http://www.linux-magazine.com/Online/Features/Protect-your-Documents-with-GPG&#34;&gt;Protect your documents with GPG&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://davesteele.github.io/gpg/2014/09/20/anatomy-of-a-gpg-key/&#34;&gt;Anatomy of a GPG Key&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://alexcabal.com/creating-the-perfect-gpg-keypair&#34;&gt;Creating the perfect GPG keypair&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://www.darkcoding.net/software/how-gpg-works-encrypt/&#34;&gt;How GPG works: Encrypt&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://gist.github.com/chrisroos/1205934&#34;&gt;GPG import and export&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://begriffs.com/posts/2016-11-05-advanced-intro-gnupg.html&#34;&gt;An Advanced Intro to GnuPG&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;reference external&#34; href=&#34;http://www.cse.tkk.fi/fi/opinnot/T-110.5240/2009/luennot-files/Lecture%202.pdf&#34;&gt;Network Security: Email Security, PKI&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content>
    </entry>
    
        <entry>
        <title>Review: Fire and Blood</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2019/01/03/ReviewFireAndBlood.html" />
        <id>tag:www.georgevreilly.com,2019-01-03:/blog/2019/01/03/ReviewFireAndBlood.html</id>
        <updated>2019-01-03T08:00:00Z</updated>
        <category term="books" />
        <category term="reviews" />
        <category term="fantasy" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;a class=&#34;reference external image-reference&#34; href=&#34;https://www.amazon.com/dp/152479628X/?tag=georgvreill-20&#34;&gt;&lt;img alt=&#34;Fire and Blood&#34; class=&#34;right-float&#34; src=&#34;https://images-na.ssl-images-amazon.com/images/P/152479628X.01.MZZZZZZZ.jpg&#34;/&gt;&lt;/a&gt;
&lt;div class=&#34;line-block&#34;&gt;
&lt;div class=&#34;line&#34;&gt;Title: Fire and Blood&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Author: George R.R. Martin&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Rating: ★ ★ ★ ½&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Publisher: Bantam&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Copyright: 2018&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;ISBN: &lt;a class=&#34;reference external&#34; href=&#34;https://www.amazon.com/dp/152479628X/?tag=georgvreill-20&#34;&gt;978-1524796280&lt;/a&gt;&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Pages: 736&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Keywords: fantasy&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Reading period: 28 December, 2018–1 January, 2019&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;I&#39;ve been waiting longer than most for George R.R. Martin
to finish the &lt;em&gt;A Song of Fire and Ice&lt;/em&gt; series:
I read the first book when it was &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2005/11/20/AFeastForCrows.html&#34;&gt;newly published in paperback&lt;/a&gt; in 1997.
&lt;em&gt;Fire and Blood&lt;/em&gt; is a new addition to the series,
but it is a prequel and does not advance the plot at all.
This book is a history of the first half of the
three hundred–year reign of the Targaryen dynasty,
the dragon riders who conquered Westeros
with their firebreathing dragons.
The Game of Thrones series takes place fifteen years
after the last Targaryen king was deposed.&lt;/p&gt;
&lt;p&gt;Instead of a standard novel told from multiple viewpoints,
&lt;em&gt;Fire and Blood&lt;/em&gt; purports to be a history assembled by a scholar
from a variety of sources,
decades after the events recounted.
As such, it is much drier than the novels and less enjoyable.
It fleshes out characters and events oft alluded to in the novels.
The Targaryens are a nasty, backbiting lot.
They are literally inbred, frequently marrying brother to sister.
Different factions feud over succession;
civil wars are fought;
alliances are made and lives are broken.&lt;/p&gt;
&lt;p&gt;This book was once dubbed the &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Fire_%26_Blood_(book)&#34;&gt;GRRMarillion&lt;/a&gt;;
I would recommend it mainly to completists.&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>Review: Watership Down (miniseries)</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2019/01/02/ReviewWatershipDownMiniseries.html" />
        <id>tag:www.georgevreilly.com,2019-01-02:/blog/2019/01/02/ReviewWatershipDownMiniseries.html</id>
        <updated>2019-01-02T08:00:00Z</updated>
        <category term="movies" />
        <category term="reviews" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;a class=&#34;reference external image-reference&#34; href=&#34;https://en.wikipedia.org/wiki/Watership_Down_(miniseries)&#34;&gt;&lt;img alt=&#34;Watership Down&#34; src=&#34;https://occ-0-1782-1007.1.nflxso.net/art/ec6ad/8da2469ea8d6ed01ce41c61a0dae6a7c26fec6ad.jpg&#34;/&gt;&lt;/a&gt;
&lt;div class=&#34;line-block&#34;&gt;
&lt;div class=&#34;line&#34;&gt;Title: Watership Down (miniseries)&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Director: Noam Murro&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Rating: ★ ★ ★ ★&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Released: 2018&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Keywords: animation&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Country: UK&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Watched: 30 December, 2018–1 January, 2019&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Two years ago, just after the death of Richard Adams,
I reread the &lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2017/01/01/ReviewWatershipDown.html&#34;&gt;book&lt;/a&gt; of &lt;em&gt;Watership Down&lt;/em&gt;
for the first time in many years,
having originally discovered it when it was new
in the mid-1970s.
There&#39;s a beautiful new adaptation,
an animated &lt;a class=&#34;reference external&#34; href=&#34;https://en.wikipedia.org/wiki/Watership_Down_(miniseries)&#34;&gt;miniseries&lt;/a&gt; made by the BBC and Netflix.&lt;/p&gt;
&lt;p&gt;This adaptation is largely faithful to the original book:
The brave young rabbits striking out on their own
before their home warren is destroyed;
creating a new warren on Watership Down;
the war with the totalitarian warren of Efrafa;
the peaceful aftermath.
One shortcoming is that
although the voices are generally distinct,
many of the rabbits look alike,
and it&#39;s hard to tell one gray-brown rabbit from another.&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>2018 ends</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2018/12/31/2018-review.html" />
        <id>tag:www.georgevreilly.com,2018-12-31:/blog/2018/12/31/2018-review.html</id>
        <updated>2018-12-31T08:00:00Z</updated>
        <category term="personal" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;p&gt;2018 was a mixed year for Emma and me.&lt;/p&gt;
&lt;p&gt;At the start of the year,
I was the principal engineer at MetaBrite.
The year started out well initially,
as we had moved to much larger offices at the end of 2017.
In late January, a number of people were laid off,
when it became apparent
that the old business plan would no longer work.
In late March, the company died abruptly
when we lost our principal source of funding.
I spent April looking for a job and received several offers.&lt;/p&gt;
&lt;p&gt;I joined &lt;a class=&#34;reference external&#34; href=&#34;https://www.stripe.com/&#34;&gt;Stripe&lt;/a&gt;&#39;s Seattle office in June,
where I work on the Edge team,
which is &amp;quot;ensuring Stripe’s continued existence on the Internet&amp;quot;.
It&#39;s been a bit of adjustment going from being a big fish in a small pond
to at best a medium-sized fish in a much larger pond.
Stripe is growing rapidly in Seattle and we just moved to a new space.&lt;/p&gt;
&lt;p&gt;I&#39;ve been active in Toastmasters, continuing as an officer at my home club,
&lt;a class=&#34;reference external&#34; href=&#34;http://freelyspeaking.org/&#34;&gt;Freely Speaking Toastmasters&lt;/a&gt;.
We&#39;ve struggled with finding new members.
After a couple of years in South Lake Union,
we have moved back to Capitol Hill.
In July, I became an Area Director,
responsible for several clubs in downtown Seattle.&lt;/p&gt;
&lt;p&gt;In June, the &lt;a class=&#34;reference external&#34; href=&#34;https://www.wildgeeseseattle.org/&#34;&gt;Wild Geese Players of Seattle&lt;/a&gt;
put on our annual Bloomsday reading at the Seattle Central Library.
In October, we arranged a 20th Anniversary Celebration of Irish Writing.&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;reference external&#34; href=&#34;https://www.goodreads.com/user/show/3723742-george-reilly&#34;&gt;GoodReads&lt;/a&gt;
says I read 113 books in 2018.
Most of those books were on Kindle.
I didn&#39;t bother to add most of the paperbacks and hardbacks that I read,
so the total is probably closer to 140 books for the year.&lt;/p&gt;
&lt;p&gt;In the year leading up to my
&lt;a class=&#34;reference external&#34; href=&#34;https://www.georgevreilly.com/blog/2017/01/17/KneeWalker.html&#34;&gt;heel surgery&lt;/a&gt;
at the beginning of 2017,
I lost the habit of cycling to work,
which I had developed over the preceding decade.
I have not yet rebuilt the habit.
I&#39;m going to work on it in 2019.&lt;/p&gt;
&lt;p&gt;Emma&#39;s health has not been good and she&#39;s had a rough year.
She has a lot of abdominal problems,
which are not well understood.&lt;/p&gt;
&lt;p&gt;It&#39;s been a poor year for the United States,
with Trump in the Oval Office.
I look forward to the new Democratic Congress
which takes office later this week.&lt;/p&gt;
&lt;p&gt;Here&#39;s to 2019!&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>Review: The Heart&#39;s Invisible Furies</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2018/12/01/ReviewHeartsInvisibleFuries.html" />
        <id>tag:www.georgevreilly.com,2018-12-01:/blog/2018/12/01/ReviewHeartsInvisibleFuries.html</id>
        <updated>2018-12-01T08:00:00Z</updated>
        <category term="books" />
        <category term="reviews" />
        <category term="fiction" />
        <category term="ireland" />
        <category term="lgbt" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;a class=&#34;reference external image-reference&#34; href=&#34;https://www.amazon.com/dp/152476079X/?tag=georgvreill-20&#34;&gt;&lt;img alt=&#34;The Heart&amp;#x27;s Invisible Furies&#34; class=&#34;right-float&#34; src=&#34;https://images-na.ssl-images-amazon.com/images/P/152476079X.01.MZZZZZZZ.jpg&#34;/&gt;&lt;/a&gt;
&lt;div class=&#34;line-block&#34;&gt;
&lt;div class=&#34;line&#34;&gt;Title: The Heart&#39;s Invisible Furies&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Author: John Boyne&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Rating: ★ ★ ★ ★ ½&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Publisher: Hogarth&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Copyright: 2017&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;ISBN: &lt;a class=&#34;reference external&#34; href=&#34;https://www.amazon.com/dp/152476079X/?tag=georgvreill-20&#34;&gt;152476079X&lt;/a&gt;&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Pages: 592&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Keywords: fiction, gay, irish&lt;/div&gt;
&lt;div class=&#34;line&#34;&gt;Reading period: 30 October, 2018&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Before I begin to describe &lt;em&gt;The Heart&#39;s Invisible Furies&lt;/em&gt;
with abundant spoilers, let me say two things.
Despite what I describe below, the book is very funny,
as Cyril recounts his frequent fuckups.
You would never know,
from reading the back cover or the excerpted reviews inside,
that Cyril is gay.
Yet Cyril&#39;s sexuality is the central theme of the book.
I can only assume that this is a marketing decision,
with which I strongly disagree.&lt;/p&gt;
&lt;p&gt;16-year-old Catherine is forced out of her Cork village by the parish priest,
when her pregnancy is discovered.
It&#39;s impossible to be a single, unwed mother in Ireland in 1945,
so she puts her son up for adoption.
Cyril Avery grows up in an odd, well-off household in Dublin,
always being told by his adoptive father that he&#39;s not a &lt;em&gt;real&lt;/em&gt; Avery.
At seven, he develops a fascination with Julian,
the son of his father&#39;s lawyer, whom he meets one fateful day.
They meet again at fourteen, sharing a room in boarding school,
and Cyril develops a full-blown but entirely secret obsession
with the golden boy, Julian.&lt;/p&gt;
&lt;p&gt;Cyril begins to realize that he is that most despised creature,
a homosexual in 1950s Catholic Ireland.
By twenty-one, he is frequently meeting other men
for furtive, anonymous sex.
There is no outlet for romance or love,
just hurried encounters.
Homosexual acts are illegal in Ireland
and discovery would mean social and professional ruin,
perhaps even prosecution.
He&#39;s still secretly in love with Julian,
now a heterosexual hedonist in the swinging Sixties.
At twenty-eight, deeply conflicted, he marries Julian&#39;s sister Alice,
and abandons her hours after the wedding.
Of all the stupid things that Cyril does,
this is the worst.
By thirty-five (1980), he&#39;s ended up in Amsterdam,
where gay people can live openly,
and he&#39;s in a relationship with Bastiaan, a Dutch doctor.
In 1987, Bastiaan and Cyril are in New York,
working with dying AIDS patients.
Fear of AIDS is rampant and
many of them have been rejected by their families.
One of these patients is Julian,
who is determined that no-one in Ireland should know
that he&#39;s dying of such a shameful disease.
From Julian, Cyril belatedly learns that Alice has a teenaged son, Liam.
Julian insists that Cyril should have told him long ago,
that he would have understood.
Cyril knows better.
Cyril couldn&#39;t be honest with the world for a long time,
because the world—and Ireland—wouldn&#39;t let him be honest about himself.
The episode ends with Bastiaan being killed by fagbashers
who leave Cyril in a coma.&lt;/p&gt;
&lt;p&gt;After that, Cyril returns to Dublin,
where he lives openly if quietly as a gay man.
In time, he is reunited with his mother Catherine
and makes peace with Alice and Liam.
The final episode takes place in 2015,
months after Ireland voted to &lt;a class=&#34;reference external&#34; href=&#34;https://www.theguardian.com/world/2015/may/23/gay-marriage-ireland-yes-vote&#34;&gt;legalize same-sex marriage&lt;/a&gt;.
Cyril, now seventy, wonders at the New Ireland
and he marvels at his own 17-year-old grandson
openly expressing affection for his boyfriend.
It&#39;s a bittersweet moment for Cyril.
He thinks about Senator David Norris,
Ireland&#39;s most famous gay rights campaigner for forty years,
saying, when asked if he would take advantage of the new law,
“It’s a little bit late for me ...
I’ve spent so much time pushing the boat out
that I forgot to jump on
and now it’s out beyond the harbour on the high seas,
but it’s very nice to look at.”&lt;/p&gt;
&lt;p&gt;In a &lt;a class=&#34;reference external&#34; href=&#34;https://www.powells.com/post/original-essays/the-most-truthful-paragraph-ive-written&#34;&gt;somewhat bitter afterword&lt;/a&gt;,
the author John Boyne describes writing the book.
He knew from a young age that he was gay,
long before he knew what “gay” meant.
Boyne drew upon his own early experiences in creating Cyril
and regrets the potential that is lost to our generation.
Boyne was born in Dublin in 1971, six years after me.
I realized in my mid-teens that I am bisexual,
something that I kept entirely buried for a decade.
I found Ireland no more accepting than John Boyne did in the 1980s.
If I were thirteen years old now in Dublin,
instead of being thirteen in 1978,
I wonder how things would be turning out for me.
Would coming out as a bisexual teen be a near non-event,
instead of the long-deferred
and fearful-but-exhilarating landmark of my twenties?
My mother gave me this book,
after reading it herself,
so I think it would be easier this time around.&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>Election Day 2018</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2018/11/06/ElectionDay2018.html" />
        <id>tag:www.georgevreilly.com,2018-11-06:/blog/2018/11/06/ElectionDay2018.html</id>
        <updated>2018-11-06T08:00:00Z</updated>
        <category term="politics" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;img alt=&#34;Grab &amp;#x27;Em by the Midterms&#34; class=&#34;right-float&#34; src=&#34;https://www.georgevreilly.com/content/binary/grab-them-by-the-midterms.jpg&#34; style=&#34;width: 400px;&#34;/&gt;
&lt;!-- source: http://chicagowomentakeaction.com/event/vote-in-2018/ --&gt;
&lt;p&gt;In 2016, I threw an Election Night victory party for Hillary Clinton.
It turned into a wake.&lt;/p&gt;
&lt;p&gt;In 2016, it was obvious to me and to millions of others
that Trump was unfit to be President.
There were weak excuses that he might turn out to be more presidential
after the campaign was over.
Instead, we got the worst president we&#39;ve ever seen in the US.
Morally unfit.
Temperamentally unfit.
Ethically unfit.
A pathological liar.
A shatterer of alliances.
A demagogue, stoking the flames of right-wing violent extremism.&lt;/p&gt;
&lt;p&gt;In 2018, there are no excuses for not seeing how dangerous Trump is.
Trump himself is not on the ballot,
but this is nonetheless a referendum on Trump.
The Republican party have done nothing to rein in his excesses.
They will continue to do nothing if they retain the House of Representatives.&lt;/p&gt;
&lt;p&gt;The Republicans must be voted out of power in the House.
The Senate too, if that&#39;s possible.
Trump is deeply unpopular outside his base,
but structural inequalities, gerrymandering, and voter suppression
all make it far from certain that the Democrats can win tonight.&lt;/p&gt;
&lt;p&gt;Brace yourselves for a backlash.&lt;/p&gt;
&lt;p&gt;If the Democrats win a narrow victory,
expect rage and violence from the right-wing
that dwarfs that of the last few weeks.
Trump has been laying down a narrative of a stolen election again,
just as he did before the 2016 election.&lt;/p&gt;
&lt;p&gt;If the Republicans retain control,
what little restraint that was still in place will go.
They will not be magnanimous in victory.&lt;/p&gt;
&lt;p&gt;We may not know the final results for weeks,
as tight races are counted and recounted.&lt;/p&gt;
&lt;p&gt;The best outcome is for
the Democrats to win a resounding victory and sweep the House.
I don&#39;t know if we can pull that off.
But the best way to be sure is for everyone
to &lt;em&gt;vote Democrat&lt;/em&gt; today.&lt;/p&gt;
&lt;p&gt;Please vote.
It matters.&lt;/p&gt;
</content>
    </entry>
    
        <entry>
        <title>Brilliant Jerks in Engineering</title>
        <link rel="alternate" type="text/html" href="https://www.georgevreilly.com/blog/2017/12/30/BrilliantJerksInEngineering.html" />
        <id>tag:www.georgevreilly.com,2017-12-30:/blog/2017/12/30/BrilliantJerksInEngineering.html</id>
        <updated>2017-12-30T08:00:00Z</updated>
        <category term="tech" />
        
        <author>
            <name>George V. Reilly</name>
            <uri>https://www.georgevreilly.com/</uri>
            <email>george@reilly.org</email>
        </author>
        <content type="html">&lt;a class=&#34;reference external image-reference&#34; href=&#34;http://www.brendangregg.com/blog/2017-11-13/brilliant-jerks.html&#34;&gt;&lt;img alt=&#34;&amp;quot;Do not tolerate brilliant jerks. The cost to teamwork is too high&amp;quot; — Reed Hastings, CEO Netflix&#34; class=&#34;right-float&#34; src=&#34;https://www.brendangregg.com/blog/images/2017/brilliantjerks.jpg&#34; style=&#34;width: 400px;&#34;/&gt;&lt;/a&gt;
&lt;p&gt;Brendan Gregg&#39;s &lt;a class=&#34;reference external&#34; href=&#34;http://www.brendangregg.com/blog/2017-11-13/brilliant-jerks.html&#34;&gt;Brilliant Jerks in Engineering&lt;/a&gt;
is an excellent discussion of the &amp;quot;No Asshole Rule&amp;quot;
applied to software engineers.&lt;/p&gt;
&lt;p&gt;He posits two kinds of brilliant jerks, the selfless and the selfish.
You might call them unempathic and sociopathic, respectively.
The former, if they develop some emotional intelligence, are worth saving.
The latter are simply toxic and probably need to be fired.&lt;/p&gt;
</content>
    </entry>
    </feed>